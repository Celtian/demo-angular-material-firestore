import{c as um,d as wc,f as Gs,g as Ec,i as Ic}from"./chunk-AESYL7IM.js";import{a as ti,b as ei,c as qs,d as sm,f as je,g as Ve}from"./chunk-G7H2BJTJ.js";import{a as Yf,b as Xf,c as Jf,d as Zf,e as tm,g as Qt,h as em,i as nm,l as hr,m as fm,n as mm,o as gm,p as pm,q as _m,r as ym,s as vm,t as Tc,x as wm}from"./chunk-Y4M62QSP.js";import{a as hm,d as dm}from"./chunk-WJ4JSTVP.js";import{a as $f,b as gt,c as Ms,h as Kf,i as Qf,j as Wf,l as Hf,o as lr}from"./chunk-OAMQ53XU.js";import{$a as uc,B as Of,C as ks,Ca as St,Cb as mn,D as ce,E as lc,Ea as ar,Eb as Yn,Fb as Xn,Gb as Jn,Ia as Bf,Ib as gc,J as Qn,Ja as Kt,Jc as Ls,Kb as pc,Kc as _c,Lc as at,Mc as im,Nc as ee,Ob as ze,Qa as Hn,Qc as rm,Ra as B,Rc as Bs,Sc as yc,Ta as cr,Tc as vc,Uc as Zn,V as Wn,Vc as ur,Wa as Pe,Wc as ni,Xa as Ct,Y as rr,Yc as om,Z as Ff,Za as un,Zc as am,a as Be,ab as hc,bb as hn,c as Ps,ca as wt,cb as dn,cc as Gf,da as jt,dd as Us,e as kf,ec as gn,ed as zs,f as H,fb as Ns,ga as Et,ha as S,hd as cm,ia as le,ib as qf,ic as It,id as js,ja as Y,jd as lm,ka as qe,la as Gt,ma as $t,mb as fn,md as ii,nb as Ue,oa as sr,ob as dc,p as ir,pa as Mf,pc as Fs,qa as Lf,sb as Uf,tb as fc,u as Nf,ub as zf,va as or,wb as Os,xb as jf,yb as mc,z as Vs}from"./chunk-SFF4OQ2U.js";import{a as ft,b as Ds,f as m}from"./chunk-CQCHLVVT.js";function hb(n){return n&&typeof n.connect=="function"&&!(n instanceof kf)}var $s=function(n){return n[n.REPLACED=0]="REPLACED",n[n.INSERTED=1]="INSERTED",n[n.MOVED=2]="MOVED",n[n.REMOVED=3]="REMOVED",n}($s||{}),db=new Et("_ViewRepeater"),Em=class{applyChanges(t,e,i,r,s){t.forEachOperation((o,a,c)=>{let l,u;if(o.previousIndex==null){let h=i(o,a,c);l=e.createEmbeddedView(h.templateRef,h.context,h.index),u=$s.INSERTED}else c==null?(e.remove(a),u=$s.REMOVED):(l=e.get(a),e.move(l,c),u=$s.MOVED);s&&s({context:l?.context,operation:u,record:o})})}detach(){}};var Im=class{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new H,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));let e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));let e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);let e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(this._getConcreteValue(s,i))).forEach(s=>this._unmarkSelected(s));let r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();let e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){return this._selection.has(this._getConcreteValue(t))}isEmpty(){return this._selection.size===0}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){t=this._getConcreteValue(t),this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){t=this._getConcreteValue(t),this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){t.length>1&&this._multiple}_hasQueuedChanges(){return!!(this._deselectedToEmit.length||this._selectedToEmit.length)}_getConcreteValue(t,e){if(this.compareWith){e=e??this._selection;for(let i of e)if(this.compareWith(t,i))return i;return t}else return t}};var xv=20,bc=(()=>{let t=class t{constructor(i,r,s){this._ngZone=i,this._platform=r,this._scrolled=new H,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=s}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){let r=this.scrollContainers.get(i);r&&(r.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=xv){return this._platform.isBrowser?new Ps(r=>{this._globalSubscription||this._addGlobalListener();let s=i>0?this._scrolled.pipe(lc(i)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ir()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(i,r){let s=this.getAncestorScrollContainers(i);return this.scrolled(r).pipe(ce(o=>!o||s.indexOf(o)>-1))}getAncestorScrollContainers(i){let r=[];return this.scrollContainers.forEach((s,o)=>{this._scrollableContainsElement(o,i)&&r.push(o)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,r){let s=im(r),o=i.getElementRef().nativeElement;do if(s==o)return!0;while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let i=this._getWindow();return Of(i.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};t.\u0275fac=function(r){return new(r||t)(S(Ct),S(ee),S(It,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Dv=20,Ks=(()=>{let t=class t{constructor(i,r,s){this._platform=i,this._change=new H,this._changeListener=o=>{this._change.next(o)},this._document=s,r.runOutsideAngular(()=>{if(i.isBrowser){let o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){let i=this.getViewportScrollPosition(),{width:r,height:s}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+s,right:i.left+r,height:s,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let i=this._document,r=this._getWindow(),s=i.documentElement,o=s.getBoundingClientRect(),a=-o.top||i.body.scrollTop||r.scrollY||s.scrollTop||0,c=-o.left||i.body.scrollLeft||r.scrollX||s.scrollLeft||0;return{top:a,left:c}}change(i=Dv){return i>0?this._change.pipe(lc(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}};t.\u0275fac=function(r){return new(r||t)(S(ee),S(Ct),S(It,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Tm=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({});let n=t;return n})(),Ac=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({imports:[ur,Tm,ur,Tm]});let n=t;return n})();var Am=rm(),Sc=class{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){let t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=at(-this._previousScrollPosition.left),t.style.top=at(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let t=this._document.documentElement,e=this._document.body,i=t.style,r=e.style,s=i.scrollBehavior||"",o=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),Am&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),Am&&(i.scrollBehavior=s,r.scrollBehavior=o)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}};var Cc=class{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(this._scrollSubscription)return;let t=this._scrollDispatcher.scrolled(0).pipe(ce(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{let e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Qs=class{enable(){}disable(){}attach(){}};function Rc(n,t){return t.some(e=>{let i=n.bottom<e.top,r=n.top>e.bottom,s=n.right<e.left,o=n.left>e.right;return i||r||s||o})}function Sm(n,t){return t.some(e=>{let i=n.top<e.top,r=n.bottom>e.bottom,s=n.left<e.left,o=n.right>e.right;return i||r||s||o})}var xc=class{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(!this._scrollSubscription){let t=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(t).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();Rc(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},kv=(()=>{let t=class t{constructor(i,r,s,o){this._scrollDispatcher=i,this._viewportRuler=r,this._ngZone=s,this.noop=()=>new Qs,this.close=a=>new Cc(this._scrollDispatcher,this._ngZone,this._viewportRuler,a),this.block=()=>new Sc(this._viewportRuler,this._document),this.reposition=a=>new xc(this._scrollDispatcher,this._viewportRuler,this._ngZone,a),this._document=o}};t.\u0275fac=function(r){return new(r||t)(S(bc),S(Ks),S(Ct),S(It))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Ge=class{constructor(t){if(this.scrollStrategy=new Qs,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){let e=Object.keys(t);for(let i of e)t[i]!==void 0&&(this[i]=t[i])}}};var Dc=class{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}};var Pm=(()=>{let t=class t{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){let r=this._attachedOverlays.indexOf(i);r>-1&&this._attachedOverlays.splice(r,1),this._attachedOverlays.length===0&&this.detach()}};t.\u0275fac=function(r){return new(r||t)(S(It))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Nv=(()=>{let t=class t extends Pm{constructor(i,r){super(i),this._ngZone=r,this._keydownListener=s=>{let o=this._attachedOverlays;for(let a=o.length-1;a>-1;a--)if(o[a]._keydownEvents.observers.length>0){let c=o[a]._keydownEvents;this._ngZone?this._ngZone.run(()=>c.next(s)):c.next(s);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};t.\u0275fac=function(r){return new(r||t)(S(It),S(Ct,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Ov=(()=>{let t=class t extends Pm{constructor(i,r,s){super(i),this._platform=r,this._ngZone=s,this._cursorStyleIsSet=!1,this._pointerDownListener=o=>{this._pointerDownEventTarget=yc(o)},this._clickListener=o=>{let a=yc(o),c=o.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;let l=this._attachedOverlays.slice();for(let u=l.length-1;u>-1;u--){let h=l[u];if(h._outsidePointerEvents.observers.length<1||!h.hasAttached())continue;if(h.overlayElement.contains(a)||h.overlayElement.contains(c))break;let d=h._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>d.next(o)):d.next(o)}}}add(i){if(super.add(i),!this._isAttached){let r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}};t.\u0275fac=function(r){return new(r||t)(S(It),S(ee),S(Ct,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),ri=(()=>{let t=class t{constructor(i,r){this._platform=r,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let i="cdk-overlay-container";if(this._platform.isBrowser||vc()){let s=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let o=0;o<s.length;o++)s[o].remove()}let r=this._document.createElement("div");r.classList.add(i),vc()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}};t.\u0275fac=function(r){return new(r||t)(S(It),S(ee))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),ke=class{constructor(t,e,i,r,s,o,a,c,l,u=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=o,this._document=a,this._location=c,this._outsideClickDispatcher=l,this._animationsDisabled=u,this._backdropElement=null,this._backdropClick=new H,this._attachments=new H,this._detachments=new H,this._locationChanges=Be.EMPTY,this._backdropClickHandler=h=>this._backdropClick.next(h),this._backdropTransitionendHandler=h=>{this._disposeBackdrop(h.target)},this._keydownEvents=new H,this._outsidePointerEvents=new H,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Qn(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof e?.onDestroy=="function"&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){let t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=ft(ft({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Ds(ft({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){let t=this._config.direction;return t?typeof t=="string"?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let t=this._pane.style;t.width=at(this._config.width),t.height=at(this._config.height),t.minWidth=at(this._config.minWidth),t.minHeight=at(this._config.minHeight),t.maxWidth=at(this._config.maxWidth),t.maxHeight=at(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){let t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t=this._backdropElement;if(t){if(this._animationsDisabled){this._disposeBackdrop(t);return}t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){let r=_c(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let t=this._ngZone.onStable.pipe(rr(ks(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){let t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},Cm="cdk-overlay-connected-position-bounding-box",Fv=/([A-Za-z%]+)$/,Pc=class{get positions(){return this._preferredPositions}constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new H,this._resizeSubscription=Be.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._overlayRef&&this._overlayRef,this._validatePositions(),t.hostElement.classList.add(Cm),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[],o;for(let a of this._preferredPositions){let c=this._getOriginPoint(t,r,a),l=this._getOverlayPoint(c,e,a),u=this._getOverlayFit(l,e,i,a);if(u.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(a,c);return}if(this._canFitWithFlexibleDimensions(u,l,i)){s.push({position:a,origin:c,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(c,a)});continue}(!o||o.overlayFit.visibleArea<u.visibleArea)&&(o={overlayFit:u,overlayPoint:l,originPoint:c,position:a,overlayRect:e})}if(s.length){let a=null,c=-1;for(let l of s){let u=l.boundingBoxRect.width*l.boundingBoxRect.height*(l.position.weight||1);u>c&&(c=u,a=l)}this._isPushed=!1,this._applyPosition(a.position,a.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(o.position,o.originPoint);return}this._applyPosition(o.position,o.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&pn(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Cm),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,t.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r;if(i.originX=="center")r=t.left+t.width/2;else{let o=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;r=i.originX=="start"?o:a}e.left<0&&(r-=e.left);let s;return i.originY=="center"?s=t.top+t.height/2:s=i.originY=="top"?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r;i.overlayX=="center"?r=-e.width/2:i.overlayX==="start"?r=this._isRtl()?-e.width:0:r=this._isRtl()?0:-e.width;let s;return i.overlayY=="center"?s=-e.height/2:s=i.overlayY=="top"?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){let s=xm(e),{x:o,y:a}=t,c=this._getOffset(r,"x"),l=this._getOffset(r,"y");c&&(o+=c),l&&(a+=l);let u=0-o,h=o+s.width-i.width,d=0-a,f=a+s.height-i.height,y=this._subtractOverflows(s.width,u,h),v=this._subtractOverflows(s.height,d,f),p=y*v;return{visibleArea:p,isCompletelyWithinViewport:s.width*s.height===p,fitsInViewportVertically:v===s.height,fitsInViewportHorizontally:y==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){let r=i.bottom-e.y,s=i.right-e.x,o=Rm(this._overlayRef.getConfig().minHeight),a=Rm(this._overlayRef.getConfig().minWidth),c=t.fitsInViewportVertically||o!=null&&o<=r,l=t.fitsInViewportHorizontally||a!=null&&a<=s;return c&&l}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};let r=xm(e),s=this._viewportRect,o=Math.max(t.x+r.width-s.width,0),a=Math.max(t.y+r.height-s.height,0),c=Math.max(s.top-i.top-t.y,0),l=Math.max(s.left-i.left-t.x,0),u=0,h=0;return r.width<=s.width?u=l||-o:u=t.x<this._viewportMargin?s.left-i.left-t.x:0,r.height<=s.height?h=c||-a:h=t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:u,y:h},{x:t.x+u,y:t.y+h}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){let i=this._getScrollVisibility(),r=new Dc(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;let e=this._boundingBox.querySelectorAll(this._transformOriginSelector),i,r=t.overlayY;t.overlayX==="center"?i="center":this._isRtl()?i=t.overlayX==="start"?"right":"left":i=t.overlayX==="start"?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){let i=this._viewportRect,r=this._isRtl(),s,o,a;if(e.overlayY==="top")o=t.y,s=i.height-o+this._viewportMargin;else if(e.overlayY==="bottom")a=i.height-t.y+this._viewportMargin*2,s=i.height-a+this._viewportMargin;else{let f=Math.min(i.bottom-t.y+i.top,t.y),y=this._lastBoundingBoxSize.height;s=f*2,o=t.y-f,s>y&&!this._isInitialRender&&!this._growAfterOpen&&(o=t.y-y/2)}let c=e.overlayX==="start"&&!r||e.overlayX==="end"&&r,l=e.overlayX==="end"&&!r||e.overlayX==="start"&&r,u,h,d;if(l)d=i.width-t.x+this._viewportMargin,u=t.x-this._viewportMargin;else if(c)h=t.x,u=i.right-t.x;else{let f=Math.min(i.right-t.x+i.left,t.x),y=this._lastBoundingBoxSize.width;u=f*2,h=t.x-f,u>y&&!this._isInitialRender&&!this._growAfterOpen&&(h=t.x-y/2)}return{top:o,left:h,bottom:a,right:d,width:u,height:s}}_setBoundingBoxStyles(t,e){let i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));let r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{let s=this._overlayRef.getConfig().maxHeight,o=this._overlayRef.getConfig().maxWidth;r.height=at(i.height),r.top=at(i.top),r.bottom=at(i.bottom),r.width=at(i.width),r.left=at(i.left),r.right=at(i.right),e.overlayX==="center"?r.alignItems="center":r.alignItems=e.overlayX==="end"?"flex-end":"flex-start",e.overlayY==="center"?r.justifyContent="center":r.justifyContent=e.overlayY==="bottom"?"flex-end":"flex-start",s&&(r.maxHeight=at(s)),o&&(r.maxWidth=at(o))}this._lastBoundingBoxSize=i,pn(this._boundingBox.style,r)}_resetBoundingBoxStyles(){pn(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){pn(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){let i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,o=this._overlayRef.getConfig();if(r){let u=this._viewportRuler.getViewportScrollPosition();pn(i,this._getExactOverlayY(e,t,u)),pn(i,this._getExactOverlayX(e,t,u))}else i.position="static";let a="",c=this._getOffset(e,"x"),l=this._getOffset(e,"y");c&&(a+=`translateX(${c}px) `),l&&(a+=`translateY(${l}px)`),i.transform=a.trim(),o.maxHeight&&(r?i.maxHeight=at(o.maxHeight):s&&(i.maxHeight="")),o.maxWidth&&(r?i.maxWidth=at(o.maxWidth):s&&(i.maxWidth="")),pn(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);if(this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),t.overlayY==="bottom"){let o=this._document.documentElement.clientHeight;r.bottom=`${o-(s.y+this._overlayRect.height)}px`}else r.top=at(s.y);return r}_getExactOverlayX(t,e,i){let r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i));let o;if(this._isRtl()?o=t.overlayX==="end"?"left":"right":o=t.overlayX==="end"?"right":"left",o==="right"){let a=this._document.documentElement.clientWidth;r.right=`${a-(s.x+this._overlayRect.width)}px`}else r.left=at(s.x);return r}_getScrollVisibility(){let t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Sm(t,i),isOriginOutsideView:Rc(t,i),isOverlayClipped:Sm(e,i),isOverlayOutsideView:Rc(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){let t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return e==="x"?t.offsetX==null?this._offsetX:t.offsetX:t.offsetY==null?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&_c(t).forEach(e=>{e!==""&&this._appliedPanelClasses.indexOf(e)===-1&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){let t=this._origin;if(t instanceof Kt)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();let e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}};function pn(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function Rm(n){if(typeof n!="number"&&n!=null){let[t,e]=n.split(Fv);return!e||e==="px"?parseFloat(t):null}return n||null}function xm(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}var Dm="cdk-global-overlay-wrapper",Vc=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){let e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(Dm),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:o,maxHeight:a}=i,c=(r==="100%"||r==="100vw")&&(!o||o==="100%"||o==="100vw"),l=(s==="100%"||s==="100vh")&&(!a||a==="100%"||a==="100vh"),u=this._xPosition,h=this._xOffset,d=this._overlayRef.getConfig().direction==="rtl",f="",y="",v="";c?v="flex-start":u==="center"?(v="center",d?y=h:f=h):d?u==="left"||u==="end"?(v="flex-end",f=h):(u==="right"||u==="start")&&(v="flex-start",y=h):u==="left"||u==="start"?(v="flex-start",f=h):(u==="right"||u==="end")&&(v="flex-end",y=h),t.position=this._cssPosition,t.marginLeft=c?"0":f,t.marginTop=l?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=c?"0":y,e.justifyContent=v,e.alignItems=l?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(Dm),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}},Mv=(()=>{let t=class t{constructor(i,r,s,o){this._viewportRuler=i,this._document=r,this._platform=s,this._overlayContainer=o}global(){return new Vc}flexibleConnectedTo(i){return new Pc(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};t.\u0275fac=function(r){return new(r||t)(S(Ks),S(It),S(ee),S(ri))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Lv=0,Bt=(()=>{let t=class t{constructor(i,r,s,o,a,c,l,u,h,d,f,y){this.scrollStrategies=i,this._overlayContainer=r,this._componentFactoryResolver=s,this._positionBuilder=o,this._keyboardDispatcher=a,this._injector=c,this._ngZone=l,this._document=u,this._directionality=h,this._location=d,this._outsideClickDispatcher=f,this._animationsModuleType=y}create(i){let r=this._createHostElement(),s=this._createPaneElement(r),o=this._createPortalOutlet(s),a=new Ge(i);return a.direction=a.direction||this._directionality.value,new ke(o,r,s,a,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(i){let r=this._document.createElement("div");return r.id=`cdk-overlay-${Lv++}`,r.classList.add("cdk-overlay-pane"),i.appendChild(r),r}_createHostElement(){let i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(Gf)),new sm(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};t.\u0275fac=function(r){return new(r||t)(S(kv),S(ri),S(Bf),S(Mv),S(Nv),S(St),S(Ct),S(It),S(Zn),S(Fs),S(Ov),S(ar,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Bv=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],Vm=new Et("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let n=le(Bt);return()=>n.scrollStrategies.reposition()}}),qv=(()=>{let t=class t{constructor(i){this.elementRef=i}};t.\u0275fac=function(r){return new(r||t)(B(Kt))},t.\u0275dir=$t({type:t,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0});let n=t;return n})(),Qb=(()=>{let t=class t{get offsetX(){return this._offsetX}set offsetX(i){this._offsetX=i,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(i){this._offsetY=i,this._position&&this._updatePositionStrategy(this._position)}get disposeOnNavigation(){return this._disposeOnNavigation}set disposeOnNavigation(i){this._disposeOnNavigation=i}constructor(i,r,s,o,a){this._overlay=i,this._dir=a,this._backdropSubscription=Be.EMPTY,this._attachSubscription=Be.EMPTY,this._detachSubscription=Be.EMPTY,this._positionSubscription=Be.EMPTY,this._disposeOnNavigation=!1,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.hasBackdrop=!1,this.lockPosition=!1,this.flexibleDimensions=!1,this.growAfterOpen=!1,this.push=!1,this.backdropClick=new Pe,this.positionChange=new Pe,this.attach=new Pe,this.detach=new Pe,this.overlayKeydown=new Pe,this.overlayOutsideClick=new Pe,this._templatePortal=new ei(r,s),this._scrollStrategyFactory=o,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(i){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),i.origin&&this.open&&this._position.apply()),i.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=Bv);let i=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=i.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=i.detachments().subscribe(()=>this.detach.emit()),i.keydownEvents().subscribe(r=>{this.overlayKeydown.next(r),r.keyCode===27&&!this.disableClose&&!ni(r)&&(r.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(r=>{this.overlayOutsideClick.next(r)})}_buildConfig(){let i=this._position=this.positionStrategy||this._createPositionStrategy(),r=new Ge({direction:this._dir,positionStrategy:i,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop,disposeOnNavigation:this.disposeOnNavigation});return(this.width||this.width===0)&&(r.width=this.width),(this.height||this.height===0)&&(r.height=this.height),(this.minWidth||this.minWidth===0)&&(r.minWidth=this.minWidth),(this.minHeight||this.minHeight===0)&&(r.minHeight=this.minHeight),this.backdropClass&&(r.backdropClass=this.backdropClass),this.panelClass&&(r.panelClass=this.panelClass),r}_updatePositionStrategy(i){let r=this.positions.map(s=>({originX:s.originX,originY:s.originY,overlayX:s.overlayX,overlayY:s.overlayY,offsetX:s.offsetX||this.offsetX,offsetY:s.offsetY||this.offsetY,panelClass:s.panelClass||void 0}));return i.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(r).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){let i=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(i),i}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof qv?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(i=>{this.backdropClick.emit(i)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(Ff(()=>this.positionChange.observers.length>0)).subscribe(i=>{this.positionChange.emit(i),this.positionChange.observers.length===0&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)(B(Bt),B(mn),B(hc),B(Vm),B(Zn,8))},t.\u0275dir=$t({type:t,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:[Y.None,"cdkConnectedOverlayOrigin","origin"],positions:[Y.None,"cdkConnectedOverlayPositions","positions"],positionStrategy:[Y.None,"cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:[Y.None,"cdkConnectedOverlayOffsetX","offsetX"],offsetY:[Y.None,"cdkConnectedOverlayOffsetY","offsetY"],width:[Y.None,"cdkConnectedOverlayWidth","width"],height:[Y.None,"cdkConnectedOverlayHeight","height"],minWidth:[Y.None,"cdkConnectedOverlayMinWidth","minWidth"],minHeight:[Y.None,"cdkConnectedOverlayMinHeight","minHeight"],backdropClass:[Y.None,"cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:[Y.None,"cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:[Y.None,"cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:[Y.None,"cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:[Y.None,"cdkConnectedOverlayOpen","open"],disableClose:[Y.None,"cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:[Y.None,"cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayHasBackdrop","hasBackdrop",gn],lockPosition:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayLockPosition","lockPosition",gn],flexibleDimensions:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayFlexibleDimensions","flexibleDimensions",gn],growAfterOpen:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayGrowAfterOpen","growAfterOpen",gn],push:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayPush","push",gn],disposeOnNavigation:[Y.HasDecoratorInputTransform,"cdkConnectedOverlayDisposeOnNavigation","disposeOnNavigation",gn]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[uc,sr]});let n=t;return n})();function Uv(n){return()=>n.scrollStrategies.reposition()}var zv={provide:Vm,deps:[Bt],useFactory:Uv},si=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({providers:[Bt,zv],imports:[ur,Ve,Ac,Ac]});let n=t;return n})();function jv(n,t){}var _n=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var Oc=(()=>{let t=class t extends qs{constructor(i,r,s,o,a,c,l,u){super(),this._elementRef=i,this._focusTrapFactory=r,this._config=o,this._interactivityChecker=a,this._ngZone=c,this._overlayRef=l,this._focusMonitor=u,this._platform=le(ee),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=le(cr),this.attachDomPortal=h=>{this._portalOutlet.hasAttached();let d=this._portalOutlet.attachDomPortal(h);return this._contentAttached(),d},this._document=s,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(i){this._ariaLabelledByQueue.push(i),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(i){let r=this._ariaLabelledByQueue.indexOf(i);r>-1&&(this._ariaLabelledByQueue.splice(r,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(i){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachComponentPortal(i);return this._contentAttached(),r}attachTemplatePortal(i){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachTemplatePortal(i);return this._contentAttached(),r}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(i,r){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{i.removeEventListener("blur",s),i.removeEventListener("mousedown",s),i.removeAttribute("tabindex")};i.addEventListener("blur",s),i.addEventListener("mousedown",s)})),i.focus(r)}_focusByCssSelector(i,r){let s=this._elementRef.nativeElement.querySelector(i);s&&this._forceFocus(s,r)}_trapFocus(){let i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(r=>{r||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let i=this._config.restoreFocus,r=null;if(typeof i=="string"?r=this._document.querySelector(i):typeof i=="boolean"?r=i?this._elementFocusedBeforeDialogWasOpened:null:i&&(r=i),this._config.restoreFocus&&r&&typeof r.focus=="function"){let s=Bs(),o=this._elementRef.nativeElement;(!s||s===this._document.body||s===o||o.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(r,this._closeInteractionType),this._closeInteractionType=null):r.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let i=this._elementRef.nativeElement,r=Bs();return i===r||i.contains(r)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Bs()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};t.\u0275fac=function(r){return new(r||t)(B(Kt),B(zs),B(It,8),B(_n),B(Us),B(Ct),B(ke),B(js))},t.\u0275cmp=qe({type:t,selectors:[["cdk-dialog-container"]],viewQuery:function(r,s){if(r&1&&Yn(je,7),r&2){let o;Xn(o=Jn())&&(s._portalOutlet=o.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(r,s){r&2&&dn("id",s._config.id||null)("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null)},standalone:!0,features:[un,ze],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(r,s){r&1&&hn(0,jv,0,0,"ng-template",0)},dependencies:[je],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let n=t;return n})(),mr=class{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new H,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{i.keyCode===27&&!this.disableClose&&!ni(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=t.detachments().subscribe(()=>{e.closeOnOverlayDetachments!==!1&&this.close()})}close(t,e){if(this.containerInstance){let i=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}},Gv=new Et("DialogScrollStrategy",{providedIn:"root",factory:()=>{let n=le(Bt);return()=>n.scrollStrategies.block()}}),$v=new Et("DialogData"),Kv=new Et("DefaultDialogConfig");var Qv=0,Fc=(()=>{let t=class t{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(i,r,s,o,a,c){this._overlay=i,this._injector=r,this._defaultOptions=s,this._parentDialog=o,this._overlayContainer=a,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new H,this._afterOpenedAtThisLevel=new H,this._ariaHiddenElements=new Map,this.afterAllClosed=Vs(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Wn(void 0))),this._scrollStrategy=c}open(i,r){let s=this._defaultOptions||new _n;r=ft(ft({},s),r),r.id=r.id||`cdk-dialog-${Qv++}`,r.id&&this.getDialogById(r.id);let o=this._getOverlayConfig(r),a=this._overlay.create(o),c=new mr(a,r),l=this._attachContainer(a,c,r);return c.containerInstance=l,this._attachDialogContent(i,c,l,r),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(c),c.closed.subscribe(()=>this._removeOpenDialog(c,!0)),this.afterOpened.next(c),c}closeAll(){Nc(this.openDialogs,i=>i.close())}getDialogById(i){return this.openDialogs.find(r=>r.id===i)}ngOnDestroy(){Nc(this._openDialogsAtThisLevel,i=>{i.config.closeOnDestroy===!1&&this._removeOpenDialog(i,!1)}),Nc(this._openDialogsAtThisLevel,i=>i.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(i){let r=new Ge({positionStrategy:i.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:i.scrollStrategy||this._scrollStrategy(),panelClass:i.panelClass,hasBackdrop:i.hasBackdrop,direction:i.direction,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,width:i.width,height:i.height,disposeOnNavigation:i.closeOnNavigation});return i.backdropClass&&(r.backdropClass=i.backdropClass),r}_attachContainer(i,r,s){let o=s.injector||s.viewContainerRef?.injector,a=[{provide:_n,useValue:s},{provide:mr,useValue:r},{provide:ke,useValue:i}],c;s.container?typeof s.container=="function"?c=s.container:(c=s.container.type,a.push(...s.container.providers(s))):c=Oc;let l=new ti(c,s.viewContainerRef,St.create({parent:o||this._injector,providers:a}),s.componentFactoryResolver);return i.attach(l).instance}_attachDialogContent(i,r,s,o){if(i instanceof mn){let a=this._createInjector(o,r,s,void 0),c={$implicit:o.data,dialogRef:r};o.templateContext&&(c=ft(ft({},c),typeof o.templateContext=="function"?o.templateContext():o.templateContext)),s.attachTemplatePortal(new ei(i,null,c,a))}else{let a=this._createInjector(o,r,s,this._injector),c=s.attachComponentPortal(new ti(i,o.viewContainerRef,a,o.componentFactoryResolver));r.componentRef=c,r.componentInstance=c.instance}}_createInjector(i,r,s,o){let a=i.injector||i.viewContainerRef?.injector,c=[{provide:$v,useValue:i.data},{provide:mr,useValue:r}];return i.providers&&(typeof i.providers=="function"?c.push(...i.providers(r,i,s)):c.push(...i.providers)),i.direction&&(!a||!a.get(Zn,null,{optional:!0}))&&c.push({provide:Zn,useValue:{value:i.direction,change:ir()}}),St.create({parent:a||o,providers:c})}_removeOpenDialog(i,r){let s=this.openDialogs.indexOf(i);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((o,a)=>{o?a.setAttribute("aria-hidden",o):a.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),r&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let i=this._overlayContainer.getContainerElement();if(i.parentElement){let r=i.parentElement.children;for(let s=r.length-1;s>-1;s--){let o=r[s];o!==i&&o.nodeName!=="SCRIPT"&&o.nodeName!=="STYLE"&&!o.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}};t.\u0275fac=function(r){return new(r||t)(S(Bt),S(St),S(Kv,8),S(t,12),S(ri),S(Gv))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function Nc(n,t){let e=n.length;for(;e--;)t(n[e])}var Nm=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({providers:[Fc],imports:[si,Ve,lm,Ve]});let n=t;return n})();function Wv(n,t){}var gr=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},Mc="mdc-dialog--open",Om="mdc-dialog--opening",Fm="mdc-dialog--closing",Hv=150,Yv=75,Xv=(()=>{let t=class t extends Oc{constructor(i,r,s,o,a,c,l,u,h){super(i,r,s,o,a,c,l,h),this._animationMode=u,this._animationStateChanged=new Pe,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?Lm(this._config.enterAnimationDuration)??Hv:0,this._exitAnimationDuration=this._animationsEnabled?Lm(this._config.exitAnimationDuration)??Yv:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(Mm,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Om,Mc)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(Mc),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(Mc),this._animationsEnabled?(this._hostElement.style.setProperty(Mm,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Fm)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_clearAnimationClasses(){this._hostElement.classList.remove(Om,Fm)}_waitForAnimationToComplete(i,r){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(r,i)}_requestAnimationFrame(i){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(i):i()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(i){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(i){let r=super.attachComponentPortal(i);return r.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),r}};t.\u0275fac=function(r){return new(r||t)(B(Kt),B(zs),B(It,8),B(gr),B(Us),B(Ct),B(ke),B(ar,8),B(js))},t.\u0275cmp=qe({type:t,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:8,hostBindings:function(r,s){r&2&&(fc("id",s._config.id),dn("aria-modal",s._config.ariaModal)("role",s._config.role)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null),Ns("_mat-animation-noopable",!s._animationsEnabled))},standalone:!0,features:[un,ze],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(r,s){r&1&&(fn(0,"div",0)(1,"div",1),hn(2,Wv,0,0,"ng-template",2),Ue()())},dependencies:[je],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-actions{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let n=t;return n})(),Mm="--mat-dialog-transition-duration";function Lm(n){return n==null?null:typeof n=="number"?n:n.endsWith("ms")?Ls(n.substring(0,n.length-2)):n.endsWith("s")?Ls(n.substring(0,n.length-1))*1e3:n==="0"?0:null}var Ws=function(n){return n[n.OPEN=0]="OPEN",n[n.CLOSING=1]="CLOSING",n[n.CLOSED=2]="CLOSED",n}(Ws||{}),pr=class{constructor(t,e,i){this._ref=t,this._containerInstance=i,this._afterOpened=new H,this._beforeClosed=new H,this._state=Ws.OPEN,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(ce(r=>r.state==="opened"),Qn(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(ce(r=>r.state==="closed"),Qn(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),ks(this.backdropClick(),this.keydownEvents().pipe(ce(r=>r.keyCode===27&&!this.disableClose&&!ni(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),Bm(this,r.type==="keydown"?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(ce(e=>e.state==="closing"),Qn(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=Ws.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let e=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",e=""){return this._ref.updateSize(t,e),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=Ws.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function Bm(n,t,e){return n._closeInteractionType=t,n.close(e)}var Jv=new Et("MatMdcDialogData"),Zv=new Et("mat-mdc-dialog-default-options"),tw=new Et("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let n=le(Bt);return()=>n.scrollStrategies.block()}});var ew=0,Lc=(()=>{let t=class t{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(i,r,s,o,a,c,l,u){this._overlay=i,this._defaultOptions=o,this._scrollStrategy=a,this._parentDialog=c,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new H,this._afterOpenedAtThisLevel=new H,this.dialogConfigClass=gr,this.afterAllClosed=Vs(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Wn(void 0))),this._dialog=r.get(Fc),this._dialogRefConstructor=pr,this._dialogContainerType=Xv,this._dialogDataToken=Jv}open(i,r){let s;r=ft(ft({},this._defaultOptions||new gr),r),r.id=r.id||`mat-mdc-dialog-${ew++}`,r.scrollStrategy=r.scrollStrategy||this._scrollStrategy();let o=this._dialog.open(i,Ds(ft({},r),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:r},{provide:_n,useValue:r}]},templateContext:()=>({dialogRef:s}),providers:(a,c,l)=>(s=new this._dialogRefConstructor(a,r,l),s.updatePosition(r?.position),[{provide:this._dialogContainerType,useValue:l},{provide:this._dialogDataToken,useValue:c.data},{provide:this._dialogRefConstructor,useValue:s}])}));return s.componentRef=o.componentRef,s.componentInstance=o.componentInstance,this.openDialogs.push(s),this.afterOpened.next(s),s.afterClosed().subscribe(()=>{let a=this.openDialogs.indexOf(s);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||this._getAfterAllClosed().next())}),s}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(i){return this.openDialogs.find(r=>r.id===i)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(i){let r=i.length;for(;r--;)i[r].close()}};t.\u0275fac=function(r){return new(r||t)(S(Bt),S(St),S(Fs,8),S(Zv,8),S(tw),S(t,12),S(ri),S(ar,8))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),nw=0,MA=(()=>{let t=class t{constructor(i,r,s){this.dialogRef=i,this._elementRef=r,this._dialog=s,this.type="button"}ngOnInit(){this.dialogRef||(this.dialogRef=qm(this._elementRef,this._dialog.openDialogs))}ngOnChanges(i){let r=i._matDialogClose||i._matDialogCloseResult;r&&(this.dialogResult=r.currentValue)}_onButtonClick(i){Bm(this.dialogRef,i.screenX===0&&i.screenY===0?"keyboard":"mouse",this.dialogResult)}};t.\u0275fac=function(r){return new(r||t)(B(pr,8),B(Kt),B(Lc))},t.\u0275dir=$t({type:t,selectors:[["","mat-dialog-close",""],["","matDialogClose",""]],hostVars:2,hostBindings:function(r,s){r&1&&Os("click",function(a){return s._onButtonClick(a)}),r&2&&dn("aria-label",s.ariaLabel||null)("type",s.type)},inputs:{ariaLabel:[Y.None,"aria-label","ariaLabel"],type:"type",dialogResult:[Y.None,"mat-dialog-close","dialogResult"],_matDialogClose:[Y.None,"matDialogClose","_matDialogClose"]},exportAs:["matDialogClose"],standalone:!0,features:[sr]});let n=t;return n})(),LA=(()=>{let t=class t{constructor(i,r,s){this._dialogRef=i,this._elementRef=r,this._dialog=s,this.id=`mat-mdc-dialog-title-${nw++}`}ngOnInit(){this._dialogRef||(this._dialogRef=qm(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)})}ngOnDestroy(){let i=this._dialogRef?._containerInstance;i&&Promise.resolve().then(()=>{i._removeAriaLabelledBy?.(this.id)})}};t.\u0275fac=function(r){return new(r||t)(B(pr,8),B(Kt),B(Lc))},t.\u0275dir=$t({type:t,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(r,s){r&2&&fc("id",s.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0});let n=t;return n})(),BA=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=$t({type:t,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let n=t;return n})(),qA=(()=>{let t=class t{constructor(){this.align="start"}};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=$t({type:t,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:4,hostBindings:function(r,s){r&2&&Ns("mat-mdc-dialog-actions-align-center",s.align==="center")("mat-mdc-dialog-actions-align-end",s.align==="end")},inputs:{align:"align"},standalone:!0});let n=t;return n})();function qm(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("mat-mdc-dialog-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}var UA=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({providers:[Lc],imports:[Nm,si,Ve,ii,ii]});let n=t;return n})();function iw(n,t){if(n&1){let e=Uf();fn(0,"div",1)(1,"button",2),Os("click",function(){Mf(e);let r=mc();return Lf(r.action())}),gc(2),Ue()()}if(n&2){let e=mc();Hn(2),pc(" ",e.data.action," ")}}var rw=["label"];function sw(n,t){}var ow=Math.pow(2,31)-1,_r=class{constructor(t,e){this._overlayRef=e,this._afterDismissed=new H,this._afterOpened=new H,this._onAction=new H,this._dismissedByAction=!1,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,ow))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},Um=new Et("MatSnackBarData"),oi=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},aw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=$t({type:t,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let n=t;return n})(),cw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=$t({type:t,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let n=t;return n})(),lw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=$t({type:t,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let n=t;return n})(),zm=(()=>{let t=class t{constructor(i,r){this.snackBarRef=i,this.data=r}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};t.\u0275fac=function(r){return new(r||t)(B(_r),B(Um))},t.\u0275cmp=qe({type:t,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[ze],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(r,s){r&1&&(fn(0,"div",0),gc(1),Ue(),hn(2,iw,3,1,"div",1)),r&2&&(Hn(),pc(" ",s.data.message,`
`),Hn(),qf(2,s.hasAction?2:-1))},dependencies:[hm,aw,cw,lw],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let n=t;return n})(),uw={snackBarState:um("state",[Ec("void, hidden",Gs({transform:"scale(0.8)",opacity:0})),Ec("visible",Gs({transform:"scale(1)",opacity:1})),Ic("* => visible",wc("150ms cubic-bezier(0, 0, 0.2, 1)")),Ic("* => void, * => hidden",wc("75ms cubic-bezier(0.4, 0.0, 1, 1)",Gs({opacity:0})))])},hw=0,dw=(()=>{let t=class t extends qs{constructor(i,r,s,o,a){super(),this._ngZone=i,this._elementRef=r,this._changeDetectorRef=s,this._platform=o,this.snackBarConfig=a,this._document=le(It),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new H,this._onExit=new H,this._onEnter=new H,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${hw++}`,this.attachDomPortal=c=>{this._assertNotAttached();let l=this._portalOutlet.attachDomPortal(c);return this._afterPortalAttached(),l},a.politeness==="assertive"&&!a.announcementMessage?this._live="assertive":a.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(i){this._assertNotAttached();let r=this._portalOutlet.attachComponentPortal(i);return this._afterPortalAttached(),r}attachTemplatePortal(i){this._assertNotAttached();let r=this._portalOutlet.attachTemplatePortal(i);return this._afterPortalAttached(),r}onAnimationEnd(i){let{fromState:r,toState:s}=i;if((s==="void"&&r!=="void"||s==="hidden")&&this._completeExit(),s==="visible"){let o=this._onEnter;this._ngZone.run(()=>{o.next(),o.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let i=this._elementRef.nativeElement,r=this.snackBarConfig.panelClass;r&&(Array.isArray(r)?r.forEach(a=>i.classList.add(a)):i.classList.add(r)),this._exposeToModals();let s=this._label.nativeElement,o="mdc-snackbar__label";s.classList.toggle(o,!s.querySelector(`.${o}`))}_exposeToModals(){let i=this._liveElementId,r=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let s=0;s<r.length;s++){let o=r[s],a=o.getAttribute("aria-owns");this._trackedModals.add(o),a?a.indexOf(i)===-1&&o.setAttribute("aria-owns",a+" "+i):o.setAttribute("aria-owns",i)}}_clearFromModals(){this._trackedModals.forEach(i=>{let r=i.getAttribute("aria-owns");if(r){let s=r.replace(this._liveElementId,"").trim();s.length>0?i.setAttribute("aria-owns",s):i.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let i=this._elementRef.nativeElement.querySelector("[aria-hidden]"),r=this._elementRef.nativeElement.querySelector("[aria-live]");if(i&&r){let s=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(s=document.activeElement),i.removeAttribute("aria-hidden"),r.appendChild(i),s?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};t.\u0275fac=function(r){return new(r||t)(B(Ct),B(Kt),B(cr),B(ee),B(oi))},t.\u0275cmp=qe({type:t,selectors:[["mat-snack-bar-container"]],viewQuery:function(r,s){if(r&1&&(Yn(je,7),Yn(rw,7)),r&2){let o;Xn(o=Jn())&&(s._portalOutlet=o.first),Xn(o=Jn())&&(s._label=o.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(r,s){r&1&&jf("@state.done",function(a){return s.onAnimationEnd(a)}),r&2&&zf("@state",s._animationState)},standalone:!0,features:[un,ze],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(r,s){r&1&&(fn(0,"div",0)(1,"div",1,2)(3,"div",3),hn(4,sw,0,0,"ng-template",4),Ue(),dc(5,"div"),Ue()()),r&2&&(Hn(5),dn("aria-live",s._live)("role",s._role)("id",s._liveElementId))},dependencies:[je],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[uw.snackBarState]}});let n=t;return n})();function fw(){return new oi}var mw=new Et("mat-snack-bar-default-options",{providedIn:"root",factory:fw}),gw=(()=>{let t=class t{get _openedSnackBarRef(){let i=this._parentSnackBar;return i?i._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(i){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=i:this._snackBarRefAtThisLevel=i}constructor(i,r,s,o,a,c){this._overlay=i,this._live=r,this._injector=s,this._breakpointObserver=o,this._parentSnackBar=a,this._defaultConfig=c,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=zm,this.snackBarContainerComponent=dw,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(i,r){return this._attach(i,r)}openFromTemplate(i,r){return this._attach(i,r)}open(i,r="",s){let o=ft(ft({},this._defaultConfig),s);return o.data={message:i,action:r},o.announcementMessage===i&&(o.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,o)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(i,r){let s=r&&r.viewContainerRef&&r.viewContainerRef.injector,o=St.create({parent:s||this._injector,providers:[{provide:oi,useValue:r}]}),a=new ti(this.snackBarContainerComponent,r.viewContainerRef,o),c=i.attach(a);return c.instance.snackBarConfig=r,c.instance}_attach(i,r){let s=ft(ft(ft({},new oi),this._defaultConfig),r),o=this._createOverlay(s),a=this._attachSnackBarContainer(o,s),c=new _r(a,o);if(i instanceof mn){let l=new ei(i,null,{$implicit:s.data,snackBarRef:c});c.instance=a.attachTemplatePortal(l)}else{let l=this._createInjector(s,c),u=new ti(i,void 0,l),h=a.attachComponentPortal(u);c.instance=h.instance}return this._breakpointObserver.observe(am.HandsetPortrait).pipe(rr(o.detachments())).subscribe(l=>{o.overlayElement.classList.toggle(this.handsetCssClass,l.matches)}),s.announcementMessage&&a._onAnnounce.subscribe(()=>{this._live.announce(s.announcementMessage,s.politeness)}),this._animateSnackBar(c,s),this._openedSnackBarRef=c,this._openedSnackBarRef}_animateSnackBar(i,r){i.afterDismissed().subscribe(()=>{this._openedSnackBarRef==i&&(this._openedSnackBarRef=null),r.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{i.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):i.containerInstance.enter(),r.duration&&r.duration>0&&i.afterOpened().subscribe(()=>i._dismissAfter(r.duration))}_createOverlay(i){let r=new Ge;r.direction=i.direction;let s=this._overlay.position().global(),o=i.direction==="rtl",a=i.horizontalPosition==="left"||i.horizontalPosition==="start"&&!o||i.horizontalPosition==="end"&&o,c=!a&&i.horizontalPosition!=="center";return a?s.left("0"):c?s.right("0"):s.centerHorizontally(),i.verticalPosition==="top"?s.top("0"):s.bottom("0"),r.positionStrategy=s,this._overlay.create(r)}_createInjector(i,r){let s=i&&i.viewContainerRef&&i.viewContainerRef.injector;return St.create({parent:s||this._injector,providers:[{provide:_r,useValue:r},{provide:Um,useValue:i.data}]})}};t.\u0275fac=function(r){return new(r||t)(S(Bt),S(cm),S(St),S(om),S(t,12),S(mw))},t.\u0275prov=wt({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var hS=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Gt({type:t}),t.\u0275inj=jt({providers:[gw],imports:[si,Ve,dm,ii,zm,ii]});let n=t;return n})();var pw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ie={},I,ol=ol||{},k=pw||self;function co(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function Pr(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function _w(n){return Object.prototype.hasOwnProperty.call(n,Bc)&&n[Bc]||(n[Bc]=++yw)}var Bc="closure_uid_"+(1e9*Math.random()>>>0),yw=0;function vw(n,t,e){return n.call.apply(n.bind,arguments)}function ww(n,t,e){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(t,r)}}return function(){return n.apply(t,arguments)}}function Rt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Rt=vw:Rt=ww,Rt.apply(null,arguments)}function Hs(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var i=e.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function _t(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[r].apply(i,o)}}function $e(){this.s=this.s,this.o=this.o}var Ew=0;$e.prototype.s=!1;$e.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Ew!=0)&&_w(this)};$e.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var eg=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function al(n){let t=n.length;if(0<t){let e=Array(t);for(let i=0;i<t;i++)e[i]=n[i];return e}return[]}function jm(n,t){for(let e=1;e<arguments.length;e++){let i=arguments[e];if(co(i)){let r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function xt(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}xt.prototype.h=function(){this.defaultPrevented=!0};var Iw=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};k.addEventListener("test",e,t),k.removeEventListener("test",e,t)}catch{}return n}();function Tr(n){return/^[\s\xa0]*$/.test(n)}function lo(){var n=k.navigator;return n&&(n=n.userAgent)?n:""}function ue(n){return lo().indexOf(n)!=-1}function cl(n){return cl[" "](n),n}cl[" "]=function(){};function Tw(n,t){var e=hE;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var bw=ue("Opera"),ui=ue("Trident")||ue("MSIE"),ng=ue("Edge"),Gc=ng||ui,ig=ue("Gecko")&&!(lo().toLowerCase().indexOf("webkit")!=-1&&!ue("Edge"))&&!(ue("Trident")||ue("MSIE"))&&!ue("Edge"),Aw=lo().toLowerCase().indexOf("webkit")!=-1&&!ue("Edge");function rg(){var n=k.document;return n?n.documentMode:void 0}var $c;t:{if(Ys="",Xs=function(){var n=lo();if(ig)return/rv:([^\);]+)(\)|;)/.exec(n);if(ng)return/Edge\/([\d\.]+)/.exec(n);if(ui)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Aw)return/WebKit\/(\S+)/.exec(n);if(bw)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Xs&&(Ys=Xs?Xs[1]:""),ui&&(Js=rg(),Js!=null&&Js>parseFloat(Ys))){$c=String(Js);break t}$c=Ys}var Ys,Xs,Js,Kc;k.document&&ui?(qc=rg(),Kc=qc||parseInt($c,10)||void 0):Kc=void 0;var qc,Sw=Kc;function br(n,t){if(xt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(ig){t:{try{cl(t.nodeName);var r=!0;break t}catch{}r=!1}r||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Cw[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&br.$.h.call(this)}}_t(br,xt);var Cw={2:"touch",3:"pen",4:"mouse"};br.prototype.h=function(){br.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Vr="closure_listenable_"+(1e6*Math.random()|0),Rw=0;function xw(n,t,e,i,r){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!i,this.la=r,this.key=++Rw,this.fa=this.ia=!1}function uo(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function ll(n,t,e){for(let i in n)t.call(e,n[i],i,n)}function Dw(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function sg(n){let t={};for(let e in n)t[e]=n[e];return t}var Gm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function og(n,t){let e,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(e in i)n[e]=i[e];for(let s=0;s<Gm.length;s++)e=Gm[s],Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}}function ho(n){this.src=n,this.g={},this.h=0}ho.prototype.add=function(n,t,e,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Wc(n,t,i,r);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new xw(t,this.src,s,!!i,r),t.ia=e,n.push(t)),t};function Qc(n,t){var e=t.type;if(e in n.g){var i=n.g[e],r=eg(i,t),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(uo(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function Wc(n,t,e,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==i)return r}return-1}var ul="closure_lm_"+(1e6*Math.random()|0),Uc={};function ag(n,t,e,i,r){if(i&&i.once)return lg(n,t,e,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ag(n,t[s],e,i,r);return null}return e=fl(e),n&&n[Vr]?n.O(t,e,Pr(i)?!!i.capture:!!i,r):cg(n,t,e,!1,i,r)}function cg(n,t,e,i,r,s){if(!t)throw Error("Invalid event type");var o=Pr(r)?!!r.capture:!!r,a=dl(n);if(a||(n[ul]=a=new ho(n)),e=a.add(t,e,i,o,s),e.proxy)return e;if(i=Pw(),e.proxy=i,i.src=n,i.listener=e,n.addEventListener)Iw||(r=o),r===void 0&&(r=!1),n.addEventListener(t.toString(),i,r);else if(n.attachEvent)n.attachEvent(hg(t.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return e}function Pw(){function n(e){return t.call(n.src,n.listener,e)}let t=Vw;return n}function lg(n,t,e,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)lg(n,t[s],e,i,r);return null}return e=fl(e),n&&n[Vr]?n.P(t,e,Pr(i)?!!i.capture:!!i,r):cg(n,t,e,!0,i,r)}function ug(n,t,e,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)ug(n,t[s],e,i,r);else i=Pr(i)?!!i.capture:!!i,e=fl(e),n&&n[Vr]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=Wc(s,e,i,r),-1<e&&(uo(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=dl(n))&&(t=n.g[t.toString()],n=-1,t&&(n=Wc(t,e,i,r)),(e=-1<n?t[n]:null)&&hl(e))}function hl(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[Vr])Qc(t.i,n);else{var e=n.type,i=n.proxy;t.removeEventListener?t.removeEventListener(e,i,n.capture):t.detachEvent?t.detachEvent(hg(e),i):t.addListener&&t.removeListener&&t.removeListener(i),(e=dl(t))?(Qc(e,n),e.h==0&&(e.src=null,t[ul]=null)):uo(n)}}}function hg(n){return n in Uc?Uc[n]:Uc[n]="on"+n}function Vw(n,t){if(n.fa)n=!0;else{t=new br(t,this);var e=n.listener,i=n.la||n.src;n.ia&&hl(n),n=e.call(i,t)}return n}function dl(n){return n=n[ul],n instanceof ho?n:null}var zc="__closure_events_fn_"+(1e9*Math.random()>>>0);function fl(n){return typeof n=="function"?n:(n[zc]||(n[zc]=function(t){return n.handleEvent(t)}),n[zc])}function pt(){$e.call(this),this.i=new ho(this),this.S=this,this.J=null}_t(pt,$e);pt.prototype[Vr]=!0;pt.prototype.removeEventListener=function(n,t,e,i){ug(this,n,t,e,i)};function bt(n,t){var e,i=n.J;if(i)for(e=[];i;i=i.J)e.push(i);if(n=n.S,i=t.type||t,typeof t=="string")t=new xt(t,n);else if(t instanceof xt)t.target=t.target||n;else{var r=t;t=new xt(i,n),og(t,r)}if(r=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];r=Zs(o,i,!0,t)&&r}if(o=t.g=n,r=Zs(o,i,!0,t)&&r,r=Zs(o,i,!1,t)&&r,e)for(s=0;s<e.length;s++)o=t.g=e[s],r=Zs(o,i,!1,t)&&r}pt.prototype.N=function(){if(pt.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],i=0;i<e.length;i++)uo(e[i]);delete n.g[t],n.h--}}this.J=null};pt.prototype.O=function(n,t,e,i){return this.i.add(String(n),t,!1,e,i)};pt.prototype.P=function(n,t,e,i){return this.i.add(String(n),t,!0,e,i)};function Zs(n,t,e,i){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,c=o.la||o.src;o.ia&&Qc(n.i,o),r=a.call(c,i)!==!1&&r}}return r&&!i.defaultPrevented}var ml=k.JSON.stringify,Hc=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function kw(){var n=gl;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var Yc=class{constructor(){this.h=this.g=null}add(t,e){let i=dg.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}},dg=new Hc(()=>new Xc,n=>n.reset()),Xc=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function Nw(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function Ow(n){k.setTimeout(()=>{throw n},0)}var Ar,Sr=!1,gl=new Yc,fg=()=>{let n=k.Promise.resolve(void 0);Ar=()=>{n.then(Fw)}},Fw=()=>{for(var n;n=kw();){try{n.h.call(n.g)}catch(e){Ow(e)}var t=dg;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Sr=!1};function fo(n,t){pt.call(this),this.h=n||1,this.g=t||k,this.j=Rt(this.qb,this),this.l=Date.now()}_t(fo,pt);I=fo.prototype;I.ga=!1;I.T=null;I.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),bt(this,"tick"),this.ga&&(pl(this),this.start()))}};I.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function pl(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}I.N=function(){fo.$.N.call(this),pl(this),delete this.g};function _l(n,t,e){if(typeof n=="function")e&&(n=Rt(n,e));else if(n&&typeof n.handleEvent=="function")n=Rt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:k.setTimeout(n,t||0)}function mg(n){n.g=_l(()=>{n.g=null,n.i&&(n.i=!1,mg(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var Jc=class extends $e{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:mg(this)}N(){super.N(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Cr(n){$e.call(this),this.h=n,this.g={}}_t(Cr,$e);var $m=[];function gg(n,t,e,i){Array.isArray(e)||(e&&($m[0]=e.toString()),e=$m);for(var r=0;r<e.length;r++){var s=ag(t,e[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function pg(n){ll(n.g,function(t,e){this.g.hasOwnProperty(e)&&hl(t)},n),n.g={}}Cr.prototype.N=function(){Cr.$.N.call(this),pg(this)};Cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function mo(){this.g=!0}mo.prototype.Ea=function(){this.g=!1};function Mw(n,t,e,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+`
`+e+`
`+o})}function Lw(n,t,e,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+`
`+e+`
`+s+" "+o})}function ci(n,t,e,i){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+qw(n,e)+(i?" "+i:"")})}function Bw(n,t){n.info(function(){return"TIMEOUT: "+t})}mo.prototype.info=function(){};function qw(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var i=e[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return ml(e)}catch{return t}}var En={},Km=null;function go(){return Km=Km||new pt}En.Ta="serverreachability";function _g(n){xt.call(this,En.Ta,n)}_t(_g,xt);function Rr(n){let t=go();bt(t,new _g(t))}En.STAT_EVENT="statevent";function yg(n,t){xt.call(this,En.STAT_EVENT,n),this.stat=t}_t(yg,xt);function Ft(n){let t=go();bt(t,new yg(t,n))}En.Ua="timingevent";function vg(n,t){xt.call(this,En.Ua,n),this.size=t}_t(vg,xt);function kr(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){n()},t)}var po={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},wg={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function yl(){}yl.prototype.h=null;function Qm(n){return n.h||(n.h=n.i())}function Eg(){}var Nr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function vl(){xt.call(this,"d")}_t(vl,xt);function wl(){xt.call(this,"c")}_t(wl,xt);var Zc;function _o(){}_t(_o,yl);_o.prototype.g=function(){return new XMLHttpRequest};_o.prototype.i=function(){return{}};Zc=new _o;function Or(n,t,e,i){this.l=n,this.j=t,this.m=e,this.W=i||1,this.U=new Cr(this),this.P=Uw,n=Gc?125:void 0,this.V=new fo(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ig}function Ig(){this.i=null,this.g="",this.h=!1}var Uw=45e3,Tg={},tl={};I=Or.prototype;I.setTimeout=function(n){this.P=n};function el(n,t,e){n.L=1,n.A=vo(Oe(t)),n.u=e,n.S=!0,bg(n,null)}function bg(n,t){n.G=Date.now(),Fr(n),n.B=Oe(n.A);var e=n.B,i=n.W;Array.isArray(i)||(i=[String(i)]),Vg(e.i,"t",i),n.o=0,e=n.l.J,n.h=new Ig,n.g=Zg(n.l,e?t:null,!n.u),0<n.O&&(n.M=new Jc(Rt(n.Pa,n,n.g),n.O)),gg(n.U,n.g,"readystatechange",n.nb),t=n.I?sg(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Rr(),Mw(n.j,n.v,n.B,n.m,n.W,n.u)}I.nb=function(n){n=n.target;let t=this.M;t&&he(n)==3?t.l():this.Pa(n)};I.Pa=function(n){try{if(n==this.g)t:{let u=he(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||Gc||this.g&&(this.h.h||this.g.ja()||Xm(this.g)))){this.J||u!=4||t==7||(t==8||0>=h?Rr(3):Rr(2)),yo(this);var e=this.g.da();this.ca=e;e:if(Ag(this)){var i=Xm(this.g);n="";var r=i.length,s=he(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){yn(this),Ir(this);var o="";break e}this.h.i=new k.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,n+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,Lw(this.j,this.v,this.B,this.m,this.W,u,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Tr(a)){var l=a;break e}}l=null}if(e=l)ci(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nl(this,e);else{this.i=!1,this.s=3,Ft(12),yn(this),Ir(this);break t}}this.S?(Sg(this,u,o),Gc&&this.i&&u==3&&(gg(this.U,this.V,"tick",this.mb),this.V.start())):(ci(this.j,this.m,o,null),nl(this,o)),u==4&&yn(this),this.i&&!this.J&&(u==4?Hg(this.l,this):(this.i=!1,Fr(this)))}else cE(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ft(12)):(this.s=0,Ft(13)),yn(this),Ir(this)}}}catch{}finally{}};function Ag(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Sg(n,t,e){let i=!0,r;for(;!n.J&&n.o<e.length;)if(r=zw(n,e),r==tl){t==4&&(n.s=4,Ft(14),i=!1),ci(n.j,n.m,null,"[Incomplete Response]");break}else if(r==Tg){n.s=4,Ft(15),ci(n.j,n.m,e,"[Invalid Chunk]"),i=!1;break}else ci(n.j,n.m,r,null),nl(n,r);Ag(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,Ft(16),i=!1),n.i=n.i&&i,i?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Sl(t),t.M=!0,Ft(11))):(ci(n.j,n.m,e,"[Invalid Chunked Response]"),yn(n),Ir(n))}I.mb=function(){if(this.g){var n=he(this.g),t=this.g.ja();this.o<t.length&&(yo(this),Sg(this,n,t),this.i&&n!=4&&Fr(this))}};function zw(n,t){var e=n.o,i=t.indexOf(`
`,e);return i==-1?tl:(e=Number(t.substring(e,i)),isNaN(e)?Tg:(i+=1,i+e>t.length?tl:(t=t.slice(i,i+e),n.o=i+e,t)))}I.cancel=function(){this.J=!0,yn(this)};function Fr(n){n.Y=Date.now()+n.P,Cg(n,n.P)}function Cg(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=kr(Rt(n.lb,n),t)}function yo(n){n.C&&(k.clearTimeout(n.C),n.C=null)}I.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(Bw(this.j,this.B),this.L!=2&&(Rr(),Ft(17)),yn(this),this.s=2,Ir(this)):Cg(this,this.Y-n)};function Ir(n){n.l.H==0||n.J||Hg(n.l,n)}function yn(n){yo(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,pl(n.V),pg(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function nl(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||il(e.i,n))){if(!n.K&&il(e.i,n)&&e.H==3){try{var i=e.Ja.g.parse(t)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)ro(e),Io(e);else break t;Al(e),Ft(18)}}else e.Fa=r[1],0<e.Fa-e.V&&37500>r[2]&&e.G&&e.A==0&&!e.v&&(e.v=kr(Rt(e.ib,e),6e3));if(1>=Og(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else vn(e,11)}else if((n.K||e.g==n)&&ro(e),!Tr(t))for(r=e.Ja.g.parse(t),t=0;t<r.length;t++){let l=r[t];if(e.V=l[0],l=l[1],e.H==2)if(l[0]=="c"){e.K=l[1],e.pa=l[2];let u=l[3];u!=null&&(e.ra=u,e.l.info("VER="+e.ra));let h=l[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,e.L=i,e.l.info("backChannelRequestTimeoutMs_="+i)),i=e;let f=n.g;if(f){let y=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=i.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(El(s,s.h),s.h=null))}if(i.F){let v=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(i.Da=v,tt(i.I,i.F,v))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),i=e;var o=n;if(i.wa=Jg(i,i.J?i.pa:null,i.Y),o.K){Fg(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.C&&(yo(a),Fr(a)),i.g=o}else Qg(i);0<e.j.length&&To(e)}else l[0]!="stop"&&l[0]!="close"||vn(e,7);else e.H==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?vn(e,7):bl(e):l[0]!="noop"&&e.h&&e.h.Aa(l),e.A=0)}}Rr(4)}catch{}}function jw(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(co(n)){for(var t=[],e=n.length,i=0;i<e;i++)t.push(n[i]);return t}t=[],e=0;for(i in n)t[e++]=n[i];return t}function Gw(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(co(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let i in n)t[e++]=i;return t}}}function Rg(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(co(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=Gw(n),i=jw(n),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],e&&e[s],n)}var xg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $w(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var i=n[e].indexOf("="),r=null;if(0<=i){var s=n[e].substring(0,i);r=n[e].substring(i+1)}else s=n[e];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function wn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof wn){this.h=n.h,no(this,n.j),this.s=n.s,this.g=n.g,io(this,n.m),this.l=n.l;var t=n.i,e=new xr;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Wm(this,e),this.o=n.o}else n&&(t=String(n).match(xg))?(this.h=!1,no(this,t[1]||"",!0),this.s=wr(t[2]||""),this.g=wr(t[3]||"",!0),io(this,t[4]),this.l=wr(t[5]||"",!0),Wm(this,t[6]||"",!0),this.o=wr(t[7]||"")):(this.h=!1,this.i=new xr(null,this.h))}wn.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Er(t,Hm,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Er(t,Hm,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Er(e,e.charAt(0)=="/"?Ww:Qw,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Er(e,Yw)),n.join("")};function Oe(n){return new wn(n)}function no(n,t,e){n.j=e?wr(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function io(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Wm(n,t,e){t instanceof xr?(n.i=t,Xw(n.i,n.h)):(e||(t=Er(t,Hw)),n.i=new xr(t,n.h))}function tt(n,t,e){n.i.set(t,e)}function vo(n){return tt(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function wr(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Er(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,Kw),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Kw(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Hm=/[#\/\?@]/g,Qw=/[#\?:]/g,Ww=/[#\?]/g,Hw=/[#\?@]/g,Yw=/#/g;function xr(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function Ke(n){n.g||(n.g=new Map,n.h=0,n.i&&$w(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}I=xr.prototype;I.add=function(n,t){Ke(this),this.i=null,n=hi(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function Dg(n,t){Ke(n),t=hi(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function Pg(n,t){return Ke(n),t=hi(n,t),n.g.has(t)}I.forEach=function(n,t){Ke(this),this.g.forEach(function(e,i){e.forEach(function(r){n.call(t,r,i,this)},this)},this)};I.ta=function(){Ke(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let i=0;i<t.length;i++){let r=n[i];for(let s=0;s<r.length;s++)e.push(t[i])}return e};I.Z=function(n){Ke(this);let t=[];if(typeof n=="string")Pg(this,n)&&(t=t.concat(this.g.get(hi(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};I.set=function(n,t){return Ke(this),this.i=null,n=hi(this,n),Pg(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};I.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function Vg(n,t,e){Dg(n,t),0<e.length&&(n.i=null,n.g.set(hi(n,t),al(e)),n.h+=e.length)}I.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var i=t[e];let s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;o[i]!==""&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};function hi(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function Xw(n,t){t&&!n.j&&(Ke(n),n.i=null,n.g.forEach(function(e,i){var r=i.toLowerCase();i!=r&&(Dg(this,i),Vg(this,r,e))},n)),n.j=t}var Jw=class{constructor(n,t){this.g=n,this.map=t}};function kg(n){this.l=n||Zw,k.PerformanceNavigationTiming?(n=k.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Zw=10;function Ng(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Og(n){return n.h?1:n.g?n.g.size:0}function il(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function El(n,t){n.g?n.g.add(t):n.h=t}function Fg(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}kg.prototype.cancel=function(){if(this.i=Mg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Mg(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return al(n.i)}var tE=class{stringify(n){return k.JSON.stringify(n,void 0)}parse(n){return k.JSON.parse(n,void 0)}};function eE(){this.g=new tE}function nE(n,t,e){let i=e||"";try{Rg(n,function(r,s){let o=r;Pr(r)&&(o=ml(r)),t.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function iE(n,t){let e=new mo;if(k.Image){let i=new Image;i.onload=Hs(to,e,i,"TestLoadImage: loaded",!0,t),i.onerror=Hs(to,e,i,"TestLoadImage: error",!1,t),i.onabort=Hs(to,e,i,"TestLoadImage: abort",!1,t),i.ontimeout=Hs(to,e,i,"TestLoadImage: timeout",!1,t),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else t(!1)}function to(n,t,e,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch{}}function Mr(n){this.l=n.ec||null,this.j=n.ob||!1}_t(Mr,yl);Mr.prototype.g=function(){return new wo(this.l,this.j)};Mr.prototype.i=function(n){return function(){return n}}({});function wo(n,t){pt.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=Il,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_t(wo,pt);var Il=0;I=wo.prototype;I.open=function(n,t){if(this.readyState!=Il)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Dr(this)};I.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||k).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Lr(this)),this.readyState=Il};I.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Dr(this)),this.g&&(this.readyState=3,Dr(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof k.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Lg(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function Lg(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}I.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Lr(this):Dr(this),this.readyState==3&&Lg(this)}};I.Za=function(n){this.g&&(this.response=this.responseText=n,Lr(this))};I.Ya=function(n){this.g&&(this.response=n,Lr(this))};I.ka=function(){this.g&&Lr(this)};function Lr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Dr(n)}I.setRequestHeader=function(n,t){this.v.append(n,t)};I.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};I.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function Dr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(wo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var rE=k.JSON.parse;function nt(n){pt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Bg,this.L=this.M=!1}_t(nt,pt);var Bg="",sE=/^https?$/i,oE=["POST","PUT"];I=nt.prototype;I.Oa=function(n){this.M=n};I.ha=function(n,t,e,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Zc.g(),this.C=this.u?Qm(this.u):Qm(Zc),this.g.onreadystatechange=Rt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){Ym(this,s);return}if(n=e||"",e=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)e.set(r,i[r]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(let s of i.keys())e.set(s,i.get(s));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),r=k.FormData&&n instanceof k.FormData,!(0<=eg(oE,t))||i||r||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zg(this),0<this.B&&((this.L=aE(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Rt(this.ua,this)):this.A=_l(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ym(this,s)}};function aE(n){return ui&&typeof n.timeout=="number"&&n.ontimeout!==void 0}I.ua=function(){typeof ol<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bt(this,"timeout"),this.abort(8))};function Ym(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,qg(n),Eo(n)}function qg(n){n.F||(n.F=!0,bt(n,"complete"),bt(n,"error"))}I.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,bt(this,"complete"),bt(this,"abort"),Eo(this))};I.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Eo(this,!0)),nt.$.N.call(this)};I.La=function(){this.s||(this.G||this.v||this.l?Ug(this):this.kb())};I.kb=function(){Ug(this)};function Ug(n){if(n.h&&typeof ol<"u"&&(!n.C[1]||he(n)!=4||n.da()!=2)){if(n.v&&he(n)==4)_l(n.La,0,n);else if(bt(n,"readystatechange"),he(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var i;if(i=o===0){var r=String(n.I).match(xg)[1]||null;!r&&k.self&&k.self.location&&(r=k.self.location.protocol.slice(0,-1)),i=!sE.test(r?r.toLowerCase():"")}e=i}if(e)bt(n,"complete"),bt(n,"success");else{n.m=6;try{var s=2<he(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",qg(n)}}finally{Eo(n)}}}}function Eo(n,t){if(n.g){zg(n);let e=n.g,i=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||bt(n,"ready");try{e.onreadystatechange=i}catch{}}}function zg(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(k.clearTimeout(n.A),n.A=null)}I.isActive=function(){return!!this.g};function he(n){return n.g?n.g.readyState:0}I.da=function(){try{return 2<he(this)?this.g.status:-1}catch{return-1}};I.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};I.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),rE(t)}};function Xm(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Bg:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function cE(n){let t={};n=(n.g&&2<=he(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let i=0;i<n.length;i++){if(Tr(n[i]))continue;var e=Nw(n[i]);let r=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[r]||[];t[r]=s,s.push(e)}Dw(t,function(i){return i.join(", ")})}I.Ia=function(){return this.m};I.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function jg(n){let t="";return ll(n,function(e,i){t+=i,t+=":",t+=e,t+=`\r
`}),t}function Tl(n,t,e){t:{for(i in e){var i=!1;break t}i=!0}i||(e=jg(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):tt(n,t,e))}function yr(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function Gg(n){this.Ga=0,this.j=[],this.l=new mo,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=yr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=yr("baseRetryDelayMs",5e3,n),this.hb=yr("retryDelaySeedMs",1e4,n),this.eb=yr("forwardChannelMaxRetries",2,n),this.xa=yr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new kg(n&&n.concurrentRequestLimit),this.Ja=new eE,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}I=Gg.prototype;I.ra=8;I.H=1;function bl(n){if($g(n),n.H==3){var t=n.W++,e=Oe(n.I);if(tt(e,"SID",n.K),tt(e,"RID",t),tt(e,"TYPE","terminate"),Br(n,e),t=new Or(n,n.l,t),t.L=2,t.A=vo(Oe(e)),e=!1,k.navigator&&k.navigator.sendBeacon)try{e=k.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&k.Image&&(new Image().src=t.A,e=!0),e||(t.g=Zg(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Fr(t)}Xg(n)}function Io(n){n.g&&(Sl(n),n.g.cancel(),n.g=null)}function $g(n){Io(n),n.u&&(k.clearTimeout(n.u),n.u=null),ro(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&k.clearTimeout(n.m),n.m=null)}function To(n){if(!Ng(n.i)&&!n.m){n.m=!0;var t=n.Na;Ar||fg(),Sr||(Ar(),Sr=!0),gl.add(t,n),n.C=0}}function lE(n,t){return Og(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=kr(Rt(n.Na,n,t),Yg(n,n.C)),n.C++,!0)}I.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let r=new Or(this,this.l,n),s=this.s;if(this.U&&(s?(s=sg(s),og(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var i=this.j[e];if("__data__"in i.map&&(i=i.map.__data__,typeof i=="string")){i=i.length;break e}i=void 0}if(i===void 0)break;if(t+=i,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=Kg(this,r,t),e=Oe(this.I),tt(e,"RID",n),tt(e,"CVER",22),this.F&&tt(e,"X-HTTP-Session-Id",this.F),Br(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(jg(s)))+"&"+t:this.o&&Tl(e,this.o,s)),El(this.i,r),this.bb&&tt(e,"TYPE","init"),this.P?(tt(e,"$req",t),tt(e,"SID","null"),r.aa=!0,el(r,e,null)):el(r,e,t),this.H=2}}else this.H==3&&(n?Jm(this,n):this.j.length==0||Ng(this.i)||Jm(this))};function Jm(n,t){var e;t?e=t.m:e=n.W++;let i=Oe(n.I);tt(i,"SID",n.K),tt(i,"RID",e),tt(i,"AID",n.V),Br(n,i),n.o&&n.s&&Tl(i,n.o,n.s),e=new Or(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=Kg(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),El(n.i,e),el(e,i,t)}function Br(n,t){n.na&&ll(n.na,function(e,i){tt(t,i,e)}),n.h&&Rg({},function(e,i){tt(t,i,e)})}function Kg(n,t,e){e=Math.min(n.j.length,e);var i=n.h?Rt(n.h.Va,n.h,n):null;t:{var r=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=r[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<e;c++){let l=r[c].g,u=r[c].map;if(l-=s,0>l)s=Math.max(0,r[c].g-100),a=!1;else try{nE(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,i}function Qg(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Ar||fg(),Sr||(Ar(),Sr=!0),gl.add(t,n),n.A=0}}function Al(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=kr(Rt(n.Ma,n),Yg(n,n.A)),n.A++,!0)}I.Ma=function(){if(this.u=null,Wg(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=kr(Rt(this.jb,this),n)}};I.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ft(10),Io(this),Wg(this))};function Sl(n){n.B!=null&&(k.clearTimeout(n.B),n.B=null)}function Wg(n){n.g=new Or(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=Oe(n.wa);tt(t,"RID","rpc"),tt(t,"SID",n.K),tt(t,"AID",n.V),tt(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&tt(t,"TO",n.qa),tt(t,"TYPE","xmlhttp"),Br(n,t),n.o&&n.s&&Tl(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=vo(Oe(t)),e.u=null,e.S=!0,bg(e,n)}I.ib=function(){this.v!=null&&(this.v=null,Io(this),Al(this),Ft(19))};function ro(n){n.v!=null&&(k.clearTimeout(n.v),n.v=null)}function Hg(n,t){var e=null;if(n.g==t){ro(n),Sl(n),n.g=null;var i=2}else if(il(n.i,t))e=t.F,Fg(n.i,t),i=1;else return;if(n.H!=0){if(t.i)if(i==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var r=n.C;i=go(),bt(i,new vg(i,e)),To(n)}else Qg(n);else if(r=t.s,r==3||r==0&&0<t.ca||!(i==1&&lE(n,t)||i==2&&Al(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),r){case 1:vn(n,5);break;case 4:vn(n,10);break;case 3:vn(n,6);break;default:vn(n,2)}}}function Yg(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function vn(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var i=Rt(n.pb,n);e||(e=new wn("//www.google.com/images/cleardot.gif"),k.location&&k.location.protocol=="http"||no(e,"https"),vo(e)),iE(e.toString(),i)}else Ft(2);n.H=0,n.h&&n.h.za(t),Xg(n),$g(n)}I.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ft(2)):(this.l.info("Failed to ping google.com"),Ft(1))};function Xg(n){if(n.H=0,n.ma=[],n.h){let t=Mg(n.i);(t.length!=0||n.j.length!=0)&&(jm(n.ma,t),jm(n.ma,n.j),n.i.i.length=0,al(n.j),n.j.length=0),n.h.ya()}}function Jg(n,t,e){var i=e instanceof wn?Oe(e):new wn(e);if(i.g!="")t&&(i.g=t+"."+i.g),io(i,i.m);else{var r=k.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new wn(null);i&&no(s,i),t&&(s.g=t),r&&io(s,r),e&&(s.l=e),i=s}return e=n.F,t=n.Da,e&&t&&tt(i,e,t),tt(i,"VER",n.ra),Br(n,i),i}function Zg(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new nt(new Mr({ob:e})):new nt(n.va),t.Oa(n.J),t}I.isActive=function(){return!!this.h&&this.h.isActive(this)};function tp(){}I=tp.prototype;I.Ba=function(){};I.Aa=function(){};I.za=function(){};I.ya=function(){};I.isActive=function(){return!0};I.Va=function(){};function so(){if(ui&&!(10<=Number(Sw)))throw Error("Environmental error: no available transport.")}so.prototype.g=function(n,t){return new Wt(n,t)};function Wt(n,t){pt.call(this),this.g=new Gg(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Tr(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Tr(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new di(this)}_t(Wt,pt);Wt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;Ft(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=Jg(n,null,n.Y),To(n)};Wt.prototype.close=function(){bl(this.g)};Wt.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=ml(n),n=e);t.j.push(new Jw(t.fb++,n)),t.H==3&&To(t)};Wt.prototype.N=function(){this.g.h=null,delete this.j,bl(this.g),delete this.g,Wt.$.N.call(this)};function ep(n){vl.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}_t(ep,vl);function np(){wl.call(this),this.status=1}_t(np,wl);function di(n){this.g=n}_t(di,tp);di.prototype.Ba=function(){bt(this.g,"a")};di.prototype.Aa=function(n){bt(this.g,new ep(n))};di.prototype.za=function(n){bt(this.g,new np)};di.prototype.ya=function(){bt(this.g,"b")};function uE(){this.blockSize=-1}function ne(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}_t(ne,uE);ne.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function jc(n,t,e){e||(e=0);var i=Array(16);if(typeof t=="string")for(var r=0;16>r;++r)i[r]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(r=0;16>r;++r)i[r]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],r=n.g[2];var s=n.g[3],o=t+(s^e&(r^s))+i[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[2]+606105819&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[3]+3250441966&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[6]+2821735955&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[7]+4249261313&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[10]+4294925233&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[11]+2304563134&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[14]+2792965006&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[15]+1236535329&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(r^s&(e^r))+i[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[11]+643717713&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[0]+3921069994&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[15]+3634488961&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[4]+3889429448&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[3]+4107603335&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[8]+1163531501&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[7]+1735328473&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[12]+2368359562&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(e^r^s)+i[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[11]+1839030562&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[14]+4259657740&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[7]+4139469664&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[10]+3200236656&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[3]+3572445317&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[6]+76029189&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[15]+530742520&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[2]+3299628645&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(r^(e|~s))+i[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[14]+2878612391&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[5]+4237533241&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[10]+4293915773&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[1]+2240044497&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[6]+2734768916&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[13]+1309151649&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[2]+718787259&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+r&4294967295,n.g[3]=n.g[3]+s&4294967295}ne.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(r==0)for(;s<=e;)jc(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(i[r++]=n.charCodeAt(s++),r==this.blockSize){jc(this,i),r=0;break}}else for(;s<t;)if(i[r++]=n[s++],r==this.blockSize){jc(this,i),r=0;break}}this.h=r,this.i+=t};ne.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var i=0;32>i;i+=8)n[e++]=this.g[t]>>>i&255;return n};function W(n,t){this.h=t;for(var e=[],i=!0,r=n.length-1;0<=r;r--){var s=n[r]|0;i&&s==t||(e[r]=s,i=!1)}this.g=e}var hE={};function Cl(n){return-128<=n&&128>n?Tw(n,function(t){return new W([t|0],0>t?-1:0)}):new W([n|0],0>n?-1:0)}function de(n){if(isNaN(n)||!isFinite(n))return li;if(0>n)return Tt(de(-n));for(var t=[],e=1,i=0;n>=e;i++)t[i]=n/e|0,e*=rl;return new W(t,0)}function ip(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return Tt(ip(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=de(Math.pow(t,8)),i=li,r=0;r<n.length;r+=8){var s=Math.min(8,n.length-r),o=parseInt(n.substring(r,r+s),t);8>s?(s=de(Math.pow(t,s)),i=i.R(s).add(de(o))):(i=i.R(e),i=i.add(de(o)))}return i}var rl=4294967296,li=Cl(0),sl=Cl(1),Zm=Cl(16777216);I=W.prototype;I.ea=function(){if(Jt(this))return-Tt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var i=this.D(e);n+=(0<=i?i:rl+i)*t,t*=rl}return n};I.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Ne(this))return"0";if(Jt(this))return"-"+Tt(this).toString(n);for(var t=de(Math.pow(n,6)),e=this,i="";;){var r=ao(e,t).g;e=oo(e,r.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=r,Ne(e))return s+i;for(;6>s.length;)s="0"+s;i=s+i}};I.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Ne(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Jt(n){return n.h==-1}I.X=function(n){return n=oo(this,n),Jt(n)?-1:Ne(n)?0:1};function Tt(n){for(var t=n.g.length,e=[],i=0;i<t;i++)e[i]=~n.g[i];return new W(e,~n.h).add(sl)}I.abs=function(){return Jt(this)?Tt(this):this};I.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0,r=0;r<=t;r++){var s=i+(this.D(r)&65535)+(n.D(r)&65535),o=(s>>>16)+(this.D(r)>>>16)+(n.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,e[r]=o<<16|s}return new W(e,e[e.length-1]&-2147483648?-1:0)};function oo(n,t){return n.add(Tt(t))}I.R=function(n){if(Ne(this)||Ne(n))return li;if(Jt(this))return Jt(n)?Tt(this).R(Tt(n)):Tt(Tt(this).R(n));if(Jt(n))return Tt(this.R(Tt(n)));if(0>this.X(Zm)&&0>n.X(Zm))return de(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],i=0;i<2*t;i++)e[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<n.g.length;r++){var s=this.D(i)>>>16,o=this.D(i)&65535,a=n.D(r)>>>16,c=n.D(r)&65535;e[2*i+2*r]+=o*c,eo(e,2*i+2*r),e[2*i+2*r+1]+=s*c,eo(e,2*i+2*r+1),e[2*i+2*r+1]+=o*a,eo(e,2*i+2*r+1),e[2*i+2*r+2]+=s*a,eo(e,2*i+2*r+2)}for(i=0;i<t;i++)e[i]=e[2*i+1]<<16|e[2*i];for(i=t;i<2*t;i++)e[i]=0;return new W(e,0)};function eo(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function vr(n,t){this.g=n,this.h=t}function ao(n,t){if(Ne(t))throw Error("division by zero");if(Ne(n))return new vr(li,li);if(Jt(n))return t=ao(Tt(n),t),new vr(Tt(t.g),Tt(t.h));if(Jt(t))return t=ao(n,Tt(t)),new vr(Tt(t.g),t.h);if(30<n.g.length){if(Jt(n)||Jt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=sl,i=t;0>=i.X(n);)e=tg(e),i=tg(i);var r=ai(e,1),s=ai(i,1);for(i=ai(i,2),e=ai(e,2);!Ne(i);){var o=s.add(i);0>=o.X(n)&&(r=r.add(e),s=o),i=ai(i,1),e=ai(e,1)}return t=oo(n,r.R(t)),new vr(r,t)}for(r=li;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),i=Math.ceil(Math.log(e)/Math.LN2),i=48>=i?1:Math.pow(2,i-48),s=de(e),o=s.R(t);Jt(o)||0<o.X(n);)e-=i,s=de(e),o=s.R(t);Ne(s)&&(s=sl),r=r.add(s),n=oo(n,o)}return new vr(r,n)}I.gb=function(n){return ao(this,n).h};I.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)&n.D(i);return new W(e,this.h&n.h)};I.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)|n.D(i);return new W(e,this.h|n.h)};I.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)^n.D(i);return new W(e,this.h^n.h)};function tg(n){for(var t=n.g.length+1,e=[],i=0;i<t;i++)e[i]=n.D(i)<<1|n.D(i-1)>>>31;return new W(e,n.h)}function ai(n,t){var e=t>>5;t%=32;for(var i=n.g.length-e,r=[],s=0;s<i;s++)r[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new W(r,n.h)}so.prototype.createWebChannel=so.prototype.g;Wt.prototype.send=Wt.prototype.u;Wt.prototype.open=Wt.prototype.m;Wt.prototype.close=Wt.prototype.close;po.NO_ERROR=0;po.TIMEOUT=8;po.HTTP_ERROR=6;wg.COMPLETE="complete";Eg.EventType=Nr;Nr.OPEN="a";Nr.CLOSE="b";Nr.ERROR="c";Nr.MESSAGE="d";pt.prototype.listen=pt.prototype.O;nt.prototype.listenOnce=nt.prototype.P;nt.prototype.getLastError=nt.prototype.Sa;nt.prototype.getLastErrorCode=nt.prototype.Ia;nt.prototype.getStatus=nt.prototype.da;nt.prototype.getResponseJson=nt.prototype.Wa;nt.prototype.getResponseText=nt.prototype.ja;nt.prototype.send=nt.prototype.ha;nt.prototype.setWithCredentials=nt.prototype.Oa;ne.prototype.digest=ne.prototype.l;ne.prototype.reset=ne.prototype.reset;ne.prototype.update=ne.prototype.j;W.prototype.add=W.prototype.add;W.prototype.multiply=W.prototype.R;W.prototype.modulo=W.prototype.gb;W.prototype.compare=W.prototype.X;W.prototype.toNumber=W.prototype.ea;W.prototype.toString=W.prototype.toString;W.prototype.getBits=W.prototype.D;W.fromNumber=de;W.fromString=ip;var bo=ie.createWebChannelTransport=function(){return new so},Ao=ie.getStatEventTarget=function(){return go()},Qe=ie.ErrorCode=po,So=ie.EventType=wg,Co=ie.Event=En,fi=ie.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},mS=ie.FetchXmlHttpFactory=Mr,fe=ie.WebChannel=Eg,Ro=ie.XhrIo=nt,xo=ie.Md5=ne,qt=ie.Integer=W;var rp="@firebase/firestore";var Pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};Pt.UNAUTHENTICATED=new Pt(null),Pt.GOOGLE_CREDENTIALS=new Pt("google-credentials-uid"),Pt.FIRST_PARTY=new Pt("first-party-uid"),Pt.MOCK_USER=new Pt("mock-user");var Ni="10.8.0";var Rn=new Ms("@firebase/firestore");function qr(){return Rn.logLevel}function T(n,...t){if(Rn.logLevel<=gt.DEBUG){let e=t.map(fh);Rn.debug(`Firestore (${Ni}): ${n}`,...e)}}function we(n,...t){if(Rn.logLevel<=gt.ERROR){let e=t.map(fh);Rn.error(`Firestore (${Ni}): ${n}`,...e)}}function Kr(n,...t){if(Rn.logLevel<=gt.WARN){let e=t.map(fh);Rn.warn(`Firestore (${Ni}): ${n}`,...e)}}function fh(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function P(n="Unexpected state"){let t=`FIRESTORE (${Ni}) INTERNAL ASSERTION FAILED: `+n;throw we(t),new Error(t)}function J(n,t){n||P()}function F(n,t){return n}var w={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends gm{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var pe=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Vl=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},kl=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Pt.UNAUTHENTICATED))}shutdown(){}};var Nl=class{constructor(t){this.t=t,this.currentUser=Pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i,r=c=>this.i!==i?(i=this.i,e(c)):Promise.resolve(),s=new pe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new pe,t.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>m(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{T("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(T("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new pe)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(T("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(J(typeof i.accessToken=="string"),new Vl(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return J(t===null||typeof t=="string"),new Pt(t)}},Ol=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=Pt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Fl=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new Ol(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ml=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ll=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let i=s=>{s.error!=null&&T("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,T("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>i(s))};let r=s=>{T("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):T("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(J(typeof e.token=="string"),this.R=e.token,new Ml(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function fE(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}var Bl=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,i="";for(;i.length<20;){let r=fE(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<e&&(i+=t.charAt(r[s]%t.length))}return i}};function $(n,t){return n<t?-1:n>t?1:0}function wi(n,t,e){return n.length===t.length&&n.every((i,r)=>e(i,t[r]))}var Ht=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(w.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(w.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new n(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var O=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Ht(0,0))}static max(){return new n(new Ht(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Oo=class n{constructor(t,e,i){e===void 0?e=0:e>t.length&&P(),i===void 0?i=t.length-e:i>t.length-e&&P(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let i=Math.min(t.length,e.length);for(let r=0;r<i;r++){let s=t.get(r),o=e.get(r);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},yt=class n extends Oo{construct(t,e,i){return new n(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let i of t){if(i.indexOf("//")>=0)throw new x(w.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(r=>r.length>0))}return new n(e)}static emptyPath(){return new n([])}},mE=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Zt=class n extends Oo{construct(t,e,i){return new n(t,e,i)}static isValidIdentifier(t){return mE.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],i="",r=0,s=()=>{if(i.length===0)throw new x(w.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""},o=!1;for(;r<t.length;){let a=t[r];if(a==="\\"){if(r+1===t.length)throw new x(w.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new x(w.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new x(w.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var V=class n{constructor(t){this.path=t}static fromPath(t){return new n(yt.fromString(t))}static fromName(t){return new n(yt.fromString(t).popFirst(5))}static empty(){return new n(yt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&yt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return yt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new yt(t.slice()))}};var ql=class{constructor(t,e,i,r){this.indexId=t,this.collectionGroup=e,this.fields=i,this.indexState=r}};ql.UNKNOWN_ID=-1;function gE(n,t){let e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=O.fromTimestamp(i===1e9?new Ht(e+1,0):new Ht(e,i));return new xn(r,V.empty(),t)}function pE(n){return new xn(n.readTime,n.key,-1)}var xn=class n{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new n(O.min(),V.empty(),-1)}static max(){return new n(O.max(),V.empty(),-1)}};function _E(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=V.comparator(n.documentKey,t.documentKey),e!==0?e:$(n.largestBatchId,t.largestBatchId))}var yE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ul=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function ts(n){return m(this,null,function*(){if(n.code!==w.FAILED_PRECONDITION||n.message!==yE)throw n;T("LocalStore","Unexpectedly lost primary lease")})}var _=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&P(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(e,s).next(i,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,i)=>{e(t)})}static reject(t){return new n((e,i)=>{i(t)})}static waitFor(t){return new n((e,i)=>{let r=0,s=0,o=!1;t.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&e()},c=>i(c))}),o=!0,s===r&&e()})}static or(t){let e=n.resolve(!1);for(let i of t)e=e.next(r=>r?n.resolve(r):i());return e}static forEach(t,e){let i=[];return t.forEach((r,s)=>{i.push(e.call(this,r,s))}),this.waitFor(i)}static mapArray(t,e){return new n((i,r)=>{let s=t.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let l=c;e(t[l]).next(u=>{o[l]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(t,e){return new n((i,r)=>{let s=()=>{t()===!0?e().next(()=>{s()},r):i()};s()})}};var zl=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new pe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Sn(t,e.error)):this.V.resolve()},this.transaction.onerror=i=>{let r=mh(i.target.error);this.V.reject(new Sn(t,r))}}static open(t,e,i,r){try{return new n(e,t.transaction(r,i))}catch(s){throw new Sn(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Gl(e)}},Fo=class n{constructor(t,e,i){this.name=t,this.version=e,this.p=i,n.S(hr())===12.2&&we("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return T("SimpleDb","Removing database:",t),In(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!mm())return!1;if(n.C())return!0;let t=hr(),e=n.S(t),i=0<e&&e<10,r=n.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static v(t){let e=t.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}O(t){return m(this,null,function*(){return this.db||(T("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;e(o)},r.onblocked=()=>{i(new Sn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new x(w.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new x(w.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Sn(t,o))},r.onupgradeneeded=s=>{T("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,r.transaction,s.oldVersion,this.version).next(()=>{T("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db})}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,i,r){return m(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=zl.open(this.db,t,s?"readonly":"readwrite",i),c=r(a).next(l=>(a.g(),l)).catch(l=>(a.abort(l),_.reject(l))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,l=c.name!=="FirebaseError"&&o<3;if(T("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},jl=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return In(this.k.delete())}},Sn=class extends x{constructor(t,e){super(w.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function es(n){return n.name==="IndexedDbTransactionError"}var Gl=class{constructor(t){this.store=t}put(t,e){let i;return e!==void 0?(T("SimpleDb","PUT",this.store.name,t,e),i=this.store.put(e,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),i=this.store.put(t)),In(i)}add(t){return T("SimpleDb","ADD",this.store.name,t,t),In(this.store.add(t))}get(t){return In(this.store.get(t)).next(e=>(e===void 0&&(e=null),T("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return T("SimpleDb","DELETE",this.store.name,t),In(this.store.delete(t))}count(){return T("SimpleDb","COUNT",this.store.name),In(this.store.count())}W(t,e){let i=this.options(t,e),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new _((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(i),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(t,e){let i=this.store.getAll(t,e===null?void 0:e);return new _((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}H(t,e){T("SimpleDb","DELETE ALL",this.store.name);let i=this.options(t,e);i.J=!1;let r=this.cursor(i);return this.G(r,(s,o,a)=>a.delete())}Y(t,e){let i;e?i=t:(i={},e=t);let r=this.cursor(i);return this.G(r,e)}Z(t){let e=this.cursor({});return new _((i,r)=>{e.onerror=s=>{let o=mh(s.target.error);r(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}G(t,e){let i=[];return new _((r,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let c=new jl(a),l=e(a.primaryKey,a.value,c);if(l instanceof _){let u=l.catch(h=>(c.done(),_.reject(h)));i.push(u)}c.isDone?r():c.$===null?a.continue():a.continue(c.$)}}).next(()=>_.waitFor(i))}options(t,e){let i;return t!==void 0&&(typeof t=="string"?i=t:e=t),{index:i,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let i=this.store.index(t.index);return t.J?i.openKeyCursor(t.range,e):i.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function In(n){return new _((t,e)=>{n.onsuccess=i=>{let r=i.target.result;t(r)},n.onerror=i=>{let r=mh(i.target.error);e(r)}})}var sp=!1;function mh(n){let t=Fo.S(hr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let i=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sp||(sp=!0,setTimeout(()=>{throw i},0)),i}}return n}var kp=(()=>{class n{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=r=>this.se(r),this.oe=r=>i.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function la(n){return n==null}function Mo(n){return n===0&&1/n==-1/0}var vE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],xS=[...vE,"documentOverlays"],wE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],EE=wE,DS=[...EE,"indexConfiguration","indexState","indexEntries"];function op(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ns(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function IE(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var rt=class n{constructor(t,e){this.comparator=t,this.root=e||_e.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,_e.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,_e.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(t,i.key);if(r===0)return e+i.left.size;r<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){let t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new _i(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new _i(this.root,t,this.comparator,!1)}getReverseIterator(){return new _i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new _i(this.root,t,this.comparator,!0)}},_i=class{constructor(t,e,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?i(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},_e=class n{constructor(t,e,i,r,s){this.key=t,this.value=e,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,r,s){return new n(t??this.key,e??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this,s=i(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,i),null):s===0?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),e(t,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw P();let t=this.left.check();if(t!==this.right.check())throw P();return t+(this.isRed()?0:1)}};_e.EMPTY=null,_e.RED=!0,_e.BLACK=!1;_e.EMPTY=new class{constructor(){this.size=0}get key(){throw P()}get value(){throw P()}get color(){throw P()}get left(){throw P()}get right(){throw P()}copy(t,e,i,r,s){return this}insert(t,e,i){return new _e(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Vt=class n{constructor(t){this.comparator=t,this.data=new rt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){let i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Lo(this.data.getIterator())}getIteratorFrom(t){return new Lo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Lo=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var We=class n{constructor(t){this.fields=t,t.sort(Zt.comparator)}static empty(){return new n([])}unionWith(t){let e=new Vt(Zt.comparator);for(let i of this.fields)e=e.add(i);for(let i of t)e=e.add(i);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return wi(this.fields,t.fields,(e,i)=>e.isEqual(i))}};var Bo=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Mt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Bo("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return $(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Mt.EMPTY_BYTE_STRING=new Mt("");var TE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function He(n){if(J(!!n),typeof n=="string"){let t=0,e=TE.exec(n);if(J(!!e),e[1]){let r=e[1];r=(r+"000000000").substr(0,9),t=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:it(n.seconds),nanos:it(n.nanos)}}function it(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ye(n){return typeof n=="string"?Mt.fromBase64String(n):Mt.fromUint8Array(n)}function gh(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function ph(n){let t=n.mapValue.fields.__previous_value__;return gh(t)?ph(t):t}function Qr(n){let t=He(n.mapValue.fields.__local_write_time__.timestampValue);return new Ht(t.seconds,t.nanos)}var $l=class{constructor(t,e,i,r,s,o,a,c,l){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}},qo=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Do={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Dn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gh(n)?4:Np(n)?9007199254740991:10:P()}function Ee(n,t){if(n===t)return!0;let e=Dn(n);if(e!==Dn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Qr(n).isEqual(Qr(t));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=He(r.timestampValue),a=He(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(r,s){return Ye(r.bytesValue).isEqual(Ye(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(r,s){return it(r.geoPointValue.latitude)===it(s.geoPointValue.latitude)&&it(r.geoPointValue.longitude)===it(s.geoPointValue.longitude)}(n,t);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return it(r.integerValue)===it(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=it(r.doubleValue),a=it(s.doubleValue);return o===a?Mo(o)===Mo(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return wi(n.arrayValue.values||[],t.arrayValue.values||[],Ee);case 10:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(op(o)!==op(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Ee(o[c],a[c])))return!1;return!0}(n,t);default:return P()}}function Wr(n,t){return(n.values||[]).find(e=>Ee(e,t))!==void 0}function Ei(n,t){if(n===t)return 0;let e=Dn(n),i=Dn(t);if(e!==i)return $(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=it(s.integerValue||s.doubleValue),c=it(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,t);case 3:return ap(n.timestampValue,t.timestampValue);case 4:return ap(Qr(n),Qr(t));case 5:return $(n.stringValue,t.stringValue);case 6:return function(s,o){let a=Ye(s),c=Ye(o);return a.compareTo(c)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){let u=$(a[l],c[l]);if(u!==0)return u}return $(a.length,c.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=$(it(s.latitude),it(o.latitude));return a!==0?a:$(it(s.longitude),it(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let l=0;l<a.length&&l<c.length;++l){let u=Ei(a[l],c[l]);if(u)return u}return $(a.length,c.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Do.mapValue&&o===Do.mapValue)return 0;if(s===Do.mapValue)return 1;if(o===Do.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let h=0;h<c.length&&h<u.length;++h){let d=$(c[h],u[h]);if(d!==0)return d;let f=Ei(a[c[h]],l[u[h]]);if(f!==0)return f}return $(c.length,u.length)}(n.mapValue,t.mapValue);default:throw P()}}function ap(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return $(n,t);let e=He(n),i=He(t),r=$(e.seconds,i.seconds);return r!==0?r:$(e.nanos,i.nanos)}function Ii(n){return Kl(n)}function Kl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let i=He(e);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Ye(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return V.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let i="[",r=!0;for(let s of e.values||[])r?r=!1:i+=",",i+=Kl(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(e){let i=Object.keys(e.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${Kl(e.fields[o])}`;return r+"}"}(n.mapValue):P()}function Ql(n){return!!n&&"integerValue"in n}function _h(n){return!!n&&"arrayValue"in n}function cp(n){return!!n&&"nullValue"in n}function lp(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Vo(n){return!!n&&"mapValue"in n}function zr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return ns(n.mapValue.fields,(e,i)=>t.mapValue.fields[e]=zr(i)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=zr(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Np(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var ge=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Vo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=zr(e)}setAll(t){let e=Zt.emptyPath(),i={},r=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let c=this.getFieldsMap(e);this.applyChanges(c,i,r),i={},r=[],e=a.popLast()}o?i[a.lastSegment()]=zr(o):r.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,i,r)}delete(t){let e=this.field(t.popLast());Vo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ee(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let r=e.mapValue.fields[t.get(i)];Vo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,i){ns(e,(r,s)=>t[r]=s);for(let r of i)delete t[r]}clone(){return new n(zr(this.value))}};function Op(n){let t=[];return ns(n.fields,(e,i)=>{let r=new Zt([e]);if(Vo(i)){let s=Op(i.mapValue).fields;if(s.length===0)t.push(r);else for(let o of s)t.push(r.child(o))}else t.push(r)}),new We(t)}var re=class n{constructor(t,e,i,r,s,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,O.min(),O.min(),O.min(),ge.empty(),0)}static newFoundDocument(t,e,i,r){return new n(t,1,e,O.min(),i,r,0)}static newNoDocument(t,e){return new n(t,2,e,O.min(),O.min(),ge.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,O.min(),O.min(),ge.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(O.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ge.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ge.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=O.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ti=class{constructor(t,e){this.position=t,this.inclusive=e}};function up(n,t,e){let i=0;for(let r=0;r<n.position.length;r++){let s=t[r],o=n.position[r];if(s.field.isKeyField()?i=V.comparator(V.fromName(o.referenceValue),e.key):i=Ei(o,e.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function hp(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ee(n.position[e],t.position[e]))return!1;return!0}var bi=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function bE(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Uo=class{},mt=class n extends Uo{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new Hl(t,e,i):e==="array-contains"?new Jl(t,i):e==="in"?new Zl(t,i):e==="not-in"?new tu(t,i):e==="array-contains-any"?new eu(t,i):new n(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new Yl(t,i):new Xl(t,i)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ei(e,this.value)):e!==null&&Dn(this.value)===Dn(e)&&this.matchesComparison(Ei(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return P()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ie=class n extends Uo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return Fp(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Fp(n){return n.op==="and"}function Mp(n){return AE(n)&&Fp(n)}function AE(n){for(let t of n.filters)if(t instanceof Ie)return!1;return!0}function Wl(n){if(n instanceof mt)return n.field.canonicalString()+n.op.toString()+Ii(n.value);if(Mp(n))return n.filters.map(t=>Wl(t)).join(",");{let t=n.filters.map(e=>Wl(e)).join(",");return`${n.op}(${t})`}}function Lp(n,t){return n instanceof mt?function(i,r){return r instanceof mt&&i.op===r.op&&i.field.isEqual(r.field)&&Ee(i.value,r.value)}(n,t):n instanceof Ie?function(i,r){return r instanceof Ie&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&Lp(o,r.filters[a]),!0):!1}(n,t):void P()}function Bp(n){return n instanceof mt?function(e){return`${e.field.canonicalString()} ${e.op} ${Ii(e.value)}`}(n):n instanceof Ie?function(e){return e.op.toString()+" {"+e.getFilters().map(Bp).join(" ,")+"}"}(n):"Filter"}var Hl=class extends mt{constructor(t,e,i){super(t,e,i),this.key=V.fromName(i.referenceValue)}matches(t){let e=V.comparator(t.key,this.key);return this.matchesComparison(e)}},Yl=class extends mt{constructor(t,e){super(t,"in",e),this.keys=qp("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Xl=class extends mt{constructor(t,e){super(t,"not-in",e),this.keys=qp("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function qp(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>V.fromName(i.referenceValue))}var Jl=class extends mt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return _h(e)&&Wr(e.arrayValue,this.value)}},Zl=class extends mt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Wr(this.value.arrayValue,e)}},tu=class extends mt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Wr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Wr(this.value.arrayValue,e)}},eu=class extends mt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!_h(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>Wr(this.value.arrayValue,i))}};var nu=class{constructor(t,e=null,i=[],r=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function dp(n,t=null,e=[],i=[],r=null,s=null,o=null){return new nu(n,t,e,i,r,s,o)}function yh(n){let t=F(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>Wl(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),la(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Ii(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Ii(i)).join(",")),t.ce=e}return t.ce}function vh(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!bE(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Lp(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!hp(n.startAt,t.startAt)&&hp(n.endAt,t.endAt)}function iu(n){return V.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Ai=class{constructor(t,e=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function SE(n,t,e,i,r,s,o,a){return new Ai(n,t,e,i,r,s,o,a)}function wh(n){return new Ai(n)}function fp(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function CE(n){return n.collectionGroup!==null}function jr(n){let t=F(n);if(t.le===null){t.le=[];let e=new Set;for(let s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());let i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Vt(Zt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new bi(s,i))}),e.has(Zt.keyField().canonicalString())||t.le.push(new bi(Zt.keyField(),i))}return t.le}function ye(n){let t=F(n);return t.he||(t.he=RE(t,jr(n))),t.he}function RE(n,t){if(n.limitType==="F")return dp(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new bi(r.field,s)});let e=n.endAt?new Ti(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Ti(n.startAt.position,n.startAt.inclusive):null;return dp(n.path,n.collectionGroup,t,n.filters,n.limit,e,i)}}function ru(n,t,e){return new Ai(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function ua(n,t){return vh(ye(n),ye(t))&&n.limitType===t.limitType}function Up(n){return`${yh(ye(n))}|lt:${n.limitType}`}function mi(n){return`Query(target=${function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map(r=>Bp(r)).join(", ")}]`),la(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(r=>Ii(r)).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(r=>Ii(r)).join(",")),`Target(${i})`}(ye(n))}; limitType=${n.limitType})`}function ha(n,t){return t.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):V.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,t)&&function(i,r){for(let s of jr(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,t)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,t)&&function(i,r){return!(i.startAt&&!function(o,a,c){let l=up(o,a,c);return o.inclusive?l<=0:l<0}(i.startAt,jr(i),r)||i.endAt&&!function(o,a,c){let l=up(o,a,c);return o.inclusive?l>=0:l>0}(i.endAt,jr(i),r))}(n,t)}function xE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zp(n){return(t,e)=>{let i=!1;for(let r of jr(n)){let s=DE(r,t,e);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function DE(n,t,e){let i=n.field.isKeyField()?V.comparator(t.key,e.key):function(s,o,a){let c=o.data.field(s),l=a.data.field(s);return c!==null&&l!==null?Ei(c,l):P()}(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return P()}}var Xe=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let i=this.mapKeyFn(t),r=this.inner[i];if(r===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],t))return i.length===1?delete this.inner[e]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ns(this.inner,(e,i)=>{for(let[r,s]of i)t(r,s)})}isEmpty(){return IE(this.inner)}size(){return this.innerSize}};var PE=new rt(V.comparator);function Fe(){return PE}var jp=new rt(V.comparator);function Ur(...n){let t=jp;for(let e of n)t=t.insert(e.key,e);return t}function Gp(n){let t=jp;return n.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function Tn(){return Gr()}function $p(){return Gr()}function Gr(){return new Xe(n=>n.toString(),(n,t)=>n.isEqual(t))}var VE=new rt(V.comparator),kE=new Vt(V.comparator);function q(...n){let t=kE;for(let e of n)t=t.add(e);return t}var NE=new Vt($);function OE(){return NE}function FE(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mo(t)?"-0":t}}function ME(n){return{integerValue:""+n}}var Si=class{constructor(){this._=void 0}};function LE(n,t,e){return n instanceof Ci?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&gh(s)&&(s=ph(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof Pn?Qp(n,t):n instanceof Vn?Wp(n,t):function(r,s){let o=Kp(r,s),a=mp(o)+mp(r.Ie);return Ql(o)&&Ql(r.Ie)?ME(a):FE(r.serializer,a)}(n,t)}function BE(n,t,e){return n instanceof Pn?Qp(n,t):n instanceof Vn?Wp(n,t):e}function Kp(n,t){return n instanceof Ri?function(i){return Ql(i)||function(s){return!!s&&"doubleValue"in s}(i)}(t)?t:{integerValue:0}:null}var Ci=class extends Si{},Pn=class extends Si{constructor(t){super(),this.elements=t}};function Qp(n,t){let e=Hp(t);for(let i of n.elements)e.some(r=>Ee(r,i))||e.push(i);return{arrayValue:{values:e}}}var Vn=class extends Si{constructor(t){super(),this.elements=t}};function Wp(n,t){let e=Hp(t);for(let i of n.elements)e=e.filter(r=>!Ee(r,i));return{arrayValue:{values:e}}}var Ri=class extends Si{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function mp(n){return it(n.integerValue||n.doubleValue)}function Hp(n){return _h(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function qE(n,t){return n.field.isEqual(t.field)&&function(i,r){return i instanceof Pn&&r instanceof Pn||i instanceof Vn&&r instanceof Vn?wi(i.elements,r.elements,Ee):i instanceof Ri&&r instanceof Ri?Ee(i.Ie,r.Ie):i instanceof Ci&&r instanceof Ci}(n.transform,t.transform)}var su=class{constructor(t,e){this.version=t,this.transformResults=e}},Cn=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function ko(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var xi=class{};function Yp(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Hr(n.key,Cn.none()):new Di(n.key,n.data,Cn.none());{let e=n.data,i=ge.empty(),r=new Vt(Zt.comparator);for(let s of t.fields)if(!r.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Je(n.key,i,new We(r.toArray()),Cn.none())}}function UE(n,t,e){n instanceof Di?function(r,s,o){let a=r.value.clone(),c=pp(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Je?function(r,s,o){if(!ko(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=pp(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Xp(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,t,e):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function $r(n,t,e,i){return n instanceof Di?function(s,o,a,c){if(!ko(s.precondition,o))return a;let l=s.value.clone(),u=_p(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,t,e,i):n instanceof Je?function(s,o,a,c){if(!ko(s.precondition,o))return a;let l=_p(s.fieldTransforms,c,o),u=o.data;return u.setAll(Xp(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,i):function(s,o,a){return ko(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function zE(n,t){let e=null;for(let i of n.fieldTransforms){let r=t.data.field(i.field),s=Kp(i.transform,r||null);s!=null&&(e===null&&(e=ge.empty()),e.set(i.field,s))}return e||null}function gp(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&wi(i,r,(s,o)=>qE(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Di=class extends xi{constructor(t,e,i,r=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},Je=class extends xi{constructor(t,e,i,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Xp(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let i=n.data.field(e);t.set(e,i)}}),t}function pp(n,t,e){let i=new Map;J(n.length===e.length);for(let r=0;r<e.length;r++){let s=n[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,BE(o,a,e[r]))}return i}function _p(n,t,e){let i=new Map;for(let r of n){let s=r.transform,o=e.data.field(r.field);i.set(r.field,LE(s,o,t))}return i}var Hr=class extends xi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ou=class extends xi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var au=class{constructor(t,e,i,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(t,e){let i=e.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(t.key)&&UE(s,t,i[r])}}applyToLocalView(t,e){for(let i of this.baseMutations)i.key.isEqual(t.key)&&(e=$r(i,t,e,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(t.key)&&(e=$r(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let i=$p();return this.mutations.forEach(r=>{let s=t.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(r.key)?null:a;let c=Yp(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(O.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),q())}isEqual(t){return this.batchId===t.batchId&&wi(this.mutations,t.mutations,(e,i)=>gp(e,i))&&wi(this.baseMutations,t.baseMutations,(e,i)=>gp(e,i))}},cu=class n{constructor(t,e,i,r){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=r}static from(t,e,i){J(t.mutations.length===i.length);let r=function(){return VE}(),s=t.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(t,e,i,r)}};var lu=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var uu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ct,j;function jE(n){switch(n){default:return P();case w.CANCELLED:case w.UNKNOWN:case w.DEADLINE_EXCEEDED:case w.RESOURCE_EXHAUSTED:case w.INTERNAL:case w.UNAVAILABLE:case w.UNAUTHENTICATED:return!1;case w.INVALID_ARGUMENT:case w.NOT_FOUND:case w.ALREADY_EXISTS:case w.PERMISSION_DENIED:case w.FAILED_PRECONDITION:case w.ABORTED:case w.OUT_OF_RANGE:case w.UNIMPLEMENTED:case w.DATA_LOSS:return!0}}function Jp(n){if(n===void 0)return we("GRPC error has no .code"),w.UNKNOWN;switch(n){case ct.OK:return w.OK;case ct.CANCELLED:return w.CANCELLED;case ct.UNKNOWN:return w.UNKNOWN;case ct.DEADLINE_EXCEEDED:return w.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return w.RESOURCE_EXHAUSTED;case ct.INTERNAL:return w.INTERNAL;case ct.UNAVAILABLE:return w.UNAVAILABLE;case ct.UNAUTHENTICATED:return w.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return w.INVALID_ARGUMENT;case ct.NOT_FOUND:return w.NOT_FOUND;case ct.ALREADY_EXISTS:return w.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return w.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return w.FAILED_PRECONDITION;case ct.ABORTED:return w.ABORTED;case ct.OUT_OF_RANGE:return w.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return w.UNIMPLEMENTED;case ct.DATA_LOSS:return w.DATA_LOSS;default:return P()}}(j=ct||(ct={}))[j.OK=0]="OK",j[j.CANCELLED=1]="CANCELLED",j[j.UNKNOWN=2]="UNKNOWN",j[j.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",j[j.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",j[j.NOT_FOUND=5]="NOT_FOUND",j[j.ALREADY_EXISTS=6]="ALREADY_EXISTS",j[j.PERMISSION_DENIED=7]="PERMISSION_DENIED",j[j.UNAUTHENTICATED=16]="UNAUTHENTICATED",j[j.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",j[j.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",j[j.ABORTED=10]="ABORTED",j[j.OUT_OF_RANGE=11]="OUT_OF_RANGE",j[j.UNIMPLEMENTED=12]="UNIMPLEMENTED",j[j.INTERNAL=13]="INTERNAL",j[j.UNAVAILABLE=14]="UNAVAILABLE",j[j.DATA_LOSS=15]="DATA_LOSS";var yp=null;function GE(){return new TextEncoder}var $E=new qt([4294967295,4294967295],0);function vp(n){let t=GE().encode(n),e=new xo;return e.update(t),new Uint8Array(e.digest())}function wp(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new qt([e,i],0),new qt([r,s],0)]}var hu=class n{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new bn(`Invalid padding: ${e}`);if(i<0)throw new bn(`Invalid hash count: ${i}`);if(t.length>0&&this.hashCount===0)throw new bn(`Invalid hash count: ${i}`);if(t.length===0&&e!==0)throw new bn(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=qt.fromNumber(this.Te)}de(t,e,i){let r=t.add(e.multiply(qt.fromNumber(i)));return r.compare($E)===1&&(r=new qt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=vp(t),[i,r]=wp(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);if(!this.Ae(o))return!1}return!0}static create(t,e,i){let r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,r,e);return i.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=vp(t),[i,r]=wp(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);this.Re(o)}}Re(t){let e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}},bn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var zo=class n{constructor(t,e,i,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,i){let r=new Map;return r.set(t,Yr.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new n(O.min(),r,new rt($),Fe(),q())}},Yr=class n{constructor(t,e,i,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new n(i,e,q(),q(),q())}};var yi=class{constructor(t,e,i,r){this.Ve=t,this.removedTargetIds=e,this.key=i,this.me=r}},jo=class{constructor(t,e){this.targetId=t,this.fe=e}},Go=class{constructor(t,e,i=Mt.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=r}},$o=class{constructor(){this.ge=0,this.pe=Ip(),this.ye=Mt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=q(),e=q(),i=q();return this.pe.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:i=i.add(r);break;default:P()}}),new Yr(this.ye,this.we,t,e,i)}Fe(){this.Se=!1,this.pe=Ip()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,J(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},du=class{constructor(t){this.Le=t,this.ke=new Map,this.qe=Fe(),this.Qe=Ep(),this.Ke=new rt($)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let i=this.ze(e);switch(t.state){case 0:this.je(e)&&i.Ce(t.resumeToken);break;case 1:i.Ne(),i.be||i.Fe(),i.Ce(t.resumeToken);break;case 2:i.Ne(),i.be||this.removeTarget(e);break;case 3:this.je(e)&&(i.Be(),i.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),i.Ce(t.resumeToken));break;default:P()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((i,r)=>{this.je(r)&&e(r)})}Je(t){let e=t.targetId,i=t.fe.count,r=this.Ye(e);if(r){let s=r.target;if(iu(s))if(i===0){let o=new V(s.path);this.We(e,o,re.newNoDocument(o,O.min()))}else J(i===1);else{let o=this.Ze(e);if(o!==i){let a=this.Xe(t),c=a?this.et(a,t,o):1;if(c!==0){this.He(e);let l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,l)}yp?.tt(function(u,h,d,f,y){var v,p,C,N,z,X;let Ot={localCacheCount:u,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},Q=h.unchangedNames;return Q&&(Ot.bloomFilter={applied:y===0,hashCount:(v=Q?.hashCount)!==null&&v!==void 0?v:0,bitmapLength:(N=(C=(p=Q?.bits)===null||p===void 0?void 0:p.bitmap)===null||C===void 0?void 0:C.length)!==null&&N!==void 0?N:0,padding:(X=(z=Q?.bits)===null||z===void 0?void 0:z.padding)!==null&&X!==void 0?X:0,mightContain:zt=>{var De;return(De=f?.mightContain(zt))!==null&&De!==void 0&&De}}),Ot}(o,t.fe,this.Le.nt(),a,c))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=e,o,a;try{o=Ye(i).toUint8Array()}catch(c){if(c instanceof Bo)return Kr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new hu(o,r,s)}catch(c){return Kr(c instanceof bn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(t,e,i){return e.fe.count===i-this.rt(t,e.targetId)?0:2}rt(t,e){let i=this.Le.getRemoteKeysForTarget(e),r=0;return i.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),r++)}),r}it(t){let e=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&iu(a.target)){let c=new V(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,re.newNoDocument(c,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let i=q();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let l=this.Ye(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let r=new zo(t,e,this.Ke,this.qe,i);return this.qe=Fe(),this.Qe=Ep(),this.Ke=new rt($),r}Ue(t,e){if(!this.je(t))return;let i=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,i),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,i){if(!this.je(t))return;let r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),i&&(this.qe=this.qe.insert(e,i))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new $o,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Vt($),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||T("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new $o),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function Ep(){return new rt(V.comparator)}function Ip(){return new rt(V.comparator)}var KE={asc:"ASCENDING",desc:"DESCENDING"},QE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},WE={and:"AND",or:"OR"},fu=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function mu(n,t){return n.useProto3Json||la(t)?t:{value:t}}function Zp(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function HE(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function YE(n,t){return Zp(n,t.toTimestamp())}function ve(n){return J(!!n),O.fromTimestamp(function(e){let i=He(e);return new Ht(i.seconds,i.nanos)}(n))}function t_(n,t){return gu(n,t).canonicalString()}function gu(n,t){let e=function(r){return new yt(["projects",r.projectId,"databases",r.database])}(n).child("documents");return t===void 0?e:e.child(t)}function e_(n){let t=yt.fromString(n);return J(o_(t)),t}function pu(n,t){return t_(n.databaseId,t.path)}function Rl(n,t){let e=e_(t);if(e.get(1)!==n.databaseId.projectId)throw new x(w.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new x(w.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new V(i_(e))}function n_(n,t){return t_(n.databaseId,t)}function XE(n){let t=e_(n);return t.length===4?yt.emptyPath():i_(t)}function _u(n){return new yt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function i_(n){return J(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Tp(n,t,e){return{name:pu(n,t),fields:e.value.mapValue.fields}}function JE(n,t){let e;if("targetChange"in t){t.targetChange;let i=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:P()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?(J(u===void 0||typeof u=="string"),Mt.fromBase64String(u||"")):(J(u===void 0||u instanceof Uint8Array),Mt.fromUint8Array(u||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(l){let u=l.code===void 0?w.UNKNOWN:Jp(l.code);return new x(u,l.message||"")}(o);e=new Go(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=Rl(n,i.document.name),s=ve(i.document.updateTime),o=i.document.createTime?ve(i.document.createTime):O.min(),a=new ge({mapValue:{fields:i.document.fields}}),c=re.newFoundDocument(r,s,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];e=new yi(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=Rl(n,i.document),s=i.readTime?ve(i.readTime):O.min(),o=re.newNoDocument(r,s),a=i.removedTargetIds||[];e=new yi([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=Rl(n,i.document),s=i.removedTargetIds||[];e=new yi([],s,r,null)}else{if(!("filter"in t))return P();{t.filter;let i=t.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new uu(r,s),a=i.targetId;e=new jo(a,o)}}return e}function ZE(n,t){let e;if(t instanceof Di)e={update:Tp(n,t.key,t.value)};else if(t instanceof Hr)e={delete:pu(n,t.key)};else if(t instanceof Je)e={update:Tp(n,t.key,t.data),updateMask:cI(t.fieldMask)};else{if(!(t instanceof ou))return P();e={verify:pu(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof Ci)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Pn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Vn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ri)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw P()}(0,i))),t.precondition.isNone||(e.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:YE(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:P()}(n,t.precondition)),e}function tI(n,t){return n&&n.length>0?(J(t!==void 0),n.map(e=>function(r,s){let o=r.updateTime?ve(r.updateTime):ve(s);return o.isEqual(O.min())&&(o=ve(s)),new su(o,r.transformResults||[])}(e,t))):[]}function eI(n,t){return{documents:[n_(n,t.path)]}}function nI(n,t){let e={structuredQuery:{}},i=t.path,r;t.collectionGroup!==null?(r=i,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),e.structuredQuery.from=[{collectionId:i.lastSegment()}]),e.parent=n_(n,r);let s=function(l){if(l.length!==0)return s_(Ie.create(l,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(u=>function(d){return{field:gi(d.field),direction:sI(d.dir)}}(u))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=mu(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(t.endAt)),{ut:e,parent:r}}function iI(n){let t=XE(n.parent),e=n.structuredQuery,i=e.from?e.from.length:0,r=null;if(i>0){J(i===1);let u=e.from[0];u.allDescendants?r=u.collectionId:t=t.child(u.collectionId)}let s=[];e.where&&(s=function(h){let d=r_(h);return d instanceof Ie&&Mp(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(y){return new bi(pi(y.field),function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,la(d)?null:d}(e.limit));let c=null;e.startAt&&(c=function(h){let d=!!h.before,f=h.values||[];return new Ti(f,d)}(e.startAt));let l=null;return e.endAt&&(l=function(h){let d=!h.before,f=h.values||[];return new Ti(f,d)}(e.endAt)),SE(t,r,o,s,a,"F",c,l)}function rI(n,t){let e=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return P()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function r_(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let i=pi(e.unaryFilter.field);return mt.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=pi(e.unaryFilter.field);return mt.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=pi(e.unaryFilter.field);return mt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=pi(e.unaryFilter.field);return mt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return P()}}(n):n.fieldFilter!==void 0?function(e){return mt.create(pi(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return P()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Ie.create(e.compositeFilter.filters.map(i=>r_(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return P()}}(e.compositeFilter.op))}(n):P()}function sI(n){return KE[n]}function oI(n){return QE[n]}function aI(n){return WE[n]}function gi(n){return{fieldPath:n.canonicalString()}}function pi(n){return Zt.fromServerFormat(n.fieldPath)}function s_(n){return n instanceof mt?function(e){if(e.op==="=="){if(lp(e.value))return{unaryFilter:{field:gi(e.field),op:"IS_NAN"}};if(cp(e.value))return{unaryFilter:{field:gi(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(lp(e.value))return{unaryFilter:{field:gi(e.field),op:"IS_NOT_NAN"}};if(cp(e.value))return{unaryFilter:{field:gi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gi(e.field),op:oI(e.op),value:e.value}}}(n):n instanceof Ie?function(e){let i=e.getFilters().map(r=>s_(r));return i.length===1?i[0]:{compositeFilter:{op:aI(e.op),filters:i}}}(n):P()}function cI(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function o_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Xr=class n{constructor(t,e,i,r,s=O.min(),o=O.min(),a=Mt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var yu=class{constructor(t){this.ct=t}};function lI(n){let t=iI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ru(t,t.limit,"L"):t}var Ko=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(it(t.integerValue));else if("doubleValue"in t){let i=it(t.doubleValue);isNaN(i)?this.Et(e,13):(this.Et(e,15),Mo(i)?e.dt(0):e.dt(i))}else if("timestampValue"in t){let i=t.timestampValue;this.Et(e,20),typeof i=="string"?e.At(i):(e.At(`${i.seconds||""}`),e.dt(i.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Ye(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let i=t.geoPointValue;this.Et(e,45),e.dt(i.latitude||0),e.dt(i.longitude||0)}else"mapValue"in t?Np(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):P()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let i=t.fields||{};this.Et(e,55);for(let r of Object.keys(i))this.Rt(r,e),this.It(i[r],e)}wt(t,e){let i=t.values||[];this.Et(e,50);for(let r of i)this.It(r,e)}gt(t,e){this.Et(e,37),V.fromName(t).path.forEach(i=>{this.Et(e,60),this.St(i,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};Ko.bt=new Ko;var vu=class{constructor(){this._n=new wu}addToCollectionParentIndex(t,e){return this._n.add(e),_.resolve()}getCollectionParents(t,e){return _.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return _.resolve()}deleteFieldIndex(t,e){return _.resolve()}deleteAllFieldIndexes(t){return _.resolve()}createTargetIndexes(t,e){return _.resolve()}getDocumentsMatchingTarget(t,e){return _.resolve(null)}getIndexType(t,e){return _.resolve(0)}getFieldIndexes(t,e){return _.resolve([])}getNextCollectionGroupToUpdate(t){return _.resolve(null)}getMinOffset(t,e){return _.resolve(xn.min())}getMinOffsetFromCollectionGroup(t,e){return _.resolve(xn.min())}updateCollectionGroup(t,e,i){return _.resolve()}updateIndexEntries(t,e){return _.resolve()}},wu=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e]||new Vt(yt.comparator),s=!r.has(i);return this.index[e]=r.add(i),s}has(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e];return r&&r.has(i)}getEntries(t){return(this.index[t]||new Vt(yt.comparator)).toArray()}};var VS=new Uint8Array(0);var me=class n{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};me.DEFAULT_COLLECTION_PERCENTILE=10,me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,me.DEFAULT=new me(41943040,me.DEFAULT_COLLECTION_PERCENTILE,me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),me.DISABLED=new me(-1,0,0);var Jr=class n{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Bn(){return new n(-1)}};var Eu=class{constructor(){this.changes=new Xe(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,re.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let i=this.changes.get(e);return i!==void 0?_.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Iu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Tu=class{constructor(t,e,i,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=r}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(i=r,this.remoteDocumentCache.getEntry(t,e))).next(r=>(i!==null&&$r(i.mutation,r,We.empty(),Ht.now()),r))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,q()).next(()=>i))}getLocalViewOfDocuments(t,e,i=q()){let r=Tn();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,i).next(s=>{let o=Ur();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let i=Tn();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,q()))}populateOverlays(t,e,i){let r=[];return i.forEach(s=>{e.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(t,r).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,i,r){let s=Fe(),o=Gr(),a=function(){return Gr()}();return e.forEach((c,l)=>{let u=i.get(l.key);r.has(l.key)&&(u===void 0||u.mutation instanceof Je)?s=s.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),$r(u.mutation,l,u.mutation.getFieldMask(),Ht.now())):o.set(l.key,We.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),e.forEach((l,u)=>{var h;return a.set(l,new Iu(u,(h=o.get(l))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let i=Gr(),r=new rt((o,a)=>o-a),s=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(c=>{let l=e.get(c);if(l===null)return;let u=i.get(c)||We.empty();u=a.applyToLocalView(l,u),i.set(c,u);let h=(r.get(a.batchId)||q()).add(c);r=r.insert(a.batchId,h)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),l=c.key,u=c.value,h=$p();u.forEach(d=>{if(!s.has(d)){let f=Yp(e.get(d),i.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,l,h))}return _.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i,r){return function(o){return V.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):CE(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,r):this.getDocumentsMatchingCollectionQuery(t,e,i,r)}getNextDocuments(t,e,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,r-s.size):_.resolve(Tn()),a=-1,c=s;return o.next(l=>_.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?_.resolve():this.remoteDocumentCache.getEntry(t,u).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(t,l,s)).next(()=>this.computeViews(t,c,l,q())).next(u=>({batchId:a,changes:Gp(u)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new V(e)).next(i=>{let r=Ur();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(t,e,i,r){let s=e.collectionGroup,o=Ur();return this.indexManager.getCollectionParents(t,s).next(a=>_.forEach(a,c=>{let l=function(h,d){return new Ai(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,l,i,r).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,s,r))).next(o=>{s.forEach((c,l)=>{let u=l.getKey();o.get(u)===null&&(o=o.insert(u,re.newInvalidDocument(u)))});let a=Ur();return o.forEach((c,l)=>{let u=s.get(c);u!==void 0&&$r(u.mutation,l,We.empty(),Ht.now()),ha(e,l)&&(a=a.insert(c,l))}),a})}};var bu=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return _.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(r){return{id:r.id,version:r.version,createTime:ve(r.createTime)}}(e)),_.resolve()}getNamedQuery(t,e){return _.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(r){return{name:r.name,query:lI(r.bundledQuery),readTime:ve(r.readTime)}}(e)),_.resolve()}};var Au=class{constructor(){this.overlays=new rt(V.comparator),this.hr=new Map}getOverlay(t,e){return _.resolve(this.overlays.get(e))}getOverlays(t,e){let i=Tn();return _.forEach(e,r=>this.getOverlay(t,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((r,s)=>{this.ht(t,e,s)}),_.resolve()}removeOverlaysForBatchId(t,e,i){let r=this.hr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(i)),_.resolve()}getOverlaysForCollection(t,e,i){let r=Tn(),s=e.length+1,o=new V(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,l=c.getKey();if(!e.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return _.resolve(r)}getOverlaysForCollectionGroup(t,e,i,r){let s=new rt((l,u)=>l-u),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===e&&l.largestBatchId>i){let u=s.get(l.largestBatchId);u===null&&(u=Tn(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}let a=Tn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=r)););return _.resolve(a)}ht(t,e,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.hr.get(r.largestBatchId).delete(i.key);this.hr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new lu(e,i));let s=this.hr.get(e);s===void 0&&(s=q(),this.hr.set(e,s)),this.hr.set(e,s.add(i.key))}};var Zr=class{constructor(){this.Pr=new Vt(lt.Ir),this.Tr=new Vt(lt.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let i=new lt(t,e);this.Pr=this.Pr.add(i),this.Tr=this.Tr.add(i)}dr(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.Ar(new lt(t,e))}Rr(t,e){t.forEach(i=>this.removeReference(i,e))}Vr(t){let e=new V(new yt([])),i=new lt(e,t),r=new lt(e,t+1),s=[];return this.Tr.forEachInRange([i,r],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new V(new yt([])),i=new lt(e,t),r=new lt(e,t+1),s=q();return this.Tr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new lt(t,0),i=this.Pr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}},lt=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return V.comparator(t.key,e.key)||$(t.pr,e.pr)}static Er(t,e){return $(t.pr,e.pr)||V.comparator(t.key,e.key)}};var Su=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Vt(lt.Ir)}checkEmpty(t){return _.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,r){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new au(s,e,i,r);this.mutationQueue.push(o);for(let a of r)this.wr=this.wr.add(new lt(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(t,e){return _.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let i=e+1,r=this.br(i),s=r<0?0:r;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let i=new lt(e,0),r=new lt(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([i,r],o=>{let a=this.Sr(o.pr);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Vt($);return e.forEach(r=>{let s=new lt(r,0),o=new lt(r,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{i=i.add(a.pr)})}),_.resolve(this.Dr(i))}getAllMutationBatchesAffectingQuery(t,e){let i=e.path,r=i.length+1,s=i;V.isDocumentKey(s)||(s=s.child(""));let o=new lt(new V(s),0),a=new Vt($);return this.wr.forEachWhile(c=>{let l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===r&&(a=a.add(c.pr)),!0)},o),_.resolve(this.Dr(a))}Dr(t){let e=[];return t.forEach(i=>{let r=this.Sr(i);r!==null&&e.push(r)}),e}removeMutationBatch(t,e){J(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let i=this.wr;return _.forEach(e.mutations,r=>{let s=new lt(r.key,e.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.wr=i})}Mn(t){}containsKey(t,e){let i=new lt(e,0),r=this.wr.firstAfterOrEqual(i);return _.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,_.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Cu=class{constructor(t){this.vr=t,this.docs=function(){return new rt(V.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let i=e.key,r=this.docs.get(i),s=r?r.size:0,o=this.vr(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let i=this.docs.get(e);return _.resolve(i?i.document.mutableCopy():re.newInvalidDocument(e))}getEntries(t,e){let i=Fe();return e.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():re.newInvalidDocument(r))}),_.resolve(i)}getDocumentsMatchingQuery(t,e,i,r){let s=Fe(),o=e.path,a=new V(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||_E(pE(u),i)<=0||(r.has(u.key)||ha(e,u))&&(s=s.insert(u.key,u.mutableCopy()))}return _.resolve(s)}getAllFromCollectionGroup(t,e,i,r){P()}Fr(t,e){return _.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new Ru(this)}getSize(t){return _.resolve(this.size)}},Ru=class extends Eu{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(i)}),_.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var xu=class{constructor(t){this.persistence=t,this.Mr=new Xe(e=>yh(e),vh),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Zr,this.targetCount=0,this.Br=Jr.Nn()}forEachTarget(t,e){return this.Mr.forEach((i,r)=>e(r)),_.resolve()}getLastRemoteSnapshotVersion(t){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return _.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Or&&(this.Or=e),_.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Br=new Jr(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,_.resolve()}updateTargetData(t,e){return this.qn(e),_.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,_.resolve()}removeTargets(t,e,i){let r=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),r++)}),_.waitFor(s).next(()=>r)}getTargetCount(t){return _.resolve(this.targetCount)}getTargetData(t,e){let i=this.Mr.get(e)||null;return _.resolve(i)}addMatchingKeys(t,e,i){return this.Nr.dr(e,i),_.resolve()}removeMatchingKeys(t,e,i){this.Nr.Rr(e,i);let r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(o=>{s.push(r.markPotentiallyOrphaned(t,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),_.resolve()}getMatchingKeysForTargetId(t,e){let i=this.Nr.gr(e);return _.resolve(i)}containsKey(t,e){return _.resolve(this.Nr.containsKey(e))}};var Du=class{constructor(t,e){this.Lr={},this.overlays={},this.kr=new kp(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new xu(this),this.indexManager=new vu,this.remoteDocumentCache=function(r){return new Cu(r)}(i=>this.referenceDelegate.Kr(i)),this.serializer=new yu(e),this.$r=new bu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Au,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.Lr[t.toKey()];return i||(i=new Su(e,this.referenceDelegate),this.Lr[t.toKey()]=i),i}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,i){T("MemoryPersistence","Starting transaction:",t);let r=new Pu(this.kr.next());return this.referenceDelegate.Ur(),i(r).next(s=>this.referenceDelegate.Wr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Gr(t,e){return _.or(Object.values(this.Lr).map(i=>()=>i.containsKey(t,e)))}},Pu=class extends Ul{constructor(t){super(),this.currentSequenceNumber=t}},Vu=class n{constructor(t){this.persistence=t,this.zr=new Zr,this.jr=null}static Hr(t){return new n(t)}get Jr(){if(this.jr)return this.jr;throw P()}addReference(t,e,i){return this.zr.addReference(i,e),this.Jr.delete(i.toString()),_.resolve()}removeReference(t,e,i){return this.zr.removeReference(i,e),this.Jr.add(i.toString()),_.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),_.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(r=>this.Jr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(r=>{r.forEach(s=>this.Jr.add(s.toString()))}).next(()=>i.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.Jr,i=>{let r=V.fromPath(i);return this.Yr(t,r).next(s=>{s||e.removeEntry(r,O.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(i=>{i?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return _.or([()=>_.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var ku=class n{constructor(t,e,i,r){this.targetId=t,this.fromCache=e,this.qi=i,this.Qi=r}static Ki(t,e){let i=q(),r=q();for(let s of e.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(t,e.fromCache,i,r)}};var Nu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Ou=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return fm()?8:Fo.v(hr())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,i,r){let s={result:null};return this.ji(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,e,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Nu;return this.Ji(t,e,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,e,o,a.size)})}).next(()=>s.result)}Yi(t,e,i,r){return i.documentReadCount<this.Wi?(qr()<=gt.DEBUG&&T("QueryEngine","SDK will not create cache indexes for query:",mi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),_.resolve()):(qr()<=gt.DEBUG&&T("QueryEngine","Query:",mi(e),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Gi*r?(qr()<=gt.DEBUG&&T("QueryEngine","The SDK decides to create cache indexes for query:",mi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ye(e))):_.resolve())}ji(t,e){if(fp(e))return _.resolve(null);let i=ye(e);return this.indexManager.getIndexType(t,i).next(r=>r===0?null:(e.limit!==null&&r===1&&(e=ru(e,null,"F"),i=ye(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(s=>{let o=q(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,i).next(c=>{let l=this.Zi(e,a);return this.Xi(e,l,o,c.readTime)?this.ji(t,ru(e,null,"F")):this.es(t,l,e,c)}))})))}Hi(t,e,i,r){return fp(e)||r.isEqual(O.min())?_.resolve(null):this.zi.getDocuments(t,i).next(s=>{let o=this.Zi(e,s);return this.Xi(e,o,i,r)?_.resolve(null):(qr()<=gt.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),mi(e)),this.es(t,o,e,gE(r,-1)).next(a=>a))})}Zi(t,e){let i=new Vt(zp(t));return e.forEach((r,s)=>{ha(t,s)&&(i=i.add(s))}),i}Xi(t,e,i,r){if(t.limit===null)return!1;if(i.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,i){return qr()<=gt.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",mi(e)),this.zi.getDocumentsMatchingQuery(t,e,xn.min(),i)}es(t,e,i,r){return this.zi.getDocumentsMatchingQuery(t,i,r).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Fu=class{constructor(t,e,i,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new rt($),this.rs=new Xe(s=>yh(s),vh),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(i)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Tu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function uI(n,t,e,i){return new Fu(n,t,e,i)}function a_(n,t){return m(this,null,function*(){let e=F(n);return yield e.persistence.runTransaction("Handle user change","readonly",i=>{let r;return e.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,e._s(t),e.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=q();for(let l of r){o.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}for(let l of s){a.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}return e.localDocuments.getDocuments(i,c).next(l=>({us:l,removedBatchIds:o,addedBatchIds:a}))})})})}function hI(n,t){let e=F(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){let h=l.batch,d=h.keys(),f=_.resolve();return d.forEach(y=>{f=f.next(()=>u.getEntry(c,y)).next(v=>{let p=l.docVersions.get(y);J(p!==null),v.version.compareTo(p)<0&&(h.applyToRemoteDocument(v,l),v.isValidDocument()&&(v.setReadTime(l.commitVersion),u.addEntry(v)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(e,i,t,s).next(()=>s.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,r,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=q();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(t))).next(()=>e.localDocuments.getDocuments(i,r))})}function c_(n){let t=F(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function dI(n,t){let e=F(n),i=t.snapshotVersion,r=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.os.newChangeBuffer({trackRemovals:!0});r=e.ns;let a=[];t.targetChanges.forEach((u,h)=>{let d=r.get(h);if(!d)return;a.push(e.Qr.removeMatchingKeys(s,u.removedDocuments,h).next(()=>e.Qr.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?f=f.withResumeToken(Mt.EMPTY_BYTE_STRING,O.min()).withLastLimboFreeSnapshotVersion(O.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),r=r.insert(h,f),function(v,p,C){return v.resumeToken.approximateByteSize()===0||p.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(d,f,u)&&a.push(e.Qr.updateTargetData(s,f))});let c=Fe(),l=q();if(t.documentUpdates.forEach(u=>{t.resolvedLimboDocuments.has(u)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(fI(s,o,t.documentUpdates).next(u=>{c=u.cs,l=u.ls})),!i.isEqual(O.min())){let u=e.Qr.getLastRemoteSnapshotVersion(s).next(h=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return _.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(e.ns=r,s))}function fI(n,t,e){let i=q(),r=q();return e.forEach(s=>i=i.add(s)),t.getEntries(n,i).next(s=>{let o=Fe();return e.forEach((a,c)=>{let l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(O.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):T("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{cs:o,ls:r}})}function mI(n,t){let e=F(n);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function gI(n,t){let e=F(n);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return e.Qr.getTargetData(i,t).next(s=>s?(r=s,_.resolve(r)):e.Qr.allocateTargetId(i).next(o=>(r=new Xr(t,o,"TargetPurposeListen",i.currentSequenceNumber),e.Qr.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=e.ns.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(i.targetId,i),e.rs.set(t,i.targetId)),i})}function Mu(n,t,e){return m(this,null,function*(){let i=F(n),r=i.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!es(o))throw o;T("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}i.ns=i.ns.remove(t),i.rs.delete(r.target)})}function bp(n,t,e){let i=F(n),r=O.min(),s=q();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){let h=F(c),d=h.rs.get(u);return d!==void 0?_.resolve(h.ns.get(d)):h.Qr.getTargetData(l,u)}(i,o,ye(t)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.ts.getDocumentsMatchingQuery(o,t,e?r:O.min(),e?s:q())).next(a=>(pI(i,xE(t),a),{documents:a,hs:s})))}function pI(n,t,e){let i=n.ss.get(t)||O.min();e.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.ss.set(t,i)}var Qo=class{constructor(){this.activeTargetIds=OE()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Lu=class{constructor(){this.no=new Qo,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,i){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Qo,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Bu=class{io(t){}shutdown(){}};var Wo=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Po=null;function xl(){return Po===null?Po=function(){return 268435456+Math.round(2147483648*Math.random())}():Po++,"0x"+Po.toString(16)}var _I={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var qu=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var Dt="WebChannelConnection",Uu=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let i=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=i+"://"+e.host,this.po=`projects/${r}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get wo(){return!1}So(e,i,r,s,o){let a=xl(),c=this.bo(e,i.toUriEncodedString());T("RestConnection",`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(l,s,o),this.Co(e,c,l,r).then(u=>(T("RestConnection",`Received RPC '${e}' ${a}: `,u),u),u=>{throw Kr("RestConnection",`RPC '${e}' ${a} failed with error: `,u,"url: ",c,"request:",r),u})}vo(e,i,r,s,o,a){return this.So(e,i,r,s,o)}Do(e,i,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ni}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}bo(e,i){let r=_I[e];return`${this.fo}/v1/${i}:${r}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,i,r){let s=xl();return new Promise((o,a)=>{let c=new Ro;c.setWithCredentials(!0),c.listenOnce(So.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Qe.NO_ERROR:let u=c.getResponseJson();T(Dt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(u)),o(u);break;case Qe.TIMEOUT:T(Dt,`RPC '${t}' ${s} timed out`),a(new x(w.DEADLINE_EXCEEDED,"Request time out"));break;case Qe.HTTP_ERROR:let h=c.getStatus();if(T(Dt,`RPC '${t}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let y=function(p){let C=p.toLowerCase().replace(/_/g,"-");return Object.values(w).indexOf(C)>=0?C:w.UNKNOWN}(f.status);a(new x(y,f.message))}else a(new x(w.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new x(w.UNAVAILABLE,"Connection failed."));break;default:P()}}finally{T(Dt,`RPC '${t}' ${s} completed.`)}});let l=JSON.stringify(r);T(Dt,`RPC '${t}' ${s} sending request:`,r),c.send(e,"POST",l,i,15)})}Fo(t,e,i){let r=xl(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=bo(),a=Ao(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,e,i),c.encodeInitMessageHeaders=!0;let u=s.join("");T(Dt,`Creating RPC '${t}' stream ${r}: ${u}`,c);let h=o.createWebChannel(u,c),d=!1,f=!1,y=new qu({lo:p=>{f?T(Dt,`Not sending because RPC '${t}' stream ${r} is closed:`,p):(d||(T(Dt,`Opening RPC '${t}' stream ${r} transport.`),h.open(),d=!0),T(Dt,`RPC '${t}' stream ${r} sending:`,p),h.send(p))},ho:()=>h.close()}),v=(p,C,N)=>{p.listen(C,z=>{try{N(z)}catch(X){setTimeout(()=>{throw X},0)}})};return v(h,fe.EventType.OPEN,()=>{f||T(Dt,`RPC '${t}' stream ${r} transport opened.`)}),v(h,fe.EventType.CLOSE,()=>{f||(f=!0,T(Dt,`RPC '${t}' stream ${r} transport closed`),y.Vo())}),v(h,fe.EventType.ERROR,p=>{f||(f=!0,Kr(Dt,`RPC '${t}' stream ${r} transport errored:`,p),y.Vo(new x(w.UNAVAILABLE,"The operation could not be completed")))}),v(h,fe.EventType.MESSAGE,p=>{var C;if(!f){let N=p.data[0];J(!!N);let z=N,X=z.error||((C=z[0])===null||C===void 0?void 0:C.error);if(X){T(Dt,`RPC '${t}' stream ${r} received error:`,X);let Ot=X.status,Q=function(cc){let nr=ct[cc];if(nr!==void 0)return Jp(nr)}(Ot),zt=X.message;Q===void 0&&(Q=w.INTERNAL,zt="Unknown error status: "+Ot+" with message "+X.message),f=!0,y.Vo(new x(Q,zt)),h.close()}else T(Dt,`RPC '${t}' stream ${r} received:`,N),y.mo(N)}}),v(a,Co.STAT_EVENT,p=>{p.stat===fi.PROXY?T(Dt,`RPC '${t}' stream ${r} detected buffering proxy`):p.stat===fi.NOPROXY&&T(Dt,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{y.Ro()},0),y}};function Dl(){return typeof document<"u"?document:null}function l_(n){return new fu(n,!0)}var Ho=class{constructor(t,e,i=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=i,this.xo=r,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let e=Math.floor(this.No+this.Qo()),i=Math.max(0,Date.now()-this.Lo),r=Math.max(0,e-i);r>0&&T("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Lo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}};var Yo=class{constructor(t,e,i,r,s,o,a,c){this.oi=t,this.$o=i,this.Uo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Ho(t,e)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return m(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return m(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,e){return m(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():e&&e.code===w.RESOURCE_EXHAUSTED?(we(e.toString()),we("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===w.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(e)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Wo===e&&this.o_(i,r)},i=>{t(()=>{let r=new x(w.UNKNOWN,"Fetching auth token failed: "+i.message);return this.__(r)})})}o_(t,e){let i=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po(()=>{i(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(r=>{i(()=>this.__(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Yo(){this.state=5,this.jo.qo(()=>m(this,null,function*(){this.state=0,this.start()}))}__(t){return T("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget(()=>this.Wo===t?e():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},zu=class extends Yo{constructor(t,e,i,r,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();let e=JE(this.serializer,t),i=function(s){if(!("targetChange"in s))return O.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?O.min():o.readTime?ve(o.readTime):O.min()}(t);return this.listener.u_(e,i)}c_(t){let e={};e.database=_u(this.serializer),e.addTarget=function(s,o){let a,c=o.target;if(a=iu(c)?{documents:eI(s,c)}:{query:nI(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=HE(s,o.resumeToken);let l=mu(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(O.min())>0){a.readTime=Zp(s,o.snapshotVersion.toTimestamp());let l=mu(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,t);let i=rI(this.serializer,t);i&&(e.labels=i),this.t_(e)}l_(t){let e={};e.database=_u(this.serializer),e.removeTarget=t,this.t_(e)}},ju=class extends Yo{constructor(t,e,i,r,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(J(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let e=tI(t.writeResults,t.commitTime),i=ve(t.commitTime);return this.listener.T_(i,e)}return J(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=_u(this.serializer),this.t_(t)}I_(t){let e={streamToken:this.lastStreamToken,writes:t.map(i=>ZE(this.serializer,i))};this.t_(e)}};var Gu=class extends class{}{constructor(t,e,i,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new x(w.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,i,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,gu(e,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===w.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(w.UNKNOWN,s.toString())})}vo(t,e,i,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,gu(e,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===w.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(w.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var $u=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(we(e),this.g_=!1):T("OnlineStateTracker",e)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Ku=class{constructor(t,e,i,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{i.enqueueAndForget(()=>m(this,null,function*(){kn(this)&&(T("RemoteStore","Restarting streams for network reachability change."),yield function(c){return m(this,null,function*(){let l=F(c);l.v_.add(4),yield is(l),l.x_.set("Unknown"),l.v_.delete(4),yield da(l)})}(this))}))}),this.x_=new $u(i,r)}};function da(n){return m(this,null,function*(){if(kn(n))for(let t of n.F_)yield t(!0)})}function is(n){return m(this,null,function*(){for(let t of n.F_)yield t(!1)})}function u_(n,t){let e=F(n);e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),Th(e)?Ih(e):Oi(e).Jo()&&Eh(e,t))}function h_(n,t){let e=F(n),i=Oi(e);e.C_.delete(t),i.Jo()&&d_(e,t),e.C_.size===0&&(i.Jo()?i.Xo():kn(e)&&e.x_.set("Unknown"))}function Eh(n,t){if(n.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(O.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Oi(n).c_(t)}function d_(n,t){n.O_.Oe(t),Oi(n).l_(t)}function Ih(n){n.O_=new du({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.C_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),Oi(n).start(),n.x_.p_()}function Th(n){return kn(n)&&!Oi(n).Ho()&&n.C_.size>0}function kn(n){return F(n).v_.size===0}function f_(n){n.O_=void 0}function yI(n){return m(this,null,function*(){n.C_.forEach((t,e)=>{Eh(n,t)})})}function vI(n,t){return m(this,null,function*(){f_(n),Th(n)?(n.x_.S_(t),Ih(n)):n.x_.set("Unknown")})}function wI(n,t,e){return m(this,null,function*(){if(n.x_.set("Online"),t instanceof Go&&t.state===2&&t.cause)try{yield function(r,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.C_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.C_.delete(a),r.O_.removeTarget(a))})}(n,t)}catch(i){T("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield Xo(n,i)}else if(t instanceof yi?n.O_.$e(t):t instanceof jo?n.O_.Je(t):n.O_.Ge(t),!e.isEqual(O.min()))try{let i=yield c_(n.localStore);e.compareTo(i)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){let u=s.C_.get(l);u&&s.C_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{let u=s.C_.get(c);if(!u)return;s.C_.set(c,u.withResumeToken(Mt.EMPTY_BYTE_STRING,u.snapshotVersion)),d_(s,c);let h=new Xr(u.target,c,l,u.sequenceNumber);Eh(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(i){T("RemoteStore","Failed to raise snapshot:",i),yield Xo(n,i)}})}function Xo(n,t,e){return m(this,null,function*(){if(!es(t))throw t;n.v_.add(1),yield is(n),n.x_.set("Offline"),e||(e=()=>c_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){T("RemoteStore","Retrying IndexedDB access"),yield e(),n.v_.delete(1),yield da(n)}))})}function m_(n,t){return t().catch(e=>Xo(n,e,t))}function fa(n){return m(this,null,function*(){let t=F(n),e=Ze(t),i=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;EI(t);)try{let r=yield mI(t.localStore,i);if(r===null){t.D_.length===0&&e.Xo();break}i=r.batchId,II(t,r)}catch(r){yield Xo(t,r)}g_(t)&&p_(t)})}function EI(n){return kn(n)&&n.D_.length<10}function II(n,t){n.D_.push(t);let e=Ze(n);e.Jo()&&e.P_&&e.I_(t.mutations)}function g_(n){return kn(n)&&!Ze(n).Ho()&&n.D_.length>0}function p_(n){Ze(n).start()}function TI(n){return m(this,null,function*(){Ze(n).d_()})}function bI(n){return m(this,null,function*(){let t=Ze(n);for(let e of n.D_)t.I_(e.mutations)})}function AI(n,t,e){return m(this,null,function*(){let i=n.D_.shift(),r=cu.from(i,t,e);yield m_(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield fa(n)})}function SI(n,t){return m(this,null,function*(){t&&Ze(n).P_&&(yield function(i,r){return m(this,null,function*(){if(function(o){return jE(o)&&o!==w.ABORTED}(r.code)){let s=i.D_.shift();Ze(i).Zo(),yield m_(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield fa(i)}})}(n,t)),g_(n)&&p_(n)})}function Ap(n,t){return m(this,null,function*(){let e=F(n);e.asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials");let i=kn(e);e.v_.add(3),yield is(e),i&&e.x_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),yield da(e)})}function CI(n,t){return m(this,null,function*(){let e=F(n);t?(e.v_.delete(2),yield da(e)):t||(e.v_.add(2),yield is(e),e.x_.set("Unknown"))})}function Oi(n){return n.N_||(n.N_=function(e,i,r){let s=F(e);return s.R_(),new zu(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Po:yI.bind(null,n),To:vI.bind(null,n),u_:wI.bind(null,n)}),n.F_.push(t=>m(this,null,function*(){t?(n.N_.Zo(),Th(n)?Ih(n):n.x_.set("Unknown")):(yield n.N_.stop(),f_(n))}))),n.N_}function Ze(n){return n.B_||(n.B_=function(e,i,r){let s=F(e);return s.R_(),new ju(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Po:TI.bind(null,n),To:SI.bind(null,n),E_:bI.bind(null,n),T_:AI.bind(null,n)}),n.F_.push(t=>m(this,null,function*(){t?(n.B_.Zo(),yield fa(n)):(yield n.B_.stop(),n.D_.length>0&&(T("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.B_}var Qu=class n{constructor(t,e,i,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new pe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,r,s){let o=Date.now()+i,a=new n(t,e,o,r,s);return a.start(i),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(w.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function bh(n,t){if(we("AsyncQueue",`${t}: ${n}`),es(n))return new x(w.UNAVAILABLE,`${t}: ${n}`);throw n}var Jo=class n{constructor(t){this.comparator=t?(e,i)=>t(e,i)||V.comparator(e.key,i.key):(e,i)=>V.comparator(e.key,i.key),this.keyedMap=Ur(),this.sortedSet=new rt(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let i=new n;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}};var Zo=class{constructor(){this.L_=new rt(V.comparator)}track(t){let e=t.doc.key,i=this.L_.get(e);i?t.type!==0&&i.type===3?this.L_=this.L_.insert(e,t):t.type===3&&i.type!==1?this.L_=this.L_.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.L_=this.L_.remove(e):t.type===1&&i.type===2?this.L_=this.L_.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):P():this.L_=this.L_.insert(e,t)}k_(){let t=[];return this.L_.inorderTraversal((e,i)=>{t.push(i)}),t}},Pi=class n{constructor(t,e,i,r,s,o,a,c,l){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(t,e,i,r,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,Jo.emptySet(e),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ua(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==i[r].type||!e[r].doc.isEqual(i[r].doc))return!1;return!0}};var Wu=class{constructor(){this.q_=void 0,this.Q_=[]}},Hu=class{constructor(){this.queries=new Xe(t=>Up(t),ua),this.onlineState="Unknown",this.K_=new Set}};function RI(n,t){return m(this,null,function*(){let e=F(n),i=t.query,r=!1,s=e.queries.get(i);if(s||(r=!0,s=new Wu),r)try{s.q_=yield e.onListen(i)}catch(o){let a=bh(o,`Initialization of query '${mi(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,s),s.Q_.push(t),t.U_(e.onlineState),s.q_&&t.W_(s.q_)&&Ah(e)})}function xI(n,t){return m(this,null,function*(){let e=F(n),i=t.query,r=!1,s=e.queries.get(i);if(s){let o=s.Q_.indexOf(t);o>=0&&(s.Q_.splice(o,1),r=s.Q_.length===0)}if(r)return e.queries.delete(i),e.onUnlisten(i)})}function DI(n,t){let e=F(n),i=!1;for(let r of t){let s=r.query,o=e.queries.get(s);if(o){for(let a of o.Q_)a.W_(r)&&(i=!0);o.q_=r}}i&&Ah(e)}function PI(n,t,e){let i=F(n),r=i.queries.get(t);if(r)for(let s of r.Q_)s.onError(e);i.queries.delete(t)}function Ah(n){n.K_.forEach(t=>{t.next()})}var Yu=class{constructor(t,e,i){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=i||{}}W_(t){if(!this.options.includeMetadataChanges){let i=[];for(let r of t.docChanges)r.type!==3&&i.push(r);t=new Pi(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;let i=e!=="Offline";return(!this.options.Z_||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}H_(t){if(t.docChanges.length>0)return!0;let e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}Y_(t){t=Pi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}};var ta=class{constructor(t){this.key=t}},ea=class{constructor(t){this.key=t}},Xu=class{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=q(),this.mutatedKeys=q(),this.ua=zp(t),this.ca=new Jo(this.ua)}get la(){return this.oa}ha(t,e){let i=e?e.Pa:new Zo,r=e?e.ca:this.ca,s=e?e.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,l=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((u,h)=>{let d=r.get(u),f=ha(this.query,h)?h:null,y=!!d&&this.mutatedKeys.has(d.key),v=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;d&&f?d.data.isEqual(f.data)?y!==v&&(i.track({type:3,doc:f}),p=!0):this.Ia(d,f)||(i.track({type:2,doc:f}),p=!0,(c&&this.ua(f,c)>0||l&&this.ua(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),p=!0):d&&!f&&(i.track({type:1,doc:d}),p=!0,(c||l)&&(a=!0)),p&&(f?(o=o.add(f),s=v?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{ca:o,Pa:i,Xi:a,mutatedKeys:s}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,r){let s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;let o=t.Pa.k_();o.sort((u,h)=>function(f,y){let v=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return P()}};return v(f)-v(y)}(u.type,h.type)||this.ua(u.doc,h.doc)),this.Ta(i),r=r!=null&&r;let a=e&&!r?this.Ea():[],c=this.aa.size===0&&this.current&&!r?1:0,l=c!==this._a;return this._a=c,o.length!==0||l?{snapshot:new Pi(this.query,t.ca,s,o,t.mutatedKeys,c===0,l,!1,!!i&&i.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Zo,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach(e=>this.oa=this.oa.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.oa=this.oa.delete(e)),this.current=t.current)}Ea(){if(!this.current)return[];let t=this.aa;this.aa=q(),this.ca.forEach(i=>{this.Aa(i.key)&&(this.aa=this.aa.add(i.key))});let e=[];return t.forEach(i=>{this.aa.has(i)||e.push(new ea(i))}),this.aa.forEach(i=>{t.has(i)||e.push(new ta(i))}),e}Ra(t){this.oa=t.hs,this.aa=q();let e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return Pi.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,this._a===0,this.hasCachedResults)}},Ju=class{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}},Zu=class{constructor(t){this.key=t,this.ma=!1}},th=class{constructor(t,e,i,r,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new Xe(a=>Up(a),ua),this.pa=new Map,this.ya=new Set,this.wa=new rt(V.comparator),this.Sa=new Map,this.ba=new Zr,this.Da={},this.Ca=new Map,this.va=Jr.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}};function VI(n,t){return m(this,null,function*(){let e=zI(n),i,r,s=e.ga.get(t);if(s)i=s.targetId,e.sharedClientState.addLocalQueryTarget(i),r=s.view.Va();else{let o=yield gI(e.localStore,ye(t)),a=e.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=yield kI(e,t,i,a==="current",o.resumeToken),e.isPrimaryClient&&u_(e.remoteStore,o)}return r})}function kI(n,t,e,i,r){return m(this,null,function*(){n.Ma=(h,d,f)=>function(v,p,C,N){return m(this,null,function*(){let z=p.view.ha(C);z.Xi&&(z=yield bp(v.localStore,p.query,!1).then(({documents:zt})=>p.view.ha(zt,z)));let X=N&&N.targetChanges.get(p.targetId),Ot=N&&N.targetMismatches.get(p.targetId)!=null,Q=p.view.applyChanges(z,v.isPrimaryClient,X,Ot);return Cp(v,p.targetId,Q.da),Q.snapshot})}(n,h,d,f);let s=yield bp(n.localStore,t,!0),o=new Xu(t,s.hs),a=o.ha(s.documents),c=Yr.createSynthesizedTargetChangeForCurrentChange(e,i&&n.onlineState!=="Offline",r),l=o.applyChanges(a,n.isPrimaryClient,c);Cp(n,e,l.da);let u=new Ju(t,e,o);return n.ga.set(t,u),n.pa.has(e)?n.pa.get(e).push(t):n.pa.set(e,[t]),l.snapshot})}function NI(n,t){return m(this,null,function*(){let e=F(n),i=e.ga.get(t),r=e.pa.get(i.targetId);if(r.length>1)return e.pa.set(i.targetId,r.filter(s=>!ua(s,t))),void e.ga.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Mu(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),h_(e.remoteStore,i.targetId),eh(e,i.targetId)}).catch(ts))):(eh(e,i.targetId),yield Mu(e.localStore,i.targetId,!0))})}function OI(n,t,e){return m(this,null,function*(){let i=jI(n);try{let r=yield function(o,a){let c=F(o),l=Ht.now(),u=a.reduce((f,y)=>f.add(y.key),q()),h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let y=Fe(),v=q();return c.os.getEntries(f,u).next(p=>{y=p,y.forEach((C,N)=>{N.isValidDocument()||(v=v.add(C))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,y)).next(p=>{h=p;let C=[];for(let N of a){let z=zE(N,h.get(N.key).overlayedDocument);z!=null&&C.push(new Je(N.key,z,Op(z.value.mapValue),Cn.exists(!0)))}return c.mutationQueue.addMutationBatch(f,l,C,a)}).next(p=>{d=p;let C=p.applyToLocalDocumentSet(h,v);return c.documentOverlayCache.saveOverlays(f,p.batchId,C)})}).then(()=>({batchId:d.batchId,changes:Gp(h)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let l=o.Da[o.currentUser.toKey()];l||(l=new rt($)),l=l.insert(a,c),o.Da[o.currentUser.toKey()]=l}(i,r.batchId,e),yield rs(i,r.changes),yield fa(i.remoteStore)}catch(r){let s=bh(r,"Failed to persist write");e.reject(s)}})}function __(n,t){return m(this,null,function*(){let e=F(n);try{let i=yield dI(e.localStore,t);t.targetChanges.forEach((r,s)=>{let o=e.Sa.get(s);o&&(J(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.ma=!0:r.modifiedDocuments.size>0?J(o.ma):r.removedDocuments.size>0&&(J(o.ma),o.ma=!1))}),yield rs(e,i,t)}catch(i){yield ts(i)}})}function Sp(n,t,e){let i=F(n);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){let r=[];i.ga.forEach((s,o)=>{let a=o.view.U_(t);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=F(o);c.onlineState=a;let l=!1;c.queries.forEach((u,h)=>{for(let d of h.Q_)d.U_(a)&&(l=!0)}),l&&Ah(c)}(i.eventManager,t),r.length&&i.fa.u_(r),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function FI(n,t,e){return m(this,null,function*(){let i=F(n);i.sharedClientState.updateQueryState(t,"rejected",e);let r=i.Sa.get(t),s=r&&r.key;if(s){let o=new rt(V.comparator);o=o.insert(s,re.newNoDocument(s,O.min()));let a=q().add(s),c=new zo(O.min(),new Map,new rt($),o,a);yield __(i,c),i.wa=i.wa.remove(s),i.Sa.delete(t),Sh(i)}else yield Mu(i.localStore,t,!1).then(()=>eh(i,t,e)).catch(ts)})}function MI(n,t){return m(this,null,function*(){let e=F(n),i=t.batch.batchId;try{let r=yield hI(e.localStore,t);v_(e,i,null),y_(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),yield rs(e,r)}catch(r){yield ts(r)}})}function LI(n,t,e){return m(this,null,function*(){let i=F(n);try{let r=yield function(o,a){let c=F(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(h=>(J(h!==null),u=h.keys(),c.mutationQueue.removeMutationBatch(l,h))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(i.localStore,t);v_(i,t,e),y_(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),yield rs(i,r)}catch(r){yield ts(r)}})}function y_(n,t){(n.Ca.get(t)||[]).forEach(e=>{e.resolve()}),n.Ca.delete(t)}function v_(n,t,e){let i=F(n),r=i.Da[i.currentUser.toKey()];if(r){let s=r.get(t);s&&(e?s.reject(e):s.resolve(),r=r.remove(t)),i.Da[i.currentUser.toKey()]=r}}function eh(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let i of n.pa.get(t))n.ga.delete(i),e&&n.fa.xa(i,e);n.pa.delete(t),n.isPrimaryClient&&n.ba.Vr(t).forEach(i=>{n.ba.containsKey(i)||w_(n,i)})}function w_(n,t){n.ya.delete(t.path.canonicalString());let e=n.wa.get(t);e!==null&&(h_(n.remoteStore,e),n.wa=n.wa.remove(t),n.Sa.delete(e),Sh(n))}function Cp(n,t,e){for(let i of e)i instanceof ta?(n.ba.addReference(i.key,t),BI(n,i)):i instanceof ea?(T("SyncEngine","Document no longer in limbo: "+i.key),n.ba.removeReference(i.key,t),n.ba.containsKey(i.key)||w_(n,i.key)):P()}function BI(n,t){let e=t.key,i=e.path.canonicalString();n.wa.get(e)||n.ya.has(i)||(T("SyncEngine","New document in limbo: "+e),n.ya.add(i),Sh(n))}function Sh(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){let t=n.ya.values().next().value;n.ya.delete(t);let e=new V(yt.fromString(t)),i=n.va.next();n.Sa.set(i,new Zu(e)),n.wa=n.wa.insert(e,i),u_(n.remoteStore,new Xr(ye(wh(e.path)),i,"TargetPurposeLimboResolution",kp._e))}}function rs(n,t,e){return m(this,null,function*(){let i=F(n),r=[],s=[],o=[];i.ga.isEmpty()||(i.ga.forEach((a,c)=>{o.push(i.Ma(c,t,e).then(l=>{if((l||e)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l?.fromCache?"not-current":"current"),l){r.push(l);let u=ku.Ki(c.targetId,l);s.push(u)}}))}),yield Promise.all(o),i.fa.u_(r),yield function(c,l){return m(this,null,function*(){let u=F(c);try{yield u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>_.forEach(l,d=>_.forEach(d.qi,f=>u.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>_.forEach(d.Qi,f=>u.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!es(h))throw h;T("LocalStore","Failed to update sequence numbers: "+h)}for(let h of l){let d=h.targetId;if(!h.fromCache){let f=u.ns.get(d),y=f.snapshotVersion,v=f.withLastLimboFreeSnapshotVersion(y);u.ns=u.ns.insert(d,v)}}})}(i.localStore,s))})}function qI(n,t){return m(this,null,function*(){let e=F(n);if(!e.currentUser.isEqual(t)){T("SyncEngine","User change. New user:",t.toKey());let i=yield a_(e.localStore,t);e.currentUser=t,function(s,o){s.Ca.forEach(a=>{a.forEach(c=>{c.reject(new x(w.CANCELLED,o))})}),s.Ca.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),yield rs(e,i.us)}})}function UI(n,t){let e=F(n),i=e.Sa.get(t);if(i&&i.ma)return q().add(i.key);{let r=q(),s=e.pa.get(t);if(!s)return r;for(let o of s){let a=e.ga.get(o);r=r.unionWith(a.view.la)}return r}}function zI(n){let t=F(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=__.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=UI.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=FI.bind(null,t),t.fa.u_=DI.bind(null,t.eventManager),t.fa.xa=PI.bind(null,t.eventManager),t}function jI(n){let t=F(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=MI.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=LI.bind(null,t),t}var na=class{constructor(){this.synchronizeTabs=!1}initialize(t){return m(this,null,function*(){this.serializer=l_(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return uI(this.persistence,new Ou,t.initialUser,this.serializer)}createPersistence(t){return new Du(Vu.Hr,this.serializer)}createSharedClientState(t){return new Lu}terminate(){return m(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var nh=class{initialize(t,e){return m(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Sp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=qI.bind(null,this.syncEngine),yield CI(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Hu}()}createDatastore(t){let e=l_(t.databaseInfo.databaseId),i=function(s){return new Uu(s)}(t.databaseInfo);return function(s,o,a,c){return new Gu(s,o,a,c)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(i,r,s,o,a){return new Ku(i,r,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>Sp(this.syncEngine,e,0),function(){return Wo.D()?new Wo:new Bu}())}createSyncEngine(t,e){return function(r,s,o,a,c,l,u){let h=new th(r,s,o,a,c,l);return u&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return m(this,null,function*(){var t;yield function(i){return m(this,null,function*(){let r=F(i);T("RemoteStore","RemoteStore shutting down."),r.v_.add(5),yield is(r),r.M_.shutdown(),r.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};var ih=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):we("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var rh=class{constructor(t,e,i,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=r,this.user=Pt.UNAUTHENTICATED,this.clientId=Bl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>m(this,null,function*(){T("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(T("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(w.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new pe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let i=bh(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}};function Pl(n,t){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener(r=>m(this,null,function*(){i.isEqual(r)||(yield a_(t.localStore,r),i=r)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Rp(n,t){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield $I(n);T("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(i=>Ap(t.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>Ap(t.remoteStore,r)),n._onlineComponents=t})}function GI(n){return n.name==="FirebaseError"?n.code===w.FAILED_PRECONDITION||n.code===w.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function $I(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){T("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Pl(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!GI(e))throw e;Kr("Error using user provided cache. Falling back to memory cache: "+e),yield Pl(n,new na)}}else T("FirestoreClient","Using default OfflineComponentProvider"),yield Pl(n,new na);return n._offlineComponents})}function E_(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(T("FirestoreClient","Using user provided OnlineComponentProvider"),yield Rp(n,n._uninitializedComponentsProvider._online)):(T("FirestoreClient","Using default OnlineComponentProvider"),yield Rp(n,new nh))),n._onlineComponents})}function KI(n){return E_(n).then(t=>t.syncEngine)}function xp(n){return m(this,null,function*(){let t=yield E_(n),e=t.eventManager;return e.onListen=VI.bind(null,t.syncEngine),e.onUnlisten=NI.bind(null,t.syncEngine),e})}function I_(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Dp=new Map;function QI(n,t,e,i){if(t===!0&&i===!0)throw new x(w.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function WI(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(i){return i.constructor?i.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":P()}function No(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new x(w.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=WI(n);throw new x(w.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}var ia=class{constructor(t){var e,i;if(t.host===void 0){if(t.ssl!==void 0)throw new x(w.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(w.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}QI("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=I_((i=t.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(w.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(w.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(w.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},sh=class{constructor(t,e,i,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ia({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(w.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new x(w.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ia(t),t.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new kl;switch(i.type){case"firstParty":return new Fl(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new x(w.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let i=Dp.get(e);i&&(T("ComponentProvider","Removing Datastore"),Dp.delete(e),i.terminate())}(this),Promise.resolve()}};var ra=class n{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Vi=class n{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oh(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},oh=class n extends ra{constructor(t,e,i){super(t,e,wh(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Vi(this.firestore,null,new V(t))}withConverter(t){return new n(this.firestore,t,this._path)}};var ah=class{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Ho(this,"async_queue_retry"),this._u=()=>{let e=Dl();e&&T("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let t=Dl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;let e=Dl();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise(()=>{});let e=new pe;return this.uu(()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.eu.push(t),this.cu()))}cu(){return m(this,null,function*(){if(this.eu.length!==0){try{yield this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!es(t))throw t;T("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo(()=>this.cu())}})}uu(t){let e=this.Xa.then(()=>(this.iu=!0,t().catch(i=>{this.ru=i,this.iu=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw we("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.iu=!1,i))));return this.Xa=e,e}enqueueAfterDelay(t,e,i){this.au(),this.ou.indexOf(t)>-1&&(e=0);let r=Qu.createAndSchedule(this,t,e,i,s=>this.lu(s));return this.nu.push(r),r}au(){this.ru&&P()}verifyOperationInProgress(){}hu(){return m(this,null,function*(){let t;do t=this.Xa,yield t;while(t!==this.Xa)})}Pu(t){for(let e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then(()=>{this.nu.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(let e of this.nu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.hu()})}Tu(t){this.ou.push(t)}lu(t){let e=this.nu.indexOf(t);this.nu.splice(e,1)}};function Pp(n){return function(e,i){if(typeof e!="object"||e===null)return!1;let r=e;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var ki=class extends sh{constructor(t,e,i,r){super(t,e,i,r),this.type="firestore",this._queue=function(){return new ah}(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||b_(this),this._firestoreClient.terminate()}};function T_(n){return n._firestoreClient||b_(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function b_(n){var t,e,i;let r=n._freezeSettings(),s=function(a,c,l,u){return new $l(a,c,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,I_(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new rh(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=r.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}var ch=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(Mt.fromBase64String(t))}catch(e){throw new x(w.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(Mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var sa=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(w.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var lh=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(w.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(w.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return $(this._lat,t._lat)||$(this._long,t._long)}};var HI=new RegExp("[~\\*/\\[\\]]");function YI(n,t,e){if(t.search(HI)>=0)throw Vp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new sa(...t.split("."))._internalPath}catch{throw Vp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Vp(n,t,e,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new x(w.INVALID_ARGUMENT,a+n+c)}var oa=class{constructor(t,e,i,r,s){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Vi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new uh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(A_("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},uh=class extends oa{data(){return super.data()}};function A_(n,t){return typeof t=="string"?YI(n,t):t instanceof sa?t._internalPath:t._delegate._internalPath}function XI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(w.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var hh=class{convertValue(t,e="none"){switch(Dn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ye(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw P()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let i={};return ns(t,(r,s)=>{i[r]=this.convertValue(s,e)}),i}convertGeoPoint(t){return new lh(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":let i=ph(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(Qr(t));default:return null}}convertTimestamp(t){let e=He(t);return new Ht(e.seconds,e.nanos)}convertDocumentKey(t,e){let i=yt.fromString(t);J(o_(i));let r=new qo(i.get(1),i.get(3)),s=new V(i.popFirst(5));return r.isEqual(e)||we(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};var An=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},aa=class extends oa{constructor(t,e,i,r,s,o){super(t,e,i,r,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new vi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let i=this._document.data.field(A_("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}},vi=class extends aa{data(t={}){return super.data(t)}},dh=class{constructor(t,e,i,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new An(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new vi(this._firestore,this._userDataWriter,i.key,i,new An(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(w.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new vi(r._firestore,r._userDataWriter,a.doc.key,a.doc,new An(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new vi(r._firestore,r._userDataWriter,a.doc.key,a.doc,new An(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),l=-1,u=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:JI(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function JI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return P()}}var ca=class extends hh{constructor(t){super(),this.firestore=t}convertBytes(t){return new ch(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vi(this.firestore,null,e)}};function OS(n){return ZI(No(n.firestore,ki),[new Hr(n._key,Cn.none())])}function S_(n,...t){var e,i,r;n=pm(n);let s={includeMetadataChanges:!1},o=0;typeof t[o]!="object"||Pp(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(Pp(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),t[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let c,l,u;if(n instanceof Vi)l=No(n.firestore,ki),u=wh(n._key.path),c={next:h=>{t[o]&&t[o](tT(l,n,h))},error:t[o+1],complete:t[o+2]};else{let h=No(n,ra);l=No(h.firestore,ki),u=h._query;let d=new ca(l);c={next:f=>{t[o]&&t[o](new dh(l,d,h,f))},error:t[o+1],complete:t[o+2]},XI(n._query)}return function(d,f,y,v){let p=new ih(v),C=new Yu(f,p,y);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return RI(yield xp(d),C)})),()=>{p.La(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return xI(yield xp(d),C)}))}}(T_(l),u,a,c)}function ZI(n,t){return function(i,r){let s=new pe;return i.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return OI(yield KI(i),r,s)})),s.promise}(T_(n),t)}function tT(n,t,e){let i=e.docs.get(t._key),r=new ca(n);return new aa(n,r,t._key,i,new An(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(r){Ni=r})(vm),ym(new _m("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new ki(new Nl(i.getProvider("auth-internal")),new Ll(i.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new x(w.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qo(l.options.projectId,u)}(o,r),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Tc(rp,"4.4.2",t),Tc(rp,"4.4.2","esm2017")})();var ma=function(){return ma=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ma.apply(this,arguments)};var eT={includeMetadataChanges:!1};function C_(n,t){return t===void 0&&(t=eT),new Ps(function(e){var i=S_(n,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:i}})}function R_(n){return C_(n,{includeMetadataChanges:!0})}function x_(n,t){return t===void 0&&(t={}),R_(n).pipe(Nf(function(e){return D_(e,t)}))}function D_(n,t){var e;t===void 0&&(t={});var i=n.data(t);return!n.exists()||typeof i!="object"||i===null||!t.idField?i:ma(ma({},i),(e={},e[t.idField]=n.id,e))}var V_=function(n){let t=[],e=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},nT=function(n){let t=[],e=0,i=0;for(;e<n.length;){let r=n[e++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[e++];t[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[e++],o=n[e++],a=n[e++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(c>>10)),t[i++]=String.fromCharCode(56320+(c&1023))}else{let s=n[e++],o=n[e++];t[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return t.join("")},k_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,u=s>>2,h=(s&3)<<4|a>>4,d=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(d=64)),i.push(e[u],e[h],e[d],e[f])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(V_(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):nT(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=e[n.charAt(r++)],a=r<n.length?e[n.charAt(r)]:0;++r;let l=r<n.length?e[n.charAt(r)]:64;++r;let h=r<n.length?e[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||h==null)throw new Ch;let d=s<<2|a>>4;if(i.push(d),l!==64){let f=a<<4&240|l>>2;if(i.push(f),h!==64){let y=l<<6&192|h;i.push(y)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ch=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},iT=function(n){let t=V_(n);return k_.encodeByteArray(t,!0)},P_=function(n){return iT(n).replace(/\./g,"")},rT=function(n){try{return k_.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function sT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var oT=()=>sT().__FIREBASE_DEFAULTS__,aT=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},cT=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&rT(n[1]);return t&&JSON.parse(t)},lT=()=>{try{return oT()||aT()||cT()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},uT=n=>{var t,e;return(e=(t=lT())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},N_=n=>{let t=uT(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]};function O_(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},i=t||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[P_(JSON.stringify(e)),P_(JSON.stringify(o)),""].join(".")}var hT="FirebaseError",ss=class n extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=hT,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Rh.prototype.create)}},Rh=class{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){let i=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],o=s?dT(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new ss(r,a,i)}};function dT(n,t){return n.replace(fT,(e,i)=>{let r=t[i];return r!=null?String(r):`<${i}?>`})}var fT=/\{\$([^}]+)}/g;var HS=4*60*60*1e3;function Te(n){return n&&n._delegate?n._delegate:n}var F_="@firebase/firestore";var vt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};vt.UNAUTHENTICATED=new vt(null),vt.GOOGLE_CREDENTIALS=new vt("google-credentials-uid"),vt.FIRST_PARTY=new vt("first-party-uid"),vt.MOCK_USER=new vt("mock-user");var tr="10.7.0";var Mn=new Ms("@firebase/firestore");function os(){return Mn.logLevel}function A(n,...t){if(Mn.logLevel<=gt.DEBUG){let e=t.map(df);Mn.debug(`Firestore (${tr}): ${n}`,...e)}}function Me(n,...t){if(Mn.logLevel<=gt.ERROR){let e=t.map(df);Mn.error(`Firestore (${tr}): ${n}`,...e)}}function zi(n,...t){if(Mn.logLevel<=gt.WARN){let e=t.map(df);Mn.warn(`Firestore (${tr}): ${n}`,...e)}}function df(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function D(n="Unexpected state"){let t=`FIRESTORE (${tr}) INTERNAL ASSERTION FAILED: `+n;throw Me(t),new Error(t)}function Z(n,t){n||D()}function L(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},b=class extends ss{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var se=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var va=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},kh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(vt.UNAUTHENTICATED))}shutdown(){}},Nh=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Oh=class{constructor(t){this.t=t,this.currentUser=vt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i,r=c=>this.i!==i?(i=this.i,e(c)):Promise.resolve(),s=new se;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new se,t.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>m(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new se)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Z(typeof i.accessToken=="string"),new va(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return Z(t===null||typeof t=="string"),new vt(t)}},Fh=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=vt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Mh=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new Fh(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(vt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Lh=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Bh=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let i=s=>{s.error!=null&&A("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,A("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>i(s))};let r=s=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(Z(typeof e.token=="string"),this.R=e.token,new Lh(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function mT(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}var wa=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,i="";for(;i.length<20;){let r=mT(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<e&&(i+=t.charAt(r[s]%t.length))}return i}};function K(n,t){return n<t?-1:n>t?1:0}function ji(n,t,e){return n.length===t.length&&n.every((i,r)=>e(i,t[r]))}var At=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new b(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new b(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new b(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new b(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new n(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?K(this.nanoseconds,t.nanoseconds):K(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var M=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new At(0,0))}static max(){return new n(new At(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ea=class n{constructor(t,e,i){e===void 0?e=0:e>t.length&&D(),i===void 0?i=t.length-e:i>t.length-e&&D(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let i=Math.min(t.length,e.length);for(let r=0;r<i;r++){let s=t.get(r),o=e.get(r);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},et=class n extends Ea{construct(t,e,i){return new n(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){let e=[];for(let i of t){if(i.indexOf("//")>=0)throw new b(g.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(r=>r.length>0))}return new n(e)}static emptyPath(){return new n([])}},gT=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xt=class n extends Ea{construct(t,e,i){return new n(t,e,i)}static isValidIdentifier(t){return gT.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],i="",r=0,s=()=>{if(i.length===0)throw new b(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""},o=!1;for(;r<t.length;){let a=t[r];if(a==="\\"){if(r+1===t.length)throw new b(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new b(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new b(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var R=class n{constructor(t){this.path=t}static fromPath(t){return new n(et.fromString(t))}static fromName(t){return new n(et.fromString(t).popFirst(5))}static empty(){return new n(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&et.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return et.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new et(t.slice()))}};var qh=class{constructor(t,e,i,r){this.indexId=t,this.collectionGroup=e,this.fields=i,this.indexState=r}};qh.UNKNOWN_ID=-1;function pT(n,t){let e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=M.fromTimestamp(i===1e9?new At(e+1,0):new At(e,i));return new Ln(r,R.empty(),t)}function _T(n){return new Ln(n.readTime,n.key,-1)}var Ln=class n{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new n(M.min(),R.empty(),-1)}static max(){return new n(M.max(),R.empty(),-1)}};function yT(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=R.comparator(n.documentKey,t.documentKey),e!==0?e:K(n.largestBatchId,t.largestBatchId))}var vT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Uh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function bs(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==vT)throw n;A("LocalStore","Unexpectedly lost primary lease")})}var E=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(e,s).next(i,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,i)=>{e(t)})}static reject(t){return new n((e,i)=>{i(t)})}static waitFor(t){return new n((e,i)=>{let r=0,s=0,o=!1;t.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&e()},c=>i(c))}),o=!0,s===r&&e()})}static or(t){let e=n.resolve(!1);for(let i of t)e=e.next(r=>r?n.resolve(r):i());return e}static forEach(t,e){let i=[];return t.forEach((r,s)=>{i.push(e.call(this,r,s))}),this.waitFor(i)}static mapArray(t,e){return new n((i,r)=>{let s=t.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let l=c;e(t[l]).next(u=>{o[l]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(t,e){return new n((i,r)=>{let s=()=>{t()===!0?e().next(()=>{s()},r):i()};s()})}};function As(n){return n.name==="IndexedDbTransactionError"}var dy=(()=>{class n{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=r=>this.se(r),this.oe=r=>i.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function tc(n){return n==null}function ds(n){return n===0&&1/n==-1/0}function wT(n){return typeof n=="number"&&Number.isInteger(n)&&!ds(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var ET=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],aC=[...ET,"documentOverlays"],IT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],TT=IT,cC=[...TT,"indexConfiguration","indexState","indexEntries"];function M_(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function $n(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function fy(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var ot=class n{constructor(t,e){this.comparator=t,this.root=e||Ae.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ae.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ae.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(t,i.key);if(r===0)return e+i.left.size;r<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){let t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Bi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Bi(this.root,t,this.comparator,!1)}getReverseIterator(){return new Bi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Bi(this.root,t,this.comparator,!0)}},Bi=class{constructor(t,e,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?i(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Ae=class n{constructor(t,e,i,r,s){this.key=t,this.value=e,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,r,s){return new n(t??this.key,e??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this,s=i(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,i),null):s===0?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),e(t,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();let t=this.left.check();if(t!==this.right.check())throw D();return t+(this.isRed()?0:1)}};Ae.EMPTY=null,Ae.RED=!0,Ae.BLACK=!1;Ae.EMPTY=new class{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(t,e,i,r,s){return this}insert(t,e,i){return new Ae(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Nt=class n{constructor(t){this.comparator=t,this.data=new ot(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){let i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ia(this.data.getIterator())}getIteratorFrom(t){return new Ia(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Ia=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var te=class n{constructor(t){this.fields=t,t.sort(Xt.comparator)}static empty(){return new n([])}unionWith(t){let e=new Nt(Xt.comparator);for(let i of this.fields)e=e.add(i);for(let i of t)e=e.add(i);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ji(this.fields,t.fields,(e,i)=>e.isEqual(i))}};var Ta=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Lt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ta("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return K(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Lt.EMPTY_BYTE_STRING=new Lt("");var bT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nn(n){if(Z(!!n),typeof n=="string"){let t=0,e=bT.exec(n);if(Z(!!e),e[1]){let r=e[1];r=(r+"000000000").substr(0,9),t=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:st(n.seconds),nanos:st(n.nanos)}}function st(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rn(n){return typeof n=="string"?Lt.fromBase64String(n):Lt.fromUint8Array(n)}function ff(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function mf(n){let t=n.mapValue.fields.__previous_value__;return ff(t)?mf(t):t}function fs(n){let t=nn(n.mapValue.fields.__local_write_time__.timestampValue);return new At(t.seconds,t.nanos)}var zh=class{constructor(t,e,i,r,s,o,a,c,l){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}},ba=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var ga={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ff(n)?4:my(n)?9007199254740991:10:D()}function Re(n,t){if(n===t)return!0;let e=Bn(n);if(e!==Bn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return fs(n).isEqual(fs(t));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=nn(r.timestampValue),a=nn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(r,s){return rn(r.bytesValue).isEqual(rn(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(r,s){return st(r.geoPointValue.latitude)===st(s.geoPointValue.latitude)&&st(r.geoPointValue.longitude)===st(s.geoPointValue.longitude)}(n,t);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return st(r.integerValue)===st(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=st(r.doubleValue),a=st(s.doubleValue);return o===a?ds(o)===ds(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return ji(n.arrayValue.values||[],t.arrayValue.values||[],Re);case 10:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(M_(o)!==M_(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Re(o[c],a[c])))return!1;return!0}(n,t);default:return D()}}function ms(n,t){return(n.values||[]).find(e=>Re(e,t))!==void 0}function Gi(n,t){if(n===t)return 0;let e=Bn(n),i=Bn(t);if(e!==i)return K(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return K(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=st(s.integerValue||s.doubleValue),c=st(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,t);case 3:return L_(n.timestampValue,t.timestampValue);case 4:return L_(fs(n),fs(t));case 5:return K(n.stringValue,t.stringValue);case 6:return function(s,o){let a=rn(s),c=rn(o);return a.compareTo(c)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){let u=K(a[l],c[l]);if(u!==0)return u}return K(a.length,c.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=K(st(s.latitude),st(o.latitude));return a!==0?a:K(st(s.longitude),st(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let l=0;l<a.length&&l<c.length;++l){let u=Gi(a[l],c[l]);if(u)return u}return K(a.length,c.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===ga.mapValue&&o===ga.mapValue)return 0;if(s===ga.mapValue)return 1;if(o===ga.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let h=0;h<c.length&&h<u.length;++h){let d=K(c[h],u[h]);if(d!==0)return d;let f=Gi(a[c[h]],l[u[h]]);if(f!==0)return f}return K(c.length,u.length)}(n.mapValue,t.mapValue);default:throw D()}}function L_(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return K(n,t);let e=nn(n),i=nn(t),r=K(e.seconds,i.seconds);return r!==0?r:K(e.nanos,i.nanos)}function $i(n){return jh(n)}function jh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let i=nn(e);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return rn(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return R.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let i="[",r=!0;for(let s of e.values||[])r?r=!1:i+=",",i+=jh(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(e){let i=Object.keys(e.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${jh(e.fields[o])}`;return r+"}"}(n.mapValue):D()}function B_(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Gh(n){return!!n&&"integerValue"in n}function gf(n){return!!n&&"arrayValue"in n}function q_(n){return!!n&&"nullValue"in n}function U_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function _a(n){return!!n&&"mapValue"in n}function cs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return $n(n.mapValue.fields,(e,i)=>t.mapValue.fields[e]=cs(i)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=cs(n.arrayValue.values[e]);return t}return Object.assign({},n)}function my(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Yt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!_a(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=cs(e)}setAll(t){let e=Xt.emptyPath(),i={},r=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let c=this.getFieldsMap(e);this.applyChanges(c,i,r),i={},r=[],e=a.popLast()}o?i[a.lastSegment()]=cs(o):r.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,i,r)}delete(t){let e=this.field(t.popLast());_a(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Re(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let r=e.mapValue.fields[t.get(i)];_a(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,i){$n(e,(r,s)=>t[r]=s);for(let r of i)delete t[r]}clone(){return new n(cs(this.value))}};function gy(n){let t=[];return $n(n.fields,(e,i)=>{let r=new Xt([e]);if(_a(i)){let s=gy(i.mapValue).fields;if(s.length===0)t.push(r);else for(let o of s)t.push(r.child(o))}else t.push(r)}),new te(t)}var oe=class n{constructor(t,e,i,r,s,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,M.min(),M.min(),M.min(),Yt.empty(),0)}static newFoundDocument(t,e,i,r){return new n(t,1,e,M.min(),i,r,0)}static newNoDocument(t,e){return new n(t,2,e,M.min(),M.min(),Yt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,M.min(),M.min(),Yt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(M.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=M.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ki=class{constructor(t,e){this.position=t,this.inclusive=e}};function z_(n,t,e){let i=0;for(let r=0;r<n.position.length;r++){let s=t[r],o=n.position[r];if(s.field.isKeyField()?i=R.comparator(R.fromName(o.referenceValue),e.key):i=Gi(o,e.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function j_(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Re(n.position[e],t.position[e]))return!1;return!0}var qn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function AT(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Aa=class{},dt=class n extends Aa{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new Kh(t,e,i):e==="array-contains"?new Hh(t,i):e==="in"?new Yh(t,i):e==="not-in"?new Xh(t,i):e==="array-contains-any"?new Jh(t,i):new n(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new Qh(t,i):new Wh(t,i)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Gi(e,this.value)):e!==null&&Bn(this.value)===Bn(e)&&this.matchesComparison(Gi(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ae=class n extends Aa{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return py(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function py(n){return n.op==="and"}function _y(n){return ST(n)&&py(n)}function ST(n){for(let t of n.filters)if(t instanceof ae)return!1;return!0}function $h(n){if(n instanceof dt)return n.field.canonicalString()+n.op.toString()+$i(n.value);if(_y(n))return n.filters.map(t=>$h(t)).join(",");{let t=n.filters.map(e=>$h(e)).join(",");return`${n.op}(${t})`}}function yy(n,t){return n instanceof dt?function(i,r){return r instanceof dt&&i.op===r.op&&i.field.isEqual(r.field)&&Re(i.value,r.value)}(n,t):n instanceof ae?function(i,r){return r instanceof ae&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&yy(o,r.filters[a]),!0):!1}(n,t):void D()}function vy(n){return n instanceof dt?function(e){return`${e.field.canonicalString()} ${e.op} ${$i(e.value)}`}(n):n instanceof ae?function(e){return e.op.toString()+" {"+e.getFilters().map(vy).join(" ,")+"}"}(n):"Filter"}var Kh=class extends dt{constructor(t,e,i){super(t,e,i),this.key=R.fromName(i.referenceValue)}matches(t){let e=R.comparator(t.key,this.key);return this.matchesComparison(e)}},Qh=class extends dt{constructor(t,e){super(t,"in",e),this.keys=wy("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Wh=class extends dt{constructor(t,e){super(t,"not-in",e),this.keys=wy("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function wy(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>R.fromName(i.referenceValue))}var Hh=class extends dt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return gf(e)&&ms(e.arrayValue,this.value)}},Yh=class extends dt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ms(this.value.arrayValue,e)}},Xh=class extends dt{constructor(t,e){super(t,"not-in",e)}matches(t){if(ms(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!ms(this.value.arrayValue,e)}},Jh=class extends dt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!gf(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>ms(this.value.arrayValue,i))}};var Zh=class{constructor(t,e=null,i=[],r=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function G_(n,t=null,e=[],i=[],r=null,s=null,o=null){return new Zh(n,t,e,i,r,s,o)}function pf(n){let t=L(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>$h(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),tc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>$i(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>$i(i)).join(",")),t.ce=e}return t.ce}function _f(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!AT(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!yy(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!j_(n.startAt,t.startAt)&&j_(n.endAt,t.endAt)}function td(n){return R.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var sn=class{constructor(t,e=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function CT(n,t,e,i,r,s,o,a){return new sn(n,t,e,i,r,s,o,a)}function yf(n){return new sn(n)}function $_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ey(n){return n.collectionGroup!==null}function ls(n){let t=L(n);if(t.le===null){t.le=[];let e=new Set;for(let s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());let i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Nt(Xt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new qn(s,i))}),e.has(Xt.keyField().canonicalString())||t.le.push(new qn(Xt.keyField(),i))}return t.le}function Se(n){let t=L(n);return t.he||(t.he=RT(t,ls(n))),t.he}function RT(n,t){if(n.limitType==="F")return G_(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new qn(r.field,s)});let e=n.endAt?new Ki(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Ki(n.startAt.position,n.startAt.inclusive):null;return G_(n.path,n.collectionGroup,t,n.filters,n.limit,e,i)}}function ed(n,t){let e=n.filters.concat([t]);return new sn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Sa(n,t,e){return new sn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function ec(n,t){return _f(Se(n),Se(t))&&n.limitType===t.limitType}function Iy(n){return`${pf(Se(n))}|lt:${n.limitType}`}function Fi(n){return`Query(target=${function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map(r=>vy(r)).join(", ")}]`),tc(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(r=>$i(r)).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(r=>$i(r)).join(",")),`Target(${i})`}(Se(n))}; limitType=${n.limitType})`}function nc(n,t){return t.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):R.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,t)&&function(i,r){for(let s of ls(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,t)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,t)&&function(i,r){return!(i.startAt&&!function(o,a,c){let l=z_(o,a,c);return o.inclusive?l<=0:l<0}(i.startAt,ls(i),r)||i.endAt&&!function(o,a,c){let l=z_(o,a,c);return o.inclusive?l>=0:l>0}(i.endAt,ls(i),r))}(n,t)}function xT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ty(n){return(t,e)=>{let i=!1;for(let r of ls(n)){let s=DT(r,t,e);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function DT(n,t,e){let i=n.field.isKeyField()?R.comparator(t.key,e.key):function(s,o,a){let c=o.data.field(s),l=a.data.field(s);return c!==null&&l!==null?Gi(c,l):D()}(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return D()}}var on=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let i=this.mapKeyFn(t),r=this.inner[i];if(r===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],t))return i.length===1?delete this.inner[e]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(t){$n(this.inner,(e,i)=>{for(let[r,s]of i)t(r,s)})}isEmpty(){return fy(this.inner)}size(){return this.innerSize}};var PT=new ot(R.comparator);function Le(){return PT}var by=new ot(R.comparator);function as(...n){let t=by;for(let e of n)t=t.insert(e.key,e);return t}function Ay(n){let t=by;return n.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function Nn(){return us()}function Sy(){return us()}function us(){return new on(n=>n.toString(),(n,t)=>n.isEqual(t))}var VT=new ot(R.comparator),kT=new Nt(R.comparator);function U(...n){let t=kT;for(let e of n)t=t.add(e);return t}var NT=new Nt(K);function OT(){return NT}function Cy(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ds(t)?"-0":t}}function Ry(n){return{integerValue:""+n}}function FT(n,t){return wT(t)?Ry(t):Cy(n,t)}var Qi=class{constructor(){this._=void 0}};function MT(n,t,e){return n instanceof Wi?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&ff(s)&&(s=mf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof Un?Dy(n,t):n instanceof zn?Py(n,t):function(r,s){let o=xy(r,s),a=K_(o)+K_(r.Ie);return Gh(o)&&Gh(r.Ie)?Ry(a):Cy(r.serializer,a)}(n,t)}function LT(n,t,e){return n instanceof Un?Dy(n,t):n instanceof zn?Py(n,t):e}function xy(n,t){return n instanceof Hi?function(i){return Gh(i)||function(s){return!!s&&"doubleValue"in s}(i)}(t)?t:{integerValue:0}:null}var Wi=class extends Qi{},Un=class extends Qi{constructor(t){super(),this.elements=t}};function Dy(n,t){let e=Vy(t);for(let i of n.elements)e.some(r=>Re(r,i))||e.push(i);return{arrayValue:{values:e}}}var zn=class extends Qi{constructor(t){super(),this.elements=t}};function Py(n,t){let e=Vy(t);for(let i of n.elements)e=e.filter(r=>!Re(r,i));return{arrayValue:{values:e}}}var Hi=class extends Qi{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function K_(n){return st(n.integerValue||n.doubleValue)}function Vy(n){return gf(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function BT(n,t){return n.field.isEqual(t.field)&&function(i,r){return i instanceof Un&&r instanceof Un||i instanceof zn&&r instanceof zn?ji(i.elements,r.elements,Re):i instanceof Hi&&r instanceof Hi?Re(i.Ie,r.Ie):i instanceof Wi&&r instanceof Wi}(n.transform,t.transform)}var nd=class{constructor(t,e){this.version=t,this.transformResults=e}},tn=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function ya(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Yi=class{};function ky(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Ca(n.key,tn.none()):new jn(n.key,n.data,tn.none());{let e=n.data,i=Yt.empty(),r=new Nt(Xt.comparator);for(let s of t.fields)if(!r.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new xe(n.key,i,new te(r.toArray()),tn.none())}}function qT(n,t,e){n instanceof jn?function(r,s,o){let a=r.value.clone(),c=W_(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof xe?function(r,s,o){if(!ya(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=W_(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Ny(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,t,e):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function hs(n,t,e,i){return n instanceof jn?function(s,o,a,c){if(!ya(s.precondition,o))return a;let l=s.value.clone(),u=H_(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,t,e,i):n instanceof xe?function(s,o,a,c){if(!ya(s.precondition,o))return a;let l=H_(s.fieldTransforms,c,o),u=o.data;return u.setAll(Ny(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,i):function(s,o,a){return ya(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function UT(n,t){let e=null;for(let i of n.fieldTransforms){let r=t.data.field(i.field),s=xy(i.transform,r||null);s!=null&&(e===null&&(e=Yt.empty()),e.set(i.field,s))}return e||null}function Q_(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&ji(i,r,(s,o)=>BT(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var jn=class extends Yi{constructor(t,e,i,r=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},xe=class extends Yi{constructor(t,e,i,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Ny(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let i=n.data.field(e);t.set(e,i)}}),t}function W_(n,t,e){let i=new Map;Z(n.length===e.length);for(let r=0;r<e.length;r++){let s=n[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,LT(o,a,e[r]))}return i}function H_(n,t,e){let i=new Map;for(let r of n){let s=r.transform,o=e.data.field(r.field);i.set(r.field,MT(s,o,t))}return i}var Ca=class extends Yi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},id=class extends Yi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var rd=class{constructor(t,e,i,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(t,e){let i=e.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(t.key)&&qT(s,t,i[r])}}applyToLocalView(t,e){for(let i of this.baseMutations)i.key.isEqual(t.key)&&(e=hs(i,t,e,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(t.key)&&(e=hs(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let i=Sy();return this.mutations.forEach(r=>{let s=t.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(r.key)?null:a;let c=ky(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(M.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),U())}isEqual(t){return this.batchId===t.batchId&&ji(this.mutations,t.mutations,(e,i)=>Q_(e,i))&&ji(this.baseMutations,t.baseMutations,(e,i)=>Q_(e,i))}},sd=class n{constructor(t,e,i,r){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=r}static from(t,e,i){Z(t.mutations.length===i.length);let r=function(){return VT}(),s=t.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(t,e,i,r)}};var od=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ad=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ut,G;function zT(n){switch(n){default:return D();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Oy(n){if(n===void 0)return Me("GRPC error has no .code"),g.UNKNOWN;switch(n){case ut.OK:return g.OK;case ut.CANCELLED:return g.CANCELLED;case ut.UNKNOWN:return g.UNKNOWN;case ut.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case ut.INTERNAL:return g.INTERNAL;case ut.UNAVAILABLE:return g.UNAVAILABLE;case ut.UNAUTHENTICATED:return g.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case ut.NOT_FOUND:return g.NOT_FOUND;case ut.ALREADY_EXISTS:return g.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return g.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case ut.ABORTED:return g.ABORTED;case ut.OUT_OF_RANGE:return g.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return g.UNIMPLEMENTED;case ut.DATA_LOSS:return g.DATA_LOSS;default:return D()}}(G=ut||(ut={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var Y_=null;function jT(){return new TextEncoder}var GT=new qt([4294967295,4294967295],0);function X_(n){let t=jT().encode(n),e=new xo;return e.update(t),new Uint8Array(e.digest())}function J_(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new qt([e,i],0),new qt([r,s],0)]}var cd=class n{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new On(`Invalid padding: ${e}`);if(i<0)throw new On(`Invalid hash count: ${i}`);if(t.length>0&&this.hashCount===0)throw new On(`Invalid hash count: ${i}`);if(t.length===0&&e!==0)throw new On(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=qt.fromNumber(this.Te)}de(t,e,i){let r=t.add(e.multiply(qt.fromNumber(i)));return r.compare(GT)===1&&(r=new qt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=X_(t),[i,r]=J_(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);if(!this.Ae(o))return!1}return!0}static create(t,e,i){let r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,r,e);return i.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=X_(t),[i,r]=J_(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);this.Re(o)}}Re(t){let e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}},On=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ra=class n{constructor(t,e,i,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,i){let r=new Map;return r.set(t,gs.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new n(M.min(),r,new ot(K),Le(),U())}},gs=class n{constructor(t,e,i,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new n(i,e,U(),U(),U())}};var qi=class{constructor(t,e,i,r){this.Ve=t,this.removedTargetIds=e,this.key=i,this.me=r}},xa=class{constructor(t,e){this.targetId=t,this.fe=e}},Da=class{constructor(t,e,i=Lt.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=r}},Pa=class{constructor(){this.ge=0,this.pe=ty(),this.ye=Lt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=U(),e=U(),i=U();return this.pe.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:i=i.add(r);break;default:D()}}),new gs(this.ye,this.we,t,e,i)}Fe(){this.Se=!1,this.pe=ty()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Z(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},ld=class{constructor(t){this.Le=t,this.ke=new Map,this.qe=Le(),this.Qe=Z_(),this.Ke=new ot(K)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let i=this.ze(e);switch(t.state){case 0:this.je(e)&&i.Ce(t.resumeToken);break;case 1:i.Ne(),i.be||i.Fe(),i.Ce(t.resumeToken);break;case 2:i.Ne(),i.be||this.removeTarget(e);break;case 3:this.je(e)&&(i.Be(),i.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),i.Ce(t.resumeToken));break;default:D()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((i,r)=>{this.je(r)&&e(r)})}Je(t){let e=t.targetId,i=t.fe.count,r=this.Ye(e);if(r){let s=r.target;if(td(s))if(i===0){let o=new R(s.path);this.We(e,o,oe.newNoDocument(o,M.min()))}else Z(i===1);else{let o=this.Ze(e);if(o!==i){let a=this.Xe(t),c=a?this.et(a,t,o):1;if(c!==0){this.He(e);let l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,l)}Y_?.tt(function(u,h,d,f,y){var v,p,C,N,z,X;let Ot={localCacheCount:u,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},Q=h.unchangedNames;return Q&&(Ot.bloomFilter={applied:y===0,hashCount:(v=Q?.hashCount)!==null&&v!==void 0?v:0,bitmapLength:(N=(C=(p=Q?.bits)===null||p===void 0?void 0:p.bitmap)===null||C===void 0?void 0:C.length)!==null&&N!==void 0?N:0,padding:(X=(z=Q?.bits)===null||z===void 0?void 0:z.padding)!==null&&X!==void 0?X:0,mightContain:zt=>{var De;return(De=f?.mightContain(zt))!==null&&De!==void 0&&De}}),Ot}(o,t.fe,this.Le.nt(),a,c))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=e,o,a;try{o=rn(i).toUint8Array()}catch(c){if(c instanceof Ta)return zi("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new cd(o,r,s)}catch(c){return zi(c instanceof On?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(t,e,i){return e.fe.count===i-this.rt(t,e.targetId)?0:2}rt(t,e){let i=this.Le.getRemoteKeysForTarget(e),r=0;return i.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),r++)}),r}it(t){let e=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&td(a.target)){let c=new R(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,oe.newNoDocument(c,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let i=U();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let l=this.Ye(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let r=new Ra(t,e,this.Ke,this.qe,i);return this.qe=Le(),this.Qe=Z_(),this.Ke=new ot(K),r}Ue(t,e){if(!this.je(t))return;let i=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,i),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,i){if(!this.je(t))return;let r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),i&&(this.qe=this.qe.insert(e,i))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Pa,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Nt(K),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||A("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new Pa),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function Z_(){return new ot(R.comparator)}function ty(){return new ot(R.comparator)}var $T={asc:"ASCENDING",desc:"DESCENDING"},KT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},QT={and:"AND",or:"OR"},ud=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function hd(n,t){return n.useProto3Json||tc(t)?t:{value:t}}function Va(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Fy(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function WT(n,t){return Va(n,t.toTimestamp())}function Ce(n){return Z(!!n),M.fromTimestamp(function(e){let i=nn(e);return new At(i.seconds,i.nanos)}(n))}function vf(n,t){return function(i){return new et(["projects",i.projectId,"databases",i.database])}(n).child("documents").child(t).canonicalString()}function My(n){let t=et.fromString(n);return Z(Uy(t)),t}function dd(n,t){return vf(n.databaseId,t.path)}function xh(n,t){let e=My(t);if(e.get(1)!==n.databaseId.projectId)throw new b(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new b(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new R(Ly(e))}function fd(n,t){return vf(n.databaseId,t)}function HT(n){let t=My(n);return t.length===4?et.emptyPath():Ly(t)}function md(n){return new et(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ly(n){return Z(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function ey(n,t,e){return{name:dd(n,t),fields:e.value.mapValue.fields}}function YT(n,t){let e;if("targetChange"in t){t.targetChange;let i=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:D()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?(Z(u===void 0||typeof u=="string"),Lt.fromBase64String(u||"")):(Z(u===void 0||u instanceof Uint8Array),Lt.fromUint8Array(u||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(l){let u=l.code===void 0?g.UNKNOWN:Oy(l.code);return new b(u,l.message||"")}(o);e=new Da(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=xh(n,i.document.name),s=Ce(i.document.updateTime),o=i.document.createTime?Ce(i.document.createTime):M.min(),a=new Yt({mapValue:{fields:i.document.fields}}),c=oe.newFoundDocument(r,s,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];e=new qi(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=xh(n,i.document),s=i.readTime?Ce(i.readTime):M.min(),o=oe.newNoDocument(r,s),a=i.removedTargetIds||[];e=new qi([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=xh(n,i.document),s=i.removedTargetIds||[];e=new qi([],s,r,null)}else{if(!("filter"in t))return D();{t.filter;let i=t.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new ad(r,s),a=i.targetId;e=new xa(a,o)}}return e}function XT(n,t){let e;if(t instanceof jn)e={update:ey(n,t.key,t.value)};else if(t instanceof Ca)e={delete:dd(n,t.key)};else if(t instanceof xe)e={update:ey(n,t.key,t.data),updateMask:o0(t.fieldMask)};else{if(!(t instanceof id))return D();e={verify:dd(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof Wi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Un)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Hi)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw D()}(0,i))),t.precondition.isNone||(e.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:WT(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:D()}(n,t.precondition)),e}function JT(n,t){return n&&n.length>0?(Z(t!==void 0),n.map(e=>function(r,s){let o=r.updateTime?Ce(r.updateTime):Ce(s);return o.isEqual(M.min())&&(o=Ce(s)),new nd(o,r.transformResults||[])}(e,t))):[]}function ZT(n,t){return{documents:[fd(n,t.path)]}}function t0(n,t){let e={structuredQuery:{}},i=t.path;t.collectionGroup!==null?(e.parent=fd(n,i),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=fd(n,i.popLast()),e.structuredQuery.from=[{collectionId:i.lastSegment()}]);let r=function(c){if(c.length!==0)return qy(ae.create(c,"and"))}(t.filters);r&&(e.structuredQuery.where=r);let s=function(c){if(c.length!==0)return c.map(l=>function(h){return{field:Mi(h.field),direction:i0(h.dir)}}(l))}(t.orderBy);s&&(e.structuredQuery.orderBy=s);let o=hd(n,t.limit);return o!==null&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),e}function e0(n){let t=HT(n.parent),e=n.structuredQuery,i=e.from?e.from.length:0,r=null;if(i>0){Z(i===1);let u=e.from[0];u.allDescendants?r=u.collectionId:t=t.child(u.collectionId)}let s=[];e.where&&(s=function(h){let d=By(h);return d instanceof ae&&_y(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(y){return new qn(Li(y.field),function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,tc(d)?null:d}(e.limit));let c=null;e.startAt&&(c=function(h){let d=!!h.before,f=h.values||[];return new Ki(f,d)}(e.startAt));let l=null;return e.endAt&&(l=function(h){let d=!h.before,f=h.values||[];return new Ki(f,d)}(e.endAt)),CT(t,r,o,s,a,"F",c,l)}function n0(n,t){let e=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function By(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let i=Li(e.unaryFilter.field);return dt.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Li(e.unaryFilter.field);return dt.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Li(e.unaryFilter.field);return dt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Li(e.unaryFilter.field);return dt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return D()}}(n):n.fieldFilter!==void 0?function(e){return dt.create(Li(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return ae.create(e.compositeFilter.filters.map(i=>By(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return D()}}(e.compositeFilter.op))}(n):D()}function i0(n){return $T[n]}function r0(n){return KT[n]}function s0(n){return QT[n]}function Mi(n){return{fieldPath:n.canonicalString()}}function Li(n){return Xt.fromServerFormat(n.fieldPath)}function qy(n){return n instanceof dt?function(e){if(e.op==="=="){if(U_(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NAN"}};if(q_(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(U_(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NOT_NAN"}};if(q_(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mi(e.field),op:r0(e.op),value:e.value}}}(n):n instanceof ae?function(e){let i=e.getFilters().map(r=>qy(r));return i.length===1?i[0]:{compositeFilter:{op:s0(e.op),filters:i}}}(n):D()}function o0(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Uy(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ps=class n{constructor(t,e,i,r,s=M.min(),o=M.min(),a=Lt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var gd=class{constructor(t){this.ut=t}};function a0(n){let t=e0({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Sa(t,t.limit,"L"):t}var ka=class{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(st(t.integerValue));else if("doubleValue"in t){let i=st(t.doubleValue);isNaN(i)?this.Tt(e,13):(this.Tt(e,15),ds(i)?e.Et(0):e.Et(i))}else if("timestampValue"in t){let i=t.timestampValue;this.Tt(e,20),typeof i=="string"?e.dt(i):(e.dt(`${i.seconds||""}`),e.Et(i.nanos||0))}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(rn(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){let i=t.geoPointValue;this.Tt(e,45),e.Et(i.latitude||0),e.Et(i.longitude||0)}else"mapValue"in t?my(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):D()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){let i=t.fields||{};this.Tt(e,55);for(let r of Object.keys(i))this.At(r,e),this.Pt(i[r],e)}yt(t,e){let i=t.values||[];this.Tt(e,50);for(let r of i)this.Pt(r,e)}ft(t,e){this.Tt(e,37),R.fromName(t).path.forEach(i=>{this.Tt(e,60),this.wt(i,e)})}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}};ka.St=new ka;var pd=class{constructor(){this.on=new _d}addToCollectionParentIndex(t,e){return this.on.add(e),E.resolve()}getCollectionParents(t,e){return E.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return E.resolve()}deleteFieldIndex(t,e){return E.resolve()}deleteAllFieldIndexes(t){return E.resolve()}createTargetIndexes(t,e){return E.resolve()}getDocumentsMatchingTarget(t,e){return E.resolve(null)}getIndexType(t,e){return E.resolve(0)}getFieldIndexes(t,e){return E.resolve([])}getNextCollectionGroupToUpdate(t){return E.resolve(null)}getMinOffset(t,e){return E.resolve(Ln.min())}getMinOffsetFromCollectionGroup(t,e){return E.resolve(Ln.min())}updateCollectionGroup(t,e,i){return E.resolve()}updateIndexEntries(t,e){return E.resolve()}},_d=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e]||new Nt(et.comparator),s=!r.has(i);return this.index[e]=r.add(i),s}has(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e];return r&&r.has(i)}getEntries(t){return(this.index[t]||new Nt(et.comparator)).toArray()}};var uC=new Uint8Array(0);var be=class n{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};be.DEFAULT_COLLECTION_PERCENTILE=10,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,be.DEFAULT=new be(41943040,be.DEFAULT_COLLECTION_PERCENTILE,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),be.DISABLED=new be(-1,0,0);var _s=class n{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var yd=class{constructor(){this.changes=new on(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,oe.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let i=this.changes.get(e);return i!==void 0?E.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var vd=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var wd=class{constructor(t,e,i,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=r}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(i=r,this.remoteDocumentCache.getEntry(t,e))).next(r=>(i!==null&&hs(i.mutation,r,te.empty(),At.now()),r))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,U()).next(()=>i))}getLocalViewOfDocuments(t,e,i=U()){let r=Nn();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,i).next(s=>{let o=as();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let i=Nn();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,U()))}populateOverlays(t,e,i){let r=[];return i.forEach(s=>{e.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(t,r).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,i,r){let s=Le(),o=us(),a=function(){return us()}();return e.forEach((c,l)=>{let u=i.get(l.key);r.has(l.key)&&(u===void 0||u.mutation instanceof xe)?s=s.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),hs(u.mutation,l,u.mutation.getFieldMask(),At.now())):o.set(l.key,te.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),e.forEach((l,u)=>{var h;return a.set(l,new vd(u,(h=o.get(l))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let i=us(),r=new ot((o,a)=>o-a),s=U();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(c=>{let l=e.get(c);if(l===null)return;let u=i.get(c)||te.empty();u=a.applyToLocalView(l,u),i.set(c,u);let h=(r.get(a.batchId)||U()).add(c);r=r.insert(a.batchId,h)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),l=c.key,u=c.value,h=Sy();u.forEach(d=>{if(!s.has(d)){let f=ky(e.get(d),i.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,l,h))}return E.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i,r){return function(o){return R.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ey(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,r):this.getDocumentsMatchingCollectionQuery(t,e,i,r)}getNextDocuments(t,e,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,r-s.size):E.resolve(Nn()),a=-1,c=s;return o.next(l=>E.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?E.resolve():this.remoteDocumentCache.getEntry(t,u).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(t,l,s)).next(()=>this.computeViews(t,c,l,U())).next(u=>({batchId:a,changes:Ay(u)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new R(e)).next(i=>{let r=as();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(t,e,i,r){let s=e.collectionGroup,o=as();return this.indexManager.getCollectionParents(t,s).next(a=>E.forEach(a,c=>{let l=function(h,d){return new sn(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,l,i,r).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,s,r))).next(o=>{s.forEach((c,l)=>{let u=l.getKey();o.get(u)===null&&(o=o.insert(u,oe.newInvalidDocument(u)))});let a=as();return o.forEach((c,l)=>{let u=s.get(c);u!==void 0&&hs(u.mutation,l,te.empty(),At.now()),nc(e,l)&&(a=a.insert(c,l))}),a})}};var Ed=class{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return E.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(r){return{id:r.id,version:r.version,createTime:Ce(r.createTime)}}(e)),E.resolve()}getNamedQuery(t,e){return E.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(r){return{name:r.name,query:a0(r.bundledQuery),readTime:Ce(r.readTime)}}(e)),E.resolve()}};var Id=class{constructor(){this.overlays=new ot(R.comparator),this.lr=new Map}getOverlay(t,e){return E.resolve(this.overlays.get(e))}getOverlays(t,e){let i=Nn();return E.forEach(e,r=>this.getOverlay(t,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((r,s)=>{this.lt(t,e,s)}),E.resolve()}removeOverlaysForBatchId(t,e,i){let r=this.lr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(i)),E.resolve()}getOverlaysForCollection(t,e,i){let r=Nn(),s=e.length+1,o=new R(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,l=c.getKey();if(!e.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return E.resolve(r)}getOverlaysForCollectionGroup(t,e,i,r){let s=new ot((l,u)=>l-u),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===e&&l.largestBatchId>i){let u=s.get(l.largestBatchId);u===null&&(u=Nn(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}let a=Nn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=r)););return E.resolve(a)}lt(t,e,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.lr.get(r.largestBatchId).delete(i.key);this.lr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new od(e,i));let s=this.lr.get(e);s===void 0&&(s=U(),this.lr.set(e,s)),this.lr.set(e,s.add(i.key))}};var ys=class{constructor(){this.hr=new Nt(ht.Pr),this.Ir=new Nt(ht.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){let i=new ht(t,e);this.hr=this.hr.add(i),this.Ir=this.Ir.add(i)}Er(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.dr(new ht(t,e))}Ar(t,e){t.forEach(i=>this.removeReference(i,e))}Rr(t){let e=new R(new et([])),i=new ht(e,t),r=new ht(e,t+1),s=[];return this.Ir.forEachInRange([i,r],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(t=>this.dr(t))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){let e=new R(new et([])),i=new ht(e,t),r=new ht(e,t+1),s=U();return this.Ir.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new ht(t,0),i=this.hr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}},ht=class{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return R.comparator(t.key,e.key)||K(t.gr,e.gr)}static Tr(t,e){return K(t.gr,e.gr)||R.comparator(t.key,e.key)}};var Td=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new Nt(ht.Pr)}checkEmpty(t){return E.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,r){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new rd(s,e,i,r);this.mutationQueue.push(o);for(let a of r)this.yr=this.yr.add(new ht(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return E.resolve(o)}lookupMutationBatch(t,e){return E.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){let i=e+1,r=this.Sr(i),s=r<0?0:r;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(t){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let i=new ht(e,0),r=new ht(e,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([i,r],o=>{let a=this.wr(o.gr);s.push(a)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Nt(K);return e.forEach(r=>{let s=new ht(r,0),o=new ht(r,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{i=i.add(a.gr)})}),E.resolve(this.br(i))}getAllMutationBatchesAffectingQuery(t,e){let i=e.path,r=i.length+1,s=i;R.isDocumentKey(s)||(s=s.child(""));let o=new ht(new R(s),0),a=new Nt(K);return this.yr.forEachWhile(c=>{let l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===r&&(a=a.add(c.gr)),!0)},o),E.resolve(this.br(a))}br(t){let e=[];return t.forEach(i=>{let r=this.wr(i);r!==null&&e.push(r)}),e}removeMutationBatch(t,e){Z(this.Dr(e.batchId,"removed")===0),this.mutationQueue.shift();let i=this.yr;return E.forEach(e.mutations,r=>{let s=new ht(r.key,e.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.yr=i})}Fn(t){}containsKey(t,e){let i=new ht(e,0),r=this.yr.firstAfterOrEqual(i);return E.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,E.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}wr(t){let e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var bd=class{constructor(t){this.Cr=t,this.docs=function(){return new ot(R.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let i=e.key,r=this.docs.get(i),s=r?r.size:0,o=this.Cr(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let i=this.docs.get(e);return E.resolve(i?i.document.mutableCopy():oe.newInvalidDocument(e))}getEntries(t,e){let i=Le();return e.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():oe.newInvalidDocument(r))}),E.resolve(i)}getDocumentsMatchingQuery(t,e,i,r){let s=Le(),o=e.path,a=new R(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||yT(_T(u),i)<=0||(r.has(u.key)||nc(e,u))&&(s=s.insert(u.key,u.mutableCopy()))}return E.resolve(s)}getAllFromCollectionGroup(t,e,i,r){D()}vr(t,e){return E.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new Ad(this)}getSize(t){return E.resolve(this.size)}},Ad=class extends yd{constructor(t){super(),this._r=t}applyChanges(t){let e=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?e.push(this._r.addEntry(t,r)):this._r.removeEntry(i)}),E.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}};var Sd=class{constructor(t){this.persistence=t,this.Fr=new on(e=>pf(e),_f),this.lastRemoteSnapshotVersion=M.min(),this.highestTargetId=0,this.Mr=0,this.Or=new ys,this.targetCount=0,this.Nr=_s.On()}forEachTarget(t,e){return this.Fr.forEach((i,r)=>e(r)),E.resolve()}getLastRemoteSnapshotVersion(t){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return E.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Mr&&(this.Mr=e),E.resolve()}kn(t){this.Fr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Nr=new _s(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,E.resolve()}updateTargetData(t,e){return this.kn(e),E.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,E.resolve()}removeTargets(t,e,i){let r=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),r++)}),E.waitFor(s).next(()=>r)}getTargetCount(t){return E.resolve(this.targetCount)}getTargetData(t,e){let i=this.Fr.get(e)||null;return E.resolve(i)}addMatchingKeys(t,e,i){return this.Or.Er(e,i),E.resolve()}removeMatchingKeys(t,e,i){this.Or.Ar(e,i);let r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(o=>{s.push(r.markPotentiallyOrphaned(t,o))}),E.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),E.resolve()}getMatchingKeysForTargetId(t,e){let i=this.Or.mr(e);return E.resolve(i)}containsKey(t,e){return E.resolve(this.Or.containsKey(e))}};var Cd=class{constructor(t,e){this.Br={},this.overlays={},this.Lr=new dy(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new Sd(this),this.indexManager=new pd,this.remoteDocumentCache=function(r){return new bd(r)}(i=>this.referenceDelegate.Qr(i)),this.serializer=new gd(e),this.Kr=new Ed(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Id,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.Br[t.toKey()];return i||(i=new Td(e,this.referenceDelegate),this.Br[t.toKey()]=i),i}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,i){A("MemoryPersistence","Starting transaction:",t);let r=new Rd(this.Lr.next());return this.referenceDelegate.$r(),i(r).next(s=>this.referenceDelegate.Ur(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Wr(t,e){return E.or(Object.values(this.Br).map(i=>()=>i.containsKey(t,e)))}},Rd=class extends Uh{constructor(t){super(),this.currentSequenceNumber=t}},xd=class n{constructor(t){this.persistence=t,this.Gr=new ys,this.zr=null}static jr(t){return new n(t)}get Hr(){if(this.zr)return this.zr;throw D()}addReference(t,e,i){return this.Gr.addReference(i,e),this.Hr.delete(i.toString()),E.resolve()}removeReference(t,e,i){return this.Gr.removeReference(i,e),this.Hr.add(i.toString()),E.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),E.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach(r=>this.Hr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(r=>{r.forEach(s=>this.Hr.add(s.toString()))}).next(()=>i.removeTargetData(t,e))}$r(){this.zr=new Set}Ur(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.Hr,i=>{let r=R.fromPath(i);return this.Jr(t,r).next(s=>{s||e.removeEntry(r,M.min())})}).next(()=>(this.zr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Jr(t,e).next(i=>{i?this.Hr.delete(e.toString()):this.Hr.add(e.toString())})}Qr(t){return 0}Jr(t,e){return E.or([()=>E.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}};var Dd=class n{constructor(t,e,i,r){this.targetId=t,this.fromCache=e,this.ki=i,this.qi=r}static Qi(t,e){let i=U(),r=U();for(let s of e.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(t,e.fromCache,i,r)}};var Pd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Vd=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,i,r){let s={result:null};return this.zi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(t,e,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Pd;return this.Hi(t,e,o).next(a=>{if(s.result=a,this.$i)return this.Ji(t,e,o,a.size)})}).next(()=>s.result)}Ji(t,e,i,r){return i.documentReadCount<this.Ui?(os()<=gt.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",Fi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),E.resolve()):(os()<=gt.DEBUG&&A("QueryEngine","Query:",Fi(e),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Wi*r?(os()<=gt.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",Fi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Se(e))):E.resolve())}zi(t,e){if($_(e))return E.resolve(null);let i=Se(e);return this.indexManager.getIndexType(t,i).next(r=>r===0?null:(e.limit!==null&&r===1&&(e=Sa(e,null,"F"),i=Se(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(s=>{let o=U(...s);return this.Gi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,i).next(c=>{let l=this.Yi(e,a);return this.Zi(e,l,o,c.readTime)?this.zi(t,Sa(e,null,"F")):this.Xi(t,l,e,c)}))})))}ji(t,e,i,r){return $_(e)||r.isEqual(M.min())?E.resolve(null):this.Gi.getDocuments(t,i).next(s=>{let o=this.Yi(e,s);return this.Zi(e,o,i,r)?E.resolve(null):(os()<=gt.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Fi(e)),this.Xi(t,o,e,pT(r,-1)).next(a=>a))})}Yi(t,e){let i=new Nt(Ty(t));return e.forEach((r,s)=>{nc(t,s)&&(i=i.add(s))}),i}Zi(t,e,i,r){if(t.limit===null)return!1;if(i.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Hi(t,e,i){return os()<=gt.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",Fi(e)),this.Gi.getDocumentsMatchingQuery(t,e,Ln.min(),i)}Xi(t,e,i,r){return this.Gi.getDocumentsMatchingQuery(t,i,r).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var kd=class{constructor(t,e,i,r){this.persistence=t,this.es=e,this.serializer=r,this.ts=new ot(K),this.ns=new on(s=>pf(s),_f),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(i)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new wd(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ts))}};function c0(n,t,e,i){return new kd(n,t,e,i)}function zy(n,t){return m(this,null,function*(){let e=L(n);return yield e.persistence.runTransaction("Handle user change","readonly",i=>{let r;return e.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,e.os(t),e.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=U();for(let l of r){o.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}for(let l of s){a.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}return e.localDocuments.getDocuments(i,c).next(l=>({_s:l,removedBatchIds:o,addedBatchIds:a}))})})})}function l0(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=t.batch.keys(),s=e.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){let h=l.batch,d=h.keys(),f=E.resolve();return d.forEach(y=>{f=f.next(()=>u.getEntry(c,y)).next(v=>{let p=l.docVersions.get(y);Z(p!==null),v.version.compareTo(p)<0&&(h.applyToRemoteDocument(v,l),v.isValidDocument()&&(v.setReadTime(l.commitVersion),u.addEntry(v)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(e,i,t,s).next(()=>s.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,r,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=U();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(t))).next(()=>e.localDocuments.getDocuments(i,r))})}function jy(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.qr.getLastRemoteSnapshotVersion(e))}function u0(n,t){let e=L(n),i=t.snapshotVersion,r=e.ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.ss.newChangeBuffer({trackRemovals:!0});r=e.ts;let a=[];t.targetChanges.forEach((u,h)=>{let d=r.get(h);if(!d)return;a.push(e.qr.removeMatchingKeys(s,u.removedDocuments,h).next(()=>e.qr.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?f=f.withResumeToken(Lt.EMPTY_BYTE_STRING,M.min()).withLastLimboFreeSnapshotVersion(M.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),r=r.insert(h,f),function(v,p,C){return v.resumeToken.approximateByteSize()===0||p.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(d,f,u)&&a.push(e.qr.updateTargetData(s,f))});let c=Le(),l=U();if(t.documentUpdates.forEach(u=>{t.resolvedLimboDocuments.has(u)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(h0(s,o,t.documentUpdates).next(u=>{c=u.us,l=u.cs})),!i.isEqual(M.min())){let u=e.qr.getLastRemoteSnapshotVersion(s).next(h=>e.qr.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return E.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(e.ts=r,s))}function h0(n,t,e){let i=U(),r=U();return e.forEach(s=>i=i.add(s)),t.getEntries(n,i).next(s=>{let o=Le();return e.forEach((a,c)=>{let l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(M.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):A("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{us:o,cs:r}})}function d0(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function f0(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return e.qr.getTargetData(i,t).next(s=>s?(r=s,E.resolve(r)):e.qr.allocateTargetId(i).next(o=>(r=new ps(t,o,"TargetPurposeListen",i.currentSequenceNumber),e.qr.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=e.ts.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ts=e.ts.insert(i.targetId,i),e.ns.set(t,i.targetId)),i})}function Nd(n,t,e){return m(this,null,function*(){let i=L(n),r=i.ts.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!As(o))throw o;A("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}i.ts=i.ts.remove(t),i.ns.delete(r.target)})}function ny(n,t,e){let i=L(n),r=M.min(),s=U();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){let h=L(c),d=h.ns.get(u);return d!==void 0?E.resolve(h.ts.get(d)):h.qr.getTargetData(l,u)}(i,o,Se(t)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.es.getDocumentsMatchingQuery(o,t,e?r:M.min(),e?s:U())).next(a=>(m0(i,xT(t),a),{documents:a,ls:s})))}function m0(n,t,e){let i=n.rs.get(t)||M.min();e.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.rs.set(t,i)}var Na=class{constructor(){this.activeTargetIds=OT()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Od=class{constructor(){this.eo=new Na,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,i){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new Na,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Fd=class{ro(t){}shutdown(){}};var Oa=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){A("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ao)t(0)}_o(){A("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ao)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var pa=null;function Dh(){return pa===null?pa=function(){return 268435456+Math.round(2147483648*Math.random())}():pa++,"0x"+pa.toString(16)}var g0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Md=class{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}onMessage(t){this.Eo=t}close(){this.lo()}send(t){this.co(t)}Ao(){this.Po()}Ro(t){this.To(t)}Vo(t){this.Eo(t)}};var kt="WebChannelConnection",Ld=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let i=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=i+"://"+e.host,this.fo=`projects/${r}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get yo(){return!1}wo(e,i,r,s,o){let a=Dh(),c=this.So(e,i);A("RestConnection",`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(l,s,o),this.Do(e,c,l,r).then(u=>(A("RestConnection",`Received RPC '${e}' ${a}: `,u),u),u=>{throw zi("RestConnection",`RPC '${e}' ${a} failed with error: `,u,"url: ",c,"request:",r),u})}Co(e,i,r,s,o,a){return this.wo(e,i,r,s,o)}bo(e,i,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+tr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}So(e,i){let r=g0[e];return`${this.mo}/v1/${i}:${r}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Do(t,e,i,r){let s=Dh();return new Promise((o,a)=>{let c=new Ro;c.setWithCredentials(!0),c.listenOnce(So.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Qe.NO_ERROR:let u=c.getResponseJson();A(kt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(u)),o(u);break;case Qe.TIMEOUT:A(kt,`RPC '${t}' ${s} timed out`),a(new b(g.DEADLINE_EXCEEDED,"Request time out"));break;case Qe.HTTP_ERROR:let h=c.getStatus();if(A(kt,`RPC '${t}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let y=function(p){let C=p.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(C)>=0?C:g.UNKNOWN}(f.status);a(new b(y,f.message))}else a(new b(g.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new b(g.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{A(kt,`RPC '${t}' ${s} completed.`)}});let l=JSON.stringify(r);A(kt,`RPC '${t}' ${s} sending request:`,r),c.send(e,"POST",l,i,15)})}vo(t,e,i){let r=Dh(),s=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=bo(),a=Ao(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.bo(c.initMessageHeaders,e,i),c.encodeInitMessageHeaders=!0;let u=s.join("");A(kt,`Creating RPC '${t}' stream ${r}: ${u}`,c);let h=o.createWebChannel(u,c),d=!1,f=!1,y=new Md({co:p=>{f?A(kt,`Not sending because RPC '${t}' stream ${r} is closed:`,p):(d||(A(kt,`Opening RPC '${t}' stream ${r} transport.`),h.open(),d=!0),A(kt,`RPC '${t}' stream ${r} sending:`,p),h.send(p))},lo:()=>h.close()}),v=(p,C,N)=>{p.listen(C,z=>{try{N(z)}catch(X){setTimeout(()=>{throw X},0)}})};return v(h,fe.EventType.OPEN,()=>{f||A(kt,`RPC '${t}' stream ${r} transport opened.`)}),v(h,fe.EventType.CLOSE,()=>{f||(f=!0,A(kt,`RPC '${t}' stream ${r} transport closed`),y.Ro())}),v(h,fe.EventType.ERROR,p=>{f||(f=!0,zi(kt,`RPC '${t}' stream ${r} transport errored:`,p),y.Ro(new b(g.UNAVAILABLE,"The operation could not be completed")))}),v(h,fe.EventType.MESSAGE,p=>{var C;if(!f){let N=p.data[0];Z(!!N);let z=N,X=z.error||((C=z[0])===null||C===void 0?void 0:C.error);if(X){A(kt,`RPC '${t}' stream ${r} received error:`,X);let Ot=X.status,Q=function(cc){let nr=ut[cc];if(nr!==void 0)return Oy(nr)}(Ot),zt=X.message;Q===void 0&&(Q=g.INTERNAL,zt="Unknown error status: "+Ot+" with message "+X.message),f=!0,y.Ro(new b(Q,zt)),h.close()}else A(kt,`RPC '${t}' stream ${r} received:`,N),y.Vo(N)}}),v(a,Co.STAT_EVENT,p=>{p.stat===fi.PROXY?A(kt,`RPC '${t}' stream ${r} detected buffering proxy`):p.stat===fi.NOPROXY&&A(kt,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{y.Ao()},0),y}};function Ph(){return typeof document<"u"?document:null}function ic(n){return new ud(n,!0)}var Fa=class{constructor(t,e,i=1e3,r=1.5,s=6e4){this.si=t,this.timerId=e,this.Fo=i,this.Mo=r,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(t){this.cancel();let e=Math.floor(this.Oo+this.qo()),i=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-i);r>0&&A("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Oo} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,r,()=>(this.Bo=Date.now(),t())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}};var Ma=class{constructor(t,e,i,r,s,o,a,c){this.si=t,this.Ko=i,this.$o=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Fa(t,e)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}stop(){return m(this,null,function*(){this.jo()&&(yield this.close(0))})}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(t){this.t_(),this.stream.send(t)}Xo(){return m(this,null,function*(){if(this.Ho())return this.close(0)})}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(t,e){return m(this,null,function*(){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,t!==4?this.zo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(Me(e.toString()),Me("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Io(e)})}r_(){}auth(){this.state=1;let t=this.i_(this.Uo),e=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Uo===e&&this.s_(i,r)},i=>{t(()=>{let r=new b(g.UNKNOWN,"Fetching auth token failed: "+i.message);return this.o_(r)})})}s_(t,e){let i=this.i_(this.Uo);this.stream=this.__(t,e),this.stream.ho(()=>{i(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(r=>{i(()=>this.o_(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Jo(){this.state=5,this.zo.ko(()=>m(this,null,function*(){this.state=0,this.start()}))}o_(t){return A("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}i_(t){return e=>{this.si.enqueueAndForget(()=>this.Uo===t?e():(A("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bd=class extends Ma{constructor(t,e,i,r,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s}__(t,e){return this.connection.vo("Listen",t,e)}onMessage(t){this.zo.reset();let e=YT(this.serializer,t),i=function(s){if(!("targetChange"in s))return M.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?M.min():o.readTime?Ce(o.readTime):M.min()}(t);return this.listener.a_(e,i)}u_(t){let e={};e.database=md(this.serializer),e.addTarget=function(s,o){let a,c=o.target;if(a=td(c)?{documents:ZT(s,c)}:{query:t0(s,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Fy(s,o.resumeToken);let l=hd(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(M.min())>0){a.readTime=Va(s,o.snapshotVersion.toTimestamp());let l=hd(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,t);let i=n0(this.serializer,t);i&&(e.labels=i),this.e_(e)}c_(t){let e={};e.database=md(this.serializer),e.removeTarget=t,this.e_(e)}},qd=class extends Ma{constructor(t,e,i,r,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(t,e){return this.connection.vo("Write",t,e)}onMessage(t){if(Z(!!t.streamToken),this.lastStreamToken=t.streamToken,this.l_){this.zo.reset();let e=JT(t.writeResults,t.commitTime),i=Ce(t.commitTime);return this.listener.I_(i,e)}return Z(!t.writeResults||t.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){let t={};t.database=md(this.serializer),this.e_(t)}P_(t){let e={streamToken:this.lastStreamToken,writes:t.map(i=>XT(this.serializer,i))};this.e_(e)}};var Ud=class extends class{}{constructor(t,e,i,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=r,this.d_=!1}A_(){if(this.d_)throw new b(g.FAILED_PRECONDITION,"The client has already been terminated.")}wo(t,e,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.wo(t,e,i,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new b(g.UNKNOWN,r.toString())})}Co(t,e,i,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(t,e,i,s,o,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new b(g.UNKNOWN,s.toString())})}terminate(){this.d_=!0}};var zd=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(t){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.p_("Offline")))}set(t){this.S_(),this.V_=0,t==="Online"&&(this.f_=!1),this.p_(t)}p_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}y_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Me(e),this.f_=!1):A("OnlineStateTracker",e)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}};var jd=class{constructor(t,e,i,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(o=>{i.enqueueAndForget(()=>m(this,null,function*(){Kn(this)&&(A("RemoteStore","Restarting streams for network reachability change."),yield function(c){return m(this,null,function*(){let l=L(c);l.C_.add(4),yield Ss(l),l.M_.set("Unknown"),l.C_.delete(4),yield rc(l)})}(this))}))}),this.M_=new zd(i,r)}};function rc(n){return m(this,null,function*(){if(Kn(n))for(let t of n.v_)yield t(!0)})}function Ss(n){return m(this,null,function*(){for(let t of n.v_)yield t(!1)})}function Gy(n,t){let e=L(n);e.D_.has(t.targetId)||(e.D_.set(t.targetId,t),If(e)?Ef(e):er(e).Ho()&&wf(e,t))}function $y(n,t){let e=L(n),i=er(e);e.D_.delete(t),i.Ho()&&Ky(e,t),e.D_.size===0&&(i.Ho()?i.Zo():Kn(e)&&e.M_.set("Unknown"))}function wf(n,t){if(n.x_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(M.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}er(n).u_(t)}function Ky(n,t){n.x_.Oe(t),er(n).c_(t)}function Ef(n){n.x_=new ld({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.D_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),er(n).start(),n.M_.g_()}function If(n){return Kn(n)&&!er(n).jo()&&n.D_.size>0}function Kn(n){return L(n).C_.size===0}function Qy(n){n.x_=void 0}function p0(n){return m(this,null,function*(){n.D_.forEach((t,e)=>{wf(n,t)})})}function _0(n,t){return m(this,null,function*(){Qy(n),If(n)?(n.M_.w_(t),Ef(n)):n.M_.set("Unknown")})}function y0(n,t,e){return m(this,null,function*(){if(n.M_.set("Online"),t instanceof Da&&t.state===2&&t.cause)try{yield function(r,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.D_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.D_.delete(a),r.x_.removeTarget(a))})}(n,t)}catch(i){A("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield La(n,i)}else if(t instanceof qi?n.x_.$e(t):t instanceof xa?n.x_.Je(t):n.x_.Ge(t),!e.isEqual(M.min()))try{let i=yield jy(n.localStore);e.compareTo(i)>=0&&(yield function(s,o){let a=s.x_.it(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){let u=s.D_.get(l);u&&s.D_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{let u=s.D_.get(c);if(!u)return;s.D_.set(c,u.withResumeToken(Lt.EMPTY_BYTE_STRING,u.snapshotVersion)),Ky(s,c);let h=new ps(u.target,c,l,u.sequenceNumber);wf(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(i){A("RemoteStore","Failed to raise snapshot:",i),yield La(n,i)}})}function La(n,t,e){return m(this,null,function*(){if(!As(t))throw t;n.C_.add(1),yield Ss(n),n.M_.set("Offline"),e||(e=()=>jy(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){A("RemoteStore","Retrying IndexedDB access"),yield e(),n.C_.delete(1),yield rc(n)}))})}function Wy(n,t){return t().catch(e=>La(n,e,t))}function sc(n){return m(this,null,function*(){let t=L(n),e=an(t),i=t.b_.length>0?t.b_[t.b_.length-1].batchId:-1;for(;v0(t);)try{let r=yield d0(t.localStore,i);if(r===null){t.b_.length===0&&e.Zo();break}i=r.batchId,w0(t,r)}catch(r){yield La(t,r)}Hy(t)&&Yy(t)})}function v0(n){return Kn(n)&&n.b_.length<10}function w0(n,t){n.b_.push(t);let e=an(n);e.Ho()&&e.h_&&e.P_(t.mutations)}function Hy(n){return Kn(n)&&!an(n).jo()&&n.b_.length>0}function Yy(n){an(n).start()}function E0(n){return m(this,null,function*(){an(n).E_()})}function I0(n){return m(this,null,function*(){let t=an(n);for(let e of n.b_)t.P_(e.mutations)})}function T0(n,t,e){return m(this,null,function*(){let i=n.b_.shift(),r=sd.from(i,t,e);yield Wy(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield sc(n)})}function b0(n,t){return m(this,null,function*(){t&&an(n).h_&&(yield function(i,r){return m(this,null,function*(){if(function(o){return zT(o)&&o!==g.ABORTED}(r.code)){let s=i.b_.shift();an(i).Yo(),yield Wy(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield sc(i)}})}(n,t)),Hy(n)&&Yy(n)})}function iy(n,t){return m(this,null,function*(){let e=L(n);e.asyncQueue.verifyOperationInProgress(),A("RemoteStore","RemoteStore received new credentials");let i=Kn(e);e.C_.add(3),yield Ss(e),i&&e.M_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.C_.delete(3),yield rc(e)})}function A0(n,t){return m(this,null,function*(){let e=L(n);t?(e.C_.delete(2),yield rc(e)):t||(e.C_.add(2),yield Ss(e),e.M_.set("Unknown"))})}function er(n){return n.O_||(n.O_=function(e,i,r){let s=L(e);return s.A_(),new Bd(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{ho:p0.bind(null,n),Io:_0.bind(null,n),a_:y0.bind(null,n)}),n.v_.push(t=>m(this,null,function*(){t?(n.O_.Yo(),If(n)?Ef(n):n.M_.set("Unknown")):(yield n.O_.stop(),Qy(n))}))),n.O_}function an(n){return n.N_||(n.N_=function(e,i,r){let s=L(e);return s.A_(),new qd(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{ho:E0.bind(null,n),Io:b0.bind(null,n),T_:I0.bind(null,n),I_:T0.bind(null,n)}),n.v_.push(t=>m(this,null,function*(){t?(n.N_.Yo(),yield sc(n)):(yield n.N_.stop(),n.b_.length>0&&(A("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))}))),n.N_}var Gd=class n{constructor(t,e,i,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new se,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,r,s){let o=Date.now()+i,a=new n(t,e,o,r,s);return a.start(i),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new b(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Tf(n,t){if(Me("AsyncQueue",`${t}: ${n}`),As(n))return new b(g.UNAVAILABLE,`${t}: ${n}`);throw n}var Ba=class n{constructor(t){this.comparator=t?(e,i)=>t(e,i)||R.comparator(e.key,i.key):(e,i)=>R.comparator(e.key,i.key),this.keyedMap=as(),this.sortedSet=new ot(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let i=new n;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}};var qa=class{constructor(){this.B_=new ot(R.comparator)}track(t){let e=t.doc.key,i=this.B_.get(e);i?t.type!==0&&i.type===3?this.B_=this.B_.insert(e,t):t.type===3&&i.type!==1?this.B_=this.B_.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.B_=this.B_.remove(e):t.type===1&&i.type===2?this.B_=this.B_.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):D():this.B_=this.B_.insert(e,t)}L_(){let t=[];return this.B_.inorderTraversal((e,i)=>{t.push(i)}),t}},Xi=class n{constructor(t,e,i,r,s,o,a,c,l){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(t,e,i,r,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,Ba.emptySet(e),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ec(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==i[r].type||!e[r].doc.isEqual(i[r].doc))return!1;return!0}};var $d=class{constructor(){this.k_=void 0,this.listeners=[]}},Kd=class{constructor(){this.queries=new on(t=>Iy(t),ec),this.onlineState="Unknown",this.q_=new Set}};function Xy(n,t){return m(this,null,function*(){let e=L(n),i=t.query,r=!1,s=e.queries.get(i);if(s||(r=!0,s=new $d),r)try{s.k_=yield e.onListen(i)}catch(o){let a=Tf(o,`Initialization of query '${Fi(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,s),s.listeners.push(t),t.Q_(e.onlineState),s.k_&&t.K_(s.k_)&&bf(e)})}function Jy(n,t){return m(this,null,function*(){let e=L(n),i=t.query,r=!1,s=e.queries.get(i);if(s){let o=s.listeners.indexOf(t);o>=0&&(s.listeners.splice(o,1),r=s.listeners.length===0)}if(r)return e.queries.delete(i),e.onUnlisten(i)})}function S0(n,t){let e=L(n),i=!1;for(let r of t){let s=r.query,o=e.queries.get(s);if(o){for(let a of o.listeners)a.K_(r)&&(i=!0);o.k_=r}}i&&bf(e)}function C0(n,t,e){let i=L(n),r=i.queries.get(t);if(r)for(let s of r.listeners)s.onError(e);i.queries.delete(t)}function bf(n){n.q_.forEach(t=>{t.next()})}var Ua=class{constructor(t,e,i){this.query=t,this.U_=e,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=i||{}}K_(t){if(!this.options.includeMetadataChanges){let i=[];for(let r of t.docChanges)r.type!==3&&i.push(r);t=new Xi(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.W_?this.z_(t)&&(this.U_.next(t),e=!0):this.j_(t,this.onlineState)&&(this.H_(t),e=!0),this.G_=t,e}onError(t){this.U_.error(t)}Q_(t){this.onlineState=t;let e=!1;return this.G_&&!this.W_&&this.j_(this.G_,t)&&(this.H_(this.G_),e=!0),e}j_(t,e){if(!t.fromCache)return!0;let i=e!=="Offline";return(!this.options.J_||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}z_(t){if(t.docChanges.length>0)return!0;let e=this.G_&&this.G_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}H_(t){t=Xi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.W_=!0,this.U_.next(t)}};var za=class{constructor(t){this.key=t}},ja=class{constructor(t){this.key=t}},Qd=class{constructor(t,e){this.query=t,this.ia=e,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=U(),this.mutatedKeys=U(),this._a=Ty(t),this.aa=new Ba(this._a)}get ua(){return this.ia}ca(t,e){let i=e?e.la:new qa,r=e?e.aa:this.aa,s=e?e.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,l=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((u,h)=>{let d=r.get(u),f=nc(this.query,h)?h:null,y=!!d&&this.mutatedKeys.has(d.key),v=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;d&&f?d.data.isEqual(f.data)?y!==v&&(i.track({type:3,doc:f}),p=!0):this.ha(d,f)||(i.track({type:2,doc:f}),p=!0,(c&&this._a(f,c)>0||l&&this._a(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),p=!0):d&&!f&&(i.track({type:1,doc:d}),p=!0,(c||l)&&(a=!0)),p&&(f?(o=o.add(f),s=v?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{aa:o,la:i,Zi:a,mutatedKeys:s}}ha(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,r){let s=this.aa;this.aa=t.aa,this.mutatedKeys=t.mutatedKeys;let o=t.la.L_();o.sort((u,h)=>function(f,y){let v=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return v(f)-v(y)}(u.type,h.type)||this._a(u.doc,h.doc)),this.Pa(i),r=r!=null&&r;let a=e&&!r?this.Ia():[],c=this.oa.size===0&&this.current&&!r?1:0,l=c!==this.sa;return this.sa=c,o.length!==0||l?{snapshot:new Xi(this.query,t.aa,s,o,t.mutatedKeys,c===0,l,!1,!!i&&i.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new qa,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(t){return!this.ia.has(t)&&!!this.aa.has(t)&&!this.aa.get(t).hasLocalMutations}Pa(t){t&&(t.addedDocuments.forEach(e=>this.ia=this.ia.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.ia=this.ia.delete(e)),this.current=t.current)}Ia(){if(!this.current)return[];let t=this.oa;this.oa=U(),this.aa.forEach(i=>{this.Ea(i.key)&&(this.oa=this.oa.add(i.key))});let e=[];return t.forEach(i=>{this.oa.has(i)||e.push(new ja(i))}),this.oa.forEach(i=>{t.has(i)||e.push(new za(i))}),e}da(t){this.ia=t.ls,this.oa=U();let e=this.ca(t.documents);return this.applyChanges(e,!0)}Aa(){return Xi.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}},Wd=class{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}},Hd=class{constructor(t){this.key=t,this.Ra=!1}},Yd=class{constructor(t,e,i,r,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new on(a=>Iy(a),ec),this.fa=new Map,this.ga=new Set,this.pa=new ot(R.comparator),this.ya=new Map,this.wa=new ys,this.Sa={},this.ba=new Map,this.Da=_s.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}};function R0(n,t){return m(this,null,function*(){let e=L0(n),i,r,s=e.ma.get(t);if(s)i=s.targetId,e.sharedClientState.addLocalQueryTarget(i),r=s.view.Aa();else{let o=yield f0(e.localStore,Se(t)),a=e.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=yield x0(e,t,i,a==="current",o.resumeToken),e.isPrimaryClient&&Gy(e.remoteStore,o)}return r})}function x0(n,t,e,i,r){return m(this,null,function*(){n.va=(h,d,f)=>function(v,p,C,N){return m(this,null,function*(){let z=p.view.ca(C);z.Zi&&(z=yield ny(v.localStore,p.query,!1).then(({documents:zt})=>p.view.ca(zt,z)));let X=N&&N.targetChanges.get(p.targetId),Ot=N&&N.targetMismatches.get(p.targetId)!=null,Q=p.view.applyChanges(z,v.isPrimaryClient,X,Ot);return sy(v,p.targetId,Q.Ta),Q.snapshot})}(n,h,d,f);let s=yield ny(n.localStore,t,!0),o=new Qd(t,s.ls),a=o.ca(s.documents),c=gs.createSynthesizedTargetChangeForCurrentChange(e,i&&n.onlineState!=="Offline",r),l=o.applyChanges(a,n.isPrimaryClient,c);sy(n,e,l.Ta);let u=new Wd(t,e,o);return n.ma.set(t,u),n.fa.has(e)?n.fa.get(e).push(t):n.fa.set(e,[t]),l.snapshot})}function D0(n,t){return m(this,null,function*(){let e=L(n),i=e.ma.get(t),r=e.fa.get(i.targetId);if(r.length>1)return e.fa.set(i.targetId,r.filter(s=>!ec(s,t))),void e.ma.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Nd(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),$y(e.remoteStore,i.targetId),Xd(e,i.targetId)}).catch(bs))):(Xd(e,i.targetId),yield Nd(e.localStore,i.targetId,!0))})}function P0(n,t,e){return m(this,null,function*(){let i=B0(n);try{let r=yield function(o,a){let c=L(o),l=At.now(),u=a.reduce((f,y)=>f.add(y.key),U()),h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let y=Le(),v=U();return c.ss.getEntries(f,u).next(p=>{y=p,y.forEach((C,N)=>{N.isValidDocument()||(v=v.add(C))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,y)).next(p=>{h=p;let C=[];for(let N of a){let z=UT(N,h.get(N.key).overlayedDocument);z!=null&&C.push(new xe(N.key,z,gy(z.value.mapValue),tn.exists(!0)))}return c.mutationQueue.addMutationBatch(f,l,C,a)}).next(p=>{d=p;let C=p.applyToLocalDocumentSet(h,v);return c.documentOverlayCache.saveOverlays(f,p.batchId,C)})}).then(()=>({batchId:d.batchId,changes:Ay(h)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let l=o.Sa[o.currentUser.toKey()];l||(l=new ot(K)),l=l.insert(a,c),o.Sa[o.currentUser.toKey()]=l}(i,r.batchId,e),yield Cs(i,r.changes),yield sc(i.remoteStore)}catch(r){let s=Tf(r,"Failed to persist write");e.reject(s)}})}function Zy(n,t){return m(this,null,function*(){let e=L(n);try{let i=yield u0(e.localStore,t);t.targetChanges.forEach((r,s)=>{let o=e.ya.get(s);o&&(Z(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.Ra=!0:r.modifiedDocuments.size>0?Z(o.Ra):r.removedDocuments.size>0&&(Z(o.Ra),o.Ra=!1))}),yield Cs(e,i,t)}catch(i){yield bs(i)}})}function ry(n,t,e){let i=L(n);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){let r=[];i.ma.forEach((s,o)=>{let a=o.view.Q_(t);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let l=!1;c.queries.forEach((u,h)=>{for(let d of h.listeners)d.Q_(a)&&(l=!0)}),l&&bf(c)}(i.eventManager,t),r.length&&i.Va.a_(r),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function V0(n,t,e){return m(this,null,function*(){let i=L(n);i.sharedClientState.updateQueryState(t,"rejected",e);let r=i.ya.get(t),s=r&&r.key;if(s){let o=new ot(R.comparator);o=o.insert(s,oe.newNoDocument(s,M.min()));let a=U().add(s),c=new Ra(M.min(),new Map,new ot(K),o,a);yield Zy(i,c),i.pa=i.pa.remove(s),i.ya.delete(t),Af(i)}else yield Nd(i.localStore,t,!1).then(()=>Xd(i,t,e)).catch(bs)})}function k0(n,t){return m(this,null,function*(){let e=L(n),i=t.batch.batchId;try{let r=yield l0(e.localStore,t);ev(e,i,null),tv(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),yield Cs(e,r)}catch(r){yield bs(r)}})}function N0(n,t,e){return m(this,null,function*(){let i=L(n);try{let r=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(h=>(Z(h!==null),u=h.keys(),c.mutationQueue.removeMutationBatch(l,h))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(i.localStore,t);ev(i,t,e),tv(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),yield Cs(i,r)}catch(r){yield bs(r)}})}function tv(n,t){(n.ba.get(t)||[]).forEach(e=>{e.resolve()}),n.ba.delete(t)}function ev(n,t,e){let i=L(n),r=i.Sa[i.currentUser.toKey()];if(r){let s=r.get(t);s&&(e?s.reject(e):s.resolve(),r=r.remove(t)),i.Sa[i.currentUser.toKey()]=r}}function Xd(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let i of n.fa.get(t))n.ma.delete(i),e&&n.Va.Fa(i,e);n.fa.delete(t),n.isPrimaryClient&&n.wa.Rr(t).forEach(i=>{n.wa.containsKey(i)||nv(n,i)})}function nv(n,t){n.ga.delete(t.path.canonicalString());let e=n.pa.get(t);e!==null&&($y(n.remoteStore,e),n.pa=n.pa.remove(t),n.ya.delete(e),Af(n))}function sy(n,t,e){for(let i of e)i instanceof za?(n.wa.addReference(i.key,t),O0(n,i)):i instanceof ja?(A("SyncEngine","Document no longer in limbo: "+i.key),n.wa.removeReference(i.key,t),n.wa.containsKey(i.key)||nv(n,i.key)):D()}function O0(n,t){let e=t.key,i=e.path.canonicalString();n.pa.get(e)||n.ga.has(i)||(A("SyncEngine","New document in limbo: "+e),n.ga.add(i),Af(n))}function Af(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){let t=n.ga.values().next().value;n.ga.delete(t);let e=new R(et.fromString(t)),i=n.Da.next();n.ya.set(i,new Hd(e)),n.pa=n.pa.insert(e,i),Gy(n.remoteStore,new ps(Se(yf(e.path)),i,"TargetPurposeLimboResolution",dy._e))}}function Cs(n,t,e){return m(this,null,function*(){let i=L(n),r=[],s=[],o=[];i.ma.isEmpty()||(i.ma.forEach((a,c)=>{o.push(i.va(c,t,e).then(l=>{if((l||e)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l?.fromCache?"not-current":"current"),l){r.push(l);let u=Dd.Qi(c.targetId,l);s.push(u)}}))}),yield Promise.all(o),i.Va.a_(r),yield function(c,l){return m(this,null,function*(){let u=L(c);try{yield u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>E.forEach(l,d=>E.forEach(d.ki,f=>u.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>E.forEach(d.qi,f=>u.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!As(h))throw h;A("LocalStore","Failed to update sequence numbers: "+h)}for(let h of l){let d=h.targetId;if(!h.fromCache){let f=u.ts.get(d),y=f.snapshotVersion,v=f.withLastLimboFreeSnapshotVersion(y);u.ts=u.ts.insert(d,v)}}})}(i.localStore,s))})}function F0(n,t){return m(this,null,function*(){let e=L(n);if(!e.currentUser.isEqual(t)){A("SyncEngine","User change. New user:",t.toKey());let i=yield zy(e.localStore,t);e.currentUser=t,function(s,o){s.ba.forEach(a=>{a.forEach(c=>{c.reject(new b(g.CANCELLED,o))})}),s.ba.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),yield Cs(e,i._s)}})}function M0(n,t){let e=L(n),i=e.ya.get(t);if(i&&i.Ra)return U().add(i.key);{let r=U(),s=e.fa.get(t);if(!s)return r;for(let o of s){let a=e.ma.get(o);r=r.unionWith(a.view.ua)}return r}}function L0(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Zy.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=M0.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=V0.bind(null,t),t.Va.a_=S0.bind(null,t.eventManager),t.Va.Fa=C0.bind(null,t.eventManager),t}function B0(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=k0.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=N0.bind(null,t),t}var Ga=class{constructor(){this.synchronizeTabs=!1}initialize(t){return m(this,null,function*(){this.serializer=ic(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return c0(this.persistence,new Vd,t.initialUser,this.serializer)}createPersistence(t){return new Cd(xd.jr,this.serializer)}createSharedClientState(t){return new Od}terminate(){return m(this,null,function*(){this.gcScheduler&&this.gcScheduler.stop(),yield this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Jd=class{initialize(t,e){return m(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ry(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=F0.bind(null,this.syncEngine),yield A0(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Kd}()}createDatastore(t){let e=ic(t.databaseInfo.databaseId),i=function(s){return new Ld(s)}(t.databaseInfo);return function(s,o,a,c){return new Ud(s,o,a,c)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(i,r,s,o,a){return new jd(i,r,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>ry(this.syncEngine,e,0),function(){return Oa.D()?new Oa:new Fd}())}createSyncEngine(t,e){return function(r,s,o,a,c,l,u){let h=new Yd(r,s,o,a,c,l);return u&&(h.Ca=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return function(e){return m(this,null,function*(){let i=L(e);A("RemoteStore","RemoteStore shutting down."),i.C_.add(5),yield Ss(i),i.F_.shutdown(),i.M_.set("Unknown")})}(this.remoteStore)}};var $a=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Oa(this.observer.next,t)}error(t){this.observer.error?this.Oa(this.observer.error,t):Me("Uncaught Error in snapshot listener:",t.toString())}Na(){this.muted=!0}Oa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var Zd=class{constructor(t,e,i,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=r,this.user=vt.UNAUTHENTICATED,this.clientId=wa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>m(this,null,function*(){A("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(A("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}getConfiguration(){return m(this,null,function*(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}})}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new b(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new se;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let i=Tf(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}};function Vh(n,t){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),A("FirestoreClient","Initializing OfflineComponentProvider");let e=yield n.getConfiguration();yield t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener(r=>m(this,null,function*(){i.isEqual(r)||(yield zy(t.localStore,r),i=r)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function oy(n,t){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield U0(n);A("FirestoreClient","Initializing OnlineComponentProvider");let i=yield n.getConfiguration();yield t.initialize(e,i),n.setCredentialChangeListener(r=>iy(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>iy(t.remoteStore,s)),n._onlineComponents=t})}function q0(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function U0(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){A("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Vh(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!q0(e))throw e;zi("Error using user provided cache. Falling back to memory cache: "+e),yield Vh(n,new Ga)}}else A("FirestoreClient","Using default OfflineComponentProvider"),yield Vh(n,new Ga);return n._offlineComponents})}function iv(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(A("FirestoreClient","Using user provided OnlineComponentProvider"),yield oy(n,n._uninitializedComponentsProvider._online)):(A("FirestoreClient","Using default OnlineComponentProvider"),yield oy(n,new Jd))),n._onlineComponents})}function z0(n){return iv(n).then(t=>t.syncEngine)}function rv(n){return m(this,null,function*(){let t=yield iv(n),e=t.eventManager;return e.onListen=R0.bind(null,t.syncEngine),e.onUnlisten=D0.bind(null,t.syncEngine),e})}function j0(n,t,e={}){let i=new se;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,c,l){let u=new $a({next:d=>{o.enqueueAndForget(()=>Jy(s,h));let f=d.docs.has(a);!f&&d.fromCache?l.reject(new b(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&c&&c.source==="server"?l.reject(new b(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new Ua(yf(a.path),u,{includeMetadataChanges:!0,J_:!0});return Xy(s,h)}(yield rv(n),n.asyncQueue,t,e,i)})),i.promise}function G0(n,t,e={}){let i=new se;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,c,l){let u=new $a({next:d=>{o.enqueueAndForget(()=>Jy(s,h)),d.fromCache&&c.source==="server"?l.reject(new b(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new Ua(a,u,{includeMetadataChanges:!0,J_:!0});return Xy(s,h)}(yield rv(n),n.asyncQueue,t,e,i)})),i.promise}function sv(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var ay=new Map;function ov(n,t,e){if(!e)throw new b(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function $0(n,t,e,i){if(t===!0&&i===!0)throw new b(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function cy(n){if(!R.isDocumentKey(n))throw new b(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ly(n){if(R.isDocumentKey(n))throw new b(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function oc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(i){return i.constructor?i.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":D()}function cn(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new b(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=oc(n);throw new b(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function K0(n,t){if(t<=0)throw new b(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Ka=class{constructor(t){var e,i;if(t.host===void 0){if(t.ssl!==void 0)throw new b(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new b(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}$0("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sv((i=t.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new b(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new b(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new b(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Ji=class{constructor(t,e,i,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ka({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new b(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new b(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ka(t),t.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new kh;switch(i.type){case"firstParty":return new Mh(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new b(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let i=ay.get(e);i&&(A("ComponentProvider","Removing Datastore"),ay.delete(e),i.terminate())}(this),Promise.resolve()}};function av(n,t,e,i={}){var r;let s=(n=cn(n,Ji))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&zi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=vt.MOCK_USER;else{a=O_(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let l=i.mockUserToken.sub||i.mockUserToken.user_id;if(!l)throw new b(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new vt(l)}n._authCredentials=new Nh(new va(a,c))}}var ln=class n{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Ut=class n{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new en(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},en=class n extends ln{constructor(t,e,i){super(t,e,yf(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Ut(this.firestore,null,new R(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function cv(n,t,...e){if(n=Te(n),ov("collection","path",t),n instanceof Ji){let i=et.fromString(t,...e);return ly(i),new en(n,null,i)}{if(!(n instanceof Ut||n instanceof en))throw new b(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(et.fromString(t,...e));return ly(i),new en(n.firestore,null,i)}}function Sf(n,t,...e){if(n=Te(n),arguments.length===1&&(t=wa.newId()),ov("doc","path",t),n instanceof Ji){let i=et.fromString(t,...e);return cy(i),new Ut(n,null,new R(i))}{if(!(n instanceof Ut||n instanceof en))throw new b(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(et.fromString(t,...e));return cy(i),new Ut(n.firestore,n instanceof en?n.converter:null,new R(i))}}var tf=class{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Fa(this,"async_queue_retry"),this.iu=()=>{let e=Ph();e&&A("AsyncQueue","Visibility state changed to "+e.visibilityState),this.zo.Qo()};let t=Ph();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.su(),this.ou(t)}enterRestrictedMode(t){if(!this.Za){this.Za=!0,this.nu=t||!1;let e=Ph();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.iu)}}enqueue(t){if(this.su(),this.Za)return new Promise(()=>{});let e=new se;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ya.push(t),this._u()))}_u(){return m(this,null,function*(){if(this.Ya.length!==0){try{yield this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(t){if(!As(t))throw t;A("AsyncQueue","Operation failed with retryable error: "+t)}this.Ya.length>0&&this.zo.ko(()=>this._u())}})}ou(t){let e=this.Ja.then(()=>(this.tu=!0,t().catch(i=>{this.eu=i,this.tu=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Me("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.tu=!1,i))));return this.Ja=e,e}enqueueAfterDelay(t,e,i){this.su(),this.ru.indexOf(t)>-1&&(e=0);let r=Gd.createAndSchedule(this,t,e,i,s=>this.au(s));return this.Xa.push(r),r}su(){this.eu&&D()}verifyOperationInProgress(){}uu(){return m(this,null,function*(){let t;do t=this.Ja,yield t;while(t!==this.Ja)})}cu(t){for(let e of this.Xa)if(e.timerId===t)return!0;return!1}lu(t){return this.uu().then(()=>{this.Xa.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(let e of this.Xa)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.uu()})}hu(t){this.ru.push(t)}au(t){let e=this.Xa.indexOf(t);this.Xa.splice(e,1)}};var Gn=class extends Ji{constructor(t,e,i,r){super(t,e,i,r),this.type="firestore",this._queue=function(){return new tf}(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||uv(this),this._firestoreClient.terminate()}};function lv(n,t){let e=typeof n=="object"?n:Hf(),i=typeof n=="string"?n:t||"(default)",r=Qf(e,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=N_("firestore");s&&av(r,...s)}return r}function Cf(n){return n._firestoreClient||uv(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function uv(n){var t,e,i;let r=n._freezeSettings(),s=function(a,c,l,u){return new zh(a,c,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,sv(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new Zd(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=r.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}var vs=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(Lt.fromBase64String(t))}catch(e){throw new b(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(Lt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Zi=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new b(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var ws=class{constructor(t){this._methodName=t}};var Es=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new b(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new b(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return K(this._lat,t._lat)||K(this._long,t._long)}};var Q0=/^__.*__$/,ef=class{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return this.fieldMask!==null?new xe(t,this.data,this.fieldMask,e,this.fieldTransforms):new jn(t,this.data,e,this.fieldTransforms)}},Qa=class{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return new xe(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function hv(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}var nf=class n{constructor(t,e,i,r,s,o){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(t){var e;let i=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.Tu({path:i,du:!1});return r.Au(t),r}Ru(t){var e;let i=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.Tu({path:i,du:!1});return r.Pu(),r}Vu(t){return this.Tu({path:void 0,du:!0})}mu(t){return Ha(t,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Pu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Au(this.path.get(t))}Au(t){if(t.length===0)throw this.mu("Document fields must not be empty");if(hv(this.Iu)&&Q0.test(t))throw this.mu('Document fields cannot begin and end with "__"')}},rf=class{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||ic(t)}pu(t,e,i,r=!1){return new nf({Iu:t,methodName:e,gu:i,path:Xt.emptyPath(),du:!1,fu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Rf(n){let t=n._freezeSettings(),e=ic(n._databaseId);return new rf(n._databaseId,!!t.ignoreUndefinedProperties,e)}function W0(n,t,e,i,r,s={}){let o=n.pu(s.merge||s.mergeFields?2:0,t,e,r);xf("Data must be an object, but it was:",o,i);let a=dv(i,o),c,l;if(s.merge)c=new te(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let h of s.mergeFields){let d=sf(t,h,e);if(!o.contains(d))throw new b(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);mv(u,d)||u.push(d)}c=new te(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new ef(new Yt(a),c,l)}var Wa=class n extends ws{_toFieldTransform(t){if(t.Iu!==2)throw t.Iu===1?t.mu(`${this._methodName}() can only appear at the top level of your update data`):t.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function H0(n,t,e,i){let r=n.pu(1,t,e);xf("Data must be an object, but it was:",r,i);let s=[],o=Yt.empty();$n(i,(c,l)=>{let u=Df(t,c,e);l=Te(l);let h=r.Ru(u);if(l instanceof Wa)s.push(u);else{let d=Rs(l,h);d!=null&&(s.push(u),o.set(u,d))}});let a=new te(s);return new Qa(o,a,r.fieldTransforms)}function Y0(n,t,e,i,r,s){let o=n.pu(1,t,e),a=[sf(t,i,e)],c=[r];if(s.length%2!=0)throw new b(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(sf(t,s[d])),c.push(s[d+1]);let l=[],u=Yt.empty();for(let d=a.length-1;d>=0;--d)if(!mv(l,a[d])){let f=a[d],y=c[d];y=Te(y);let v=o.Ru(f);if(y instanceof Wa)l.push(f);else{let p=Rs(y,v);p!=null&&(l.push(f),u.set(f,p))}}let h=new te(l);return new Qa(u,h,o.fieldTransforms)}function X0(n,t,e,i=!1){return Rs(e,n.pu(i?4:3,t))}function Rs(n,t){if(fv(n=Te(n)))return xf("Unsupported field value:",t,n),dv(n,t);if(n instanceof ws)return function(i,r){if(!hv(r.Iu))throw r.mu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.mu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.du&&t.Iu!==4)throw t.mu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let c=Rs(a,r.Vu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,t)}return function(i,r){if((i=Te(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return FT(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=At.fromDate(i);return{timestampValue:Va(r.serializer,s)}}if(i instanceof At){let s=new At(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Va(r.serializer,s)}}if(i instanceof Es)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof vs)return{bytesValue:Fy(r.serializer,i._byteString)};if(i instanceof Ut){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:vf(i.firestore._databaseId||r.databaseId,i._key.path)}}throw r.mu(`Unsupported field value: ${oc(i)}`)}(n,t)}function dv(n,t){let e={};return fy(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$n(n,(i,r)=>{let s=Rs(r,t.Eu(i));s!=null&&(e[i]=s)}),{mapValue:{fields:e}}}function fv(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof At||n instanceof Es||n instanceof vs||n instanceof Ut||n instanceof ws)}function xf(n,t,e){if(!fv(e)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(e)){let i=oc(e);throw i==="an object"?t.mu(n+" a custom object"):t.mu(n+" "+i)}}function sf(n,t,e){if((t=Te(t))instanceof Zi)return t._internalPath;if(typeof t=="string")return Df(n,t);throw Ha("Field path arguments must be of type string or ",n,!1,void 0,e)}var J0=new RegExp("[~\\*/\\[\\]]");function Df(n,t,e){if(t.search(J0)>=0)throw Ha(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Zi(...t.split("."))._internalPath}catch{throw Ha(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Ha(n,t,e,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new b(g.INVALID_ARGUMENT,a+n+c)}function mv(n,t){return n.some(e=>e.isEqual(t))}var Ya=class{constructor(t,e,i,r,s){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ut(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new of(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(ac("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},of=class extends Ya{data(){return super.data()}};function ac(n,t){return typeof t=="string"?Df(n,t):t instanceof Zi?t._internalPath:t._delegate._internalPath}function Z0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new b(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Is=class{},Ts=class extends Is{};function gv(n,t,...e){let i=[];t instanceof Is&&i.push(t),i=i.concat(e),function(s){let o=s.filter(c=>c instanceof af).length,a=s.filter(c=>c instanceof Xa).length;if(o>1||o>0&&a>0)throw new b(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var Xa=class n extends Ts{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new n(t,e,i)}_apply(t){let e=this._parse(t);return vv(t._query,e),new ln(t.firestore,t.converter,ed(t._query,e))}_parse(t){let e=Rf(t.firestore);return function(s,o,a,c,l,u,h){let d;if(l.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new b(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){hy(h,u);let f=[];for(let y of h)f.push(uy(c,s,y));d={arrayValue:{values:f}}}else d=uy(c,s,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||hy(h,u),d=X0(a,o,h,u==="in"||u==="not-in");return dt.create(l,u,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function pv(n,t,e){let i=t,r=ac("where",n);return Xa._create(r,i,e)}var af=class n extends Is{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(i=>i._parse(t)).filter(i=>i.getFilters().length>0);return e.length===1?e[0]:ae.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let c of a)vv(o,c),o=ed(o,c)}(t._query,e),new ln(t.firestore,t.converter,ed(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var cf=class n extends Ts{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(r,s,o){if(r.startAt!==null)throw new b(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new b(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new qn(s,o)}(t._query,this._field,this._direction);return new ln(t.firestore,t.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new sn(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(t._query,e))}};function _v(n,t="asc"){let e=t,i=ac("orderBy",n);return cf._create(i,e)}var lf=class n extends Ts{constructor(t,e,i){super(),this.type=t,this._limit=e,this._limitType=i}static _create(t,e,i){return new n(t,e,i)}_apply(t){return new ln(t.firestore,t.converter,Sa(t._query,this._limit,this._limitType))}};function yv(n){return K0("limit",n),lf._create("limit",n,"F")}function uy(n,t,e){if(typeof(e=Te(e))=="string"){if(e==="")throw new b(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ey(t)&&e.indexOf("/")!==-1)throw new b(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let i=t.path.child(et.fromString(e));if(!R.isDocumentKey(i))throw new b(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return B_(n,new R(i))}if(e instanceof Ut)return B_(n,e._key);throw new b(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${oc(e)}.`)}function hy(n,t){if(!Array.isArray(n)||n.length===0)throw new b(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function vv(n,t){let e=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new b(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new b(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var uf=class{convertValue(t,e="none"){switch(Bn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(rn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw D()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let i={};return $n(t,(r,s)=>{i[r]=this.convertValue(s,e)}),i}convertGeoPoint(t){return new Es(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":let i=mf(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(fs(t));default:return null}}convertTimestamp(t){let e=nn(t);return new At(e.seconds,e.nanos)}convertDocumentKey(t,e){let i=et.fromString(t);Z(Uy(i));let r=new ba(i.get(1),i.get(3)),s=new R(i.popFirst(5));return r.isEqual(e)||Me(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function tb(n,t,e){let i;return i=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,i}var Fn=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ja=class extends Ya{constructor(t,e,i,r,s,o){super(t,e,i,r,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Ui(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let i=this._document.data.field(ac("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}},Ui=class extends Ja{data(t={}){return super.data(t)}},hf=class{constructor(t,e,i,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Fn(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new Ui(this._firestore,this._userDataWriter,i.key,i,new Fn(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new b(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new Ui(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Fn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Ui(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Fn(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),l=-1,u=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:eb(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function eb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function wv(n){n=cn(n,Ut);let t=cn(n.firestore,Gn);return j0(Cf(t),n._key).then(e=>nb(t,n,e))}var Za=class extends uf{constructor(t){super(),this.firestore=t}convertBytes(t){return new vs(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ut(this.firestore,null,e)}};function Ev(n){n=cn(n,ln);let t=cn(n.firestore,Gn),e=Cf(t),i=new Za(t);return Z0(n._query),G0(e,n._query).then(r=>new hf(t,i,n,r))}function Iv(n,t,e,...i){n=cn(n,Ut);let r=cn(n.firestore,Gn),s=Rf(r),o;return o=typeof(t=Te(t))=="string"||t instanceof Zi?Y0(s,"updateDoc",n._key,t,e,i):H0(s,"updateDoc",n._key,t),bv(r,[o.toMutation(n._key,tn.exists(!0))])}function Tv(n,t){let e=cn(n.firestore,Gn),i=Sf(n),r=tb(n.converter,t);return bv(e,[W0(Rf(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,tn.exists(!1))]).then(()=>i)}function bv(n,t){return function(i,r){let s=new se;return i.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return P0(yield z0(i),r,s)})),s.promise}(Cf(n),t)}function nb(n,t,e){let i=e.docs.get(t._key),r=new Za(n);return new Ja(n,r,t._key,i,new Fn(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(r){tr=r})(Wf),Kf(new $f("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Gn(new Oh(i.getProvider("auth-internal")),new Bh(i.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new b(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ba(l.options.projectId,u)}(o,r),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),lr(F_,"4.4.0",t),lr(F_,"4.4.0","esm2017")})();var xs=class{constructor(t){return t}},Av="firestore",Pf=class{constructor(){return Jf(Av)}};var Vf=new Et("angularfire2.firestore-instances");function ib(n,t){let e=Xf(Av,n,t);return e&&new xs(e)}function rb(n){return(t,e)=>{let i=t.runOutsideAngular(()=>n(e));return new xs(i)}}var sb={provide:Pf,deps:[[new or,Vf]]},ob={provide:xs,useFactory:ib,deps:[[new or,Vf],em]},ab=(()=>{class n{constructor(){lr("angularfire",Yf.full,"fst")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Gt({type:n});static \u0275inj=jt({providers:[ob,sb]})}return n})();function NR(n,...t){return{ngModule:ab,providers:[{provide:Vf,useFactory:rb(n),multi:!0,deps:[Ct,St,tm,nm,[new or,wm],[new or,Zf],...t]}]}}var OR=Qt(x_,!0);var FR=Qt(Tv,!0);var MR=Qt(cv,!0);var LR=Qt(Sf,!0);var BR=Qt(wv,!0);var qR=Qt(Ev,!0);var UR=Qt(lv,!0);var zR=Qt(yv,!0);var jR=Qt(_v,!0);var GR=Qt(gv,!0);var $R=Qt(Iv,!0);var KR=Qt(pv,!0);export{hb as a,$s as b,db as c,Em as d,Im as e,bc as f,Ks as g,Tm as h,Ac as i,Ge as j,Bt as k,qv as l,Qb as m,si as n,pr as o,Jv as p,Lc as q,MA as r,LA as s,BA as t,qA as u,UA as v,mw as w,gw as x,hS as y,OS as z,xs as A,NR as B,OR as C,FR as D,MR as E,LR as F,BR as G,qR as H,UR as I,zR as J,jR as K,GR as L,$R as M,KR as N};
