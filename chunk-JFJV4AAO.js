import{B as Io,C as vr,D as fn,E as Er,F as Ir,H as To,I as Ao,J as So,K as bo,L as Tr,o as ao,p as co,q as uo,r as lo,s as ho,t as fo,u as mo,v as go,z as Eo}from"./chunk-JPBQN4UX.js";import{a as po,d as _o}from"./chunk-3S5AQKTW.js";import{w as oo}from"./chunk-SU2L6IEG.js";import{Dd as yo,Ed as wo,Fd as vo,Hb as Te,Ib as Ae,Lb as so,Na as xt,O as no,Oa as pr,Qb as yr,Rb as wr,W as gr,ba as Qt,eb as _r,ga as ve,ha as ro,ka as io,mb as Ee,nb as Ie,o as wt,u as ft,v as eo}from"./chunk-GT72LYG7.js";import{a as Kt,f as _}from"./chunk-ZY7WU73K.js";var Ro=(()=>{class e{constructor(n,r){this.data=n,this.dialogRef=r}static{this.\u0275fac=function(r){return new(r||e)(pr(co),pr(ao))}}static{this.\u0275cmp=io({type:e,selectors:[["app-confirm-dialog"]],standalone:!0,features:[so],decls:11,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","align","center"],["mat-button","",3,"mat-dialog-close"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(r,i){r&1&&(Ee(0,"h1",0),Te(1),Ie(),Ee(2,"div",1),Te(3),Ie(),Ee(4,"div",2)(5,"button",3),Te(6),yr(7,"translate"),Ie(),Ee(8,"button",4),Te(9),yr(10,"translate"),Ie()()),r&2&&(xt(),Ae(i.data.title),xt(2),Ae(i.data.content),xt(2),_r("mat-dialog-close",!1),xt(),Ae(wr(7,6,"uni.no")),xt(2),_r("mat-dialog-close",!0),xt(),Ae(wr(10,8,"uni.yes")))},dependencies:[go,lo,ho,mo,fo,_o,po,vo,wo],changeDetection:0})}}return e})();var Po=(()=>{class e{constructor(n){this.dialog=n}open(n,r){return this.dialog.open(Ro,{width:"sm",data:{title:n,content:r}}).afterClosed()}static{this.\u0275fac=function(r){return new(r||e)(ve(uo))}}static{this.\u0275prov=Qt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Se=function(e){return e[e.Delete=0]="Delete",e[e.UnsavedWork=1]="UnsavedWork",e}(Se||{}),Nd=(()=>{class e{constructor(n,r){this.confirm=n,this.translate=r}openCustomConfirmDialog(n){let r=this.getTitle(n),i=this.getContent(n);return this.open(r,i)}getTitle(n){switch(n){case Se.Delete:return this.translate.instant("custom-confirm-dialog.delete-post.title");case Se.UnsavedWork:return this.translate.instant("custom-confirm-dialog.unsaved-work.title");default:return this.translate.instant("custom-confirm-dialog.default.title")}}getContent(n){switch(n){case Se.Delete:return this.translate.instant("custom-confirm-dialog.delete-post.content");case Se.UnsavedWork:return this.translate.instant("custom-confirm-dialog.unsaved-work.content");default:return this.translate.instant("custom-confirm-dialog.default.content")}}open(n,r){return this.confirm.open(n,r).pipe(no(),ft(i=>!!i))}static{this.\u0275fac=function(r){return new(r||e)(ve(Po),ve(yo))}}static{this.\u0275prov=Qt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Co=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},cu=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=e[n++],o=e[n++],a=e[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return t.join("")},xo={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){let s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,u=c?e[i+2]:0,l=s>>2,h=(s&3)<<4|a>>4,p=(a&15)<<2|u>>6,y=u&63;c||(y=64,o||(p=64)),r.push(n[l],n[h],n[p],n[y])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Co(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):cu(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){let s=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;let u=i<e.length?n[e.charAt(i)]:64;++i;let h=i<e.length?n[e.charAt(i)]:64;if(++i,s==null||a==null||u==null||h==null)throw new Sr;let p=s<<2|a>>4;if(r.push(p),u!==64){let y=a<<4&240|u>>2;if(r.push(y),h!==64){let S=u<<6&192|h;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Sr=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},uu=function(e){let t=Co(e);return xo.encodeByteArray(t,!0)},br=function(e){return uu(e).replace(/\./g,"")},lu=function(e){try{return xo.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function hu(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var du=()=>hu().__FIREBASE_DEFAULTS__,fu=()=>{if(typeof process>"u"||typeof process.env>"u")return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},mu=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=e&&lu(e[1]);return t&&JSON.parse(t)},gu=()=>{try{return du()||fu()||mu()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}};function Re(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pu(){var e;let t=(e=gu())===null||e===void 0?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Do(){return!pu()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function mn(){try{return typeof indexedDB=="object"}catch{return!1}}function Vo(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;t(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){t(n)}})}var _u="FirebaseError",mt=class e extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=_u,Object.setPrototypeOf(this,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,be.prototype.create)}},be=class{constructor(t,n,r){this.service=t,this.serviceName=n,this.errors=r}create(t,...n){let r=n[0]||{},i=`${this.service}/${t}`,s=this.errors[t],o=s?yu(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new mt(i,a,r)}};function yu(e,t){return e.replace(wu,(n,r)=>{let i=t[r];return i!=null?String(i):`<${r}?>`})}var wu=/\{\$([^}]+)}/g;var Od=4*60*60*1e3;var vt=class{constructor(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var vu=[],T=function(e){return e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",e}(T||{}),Eu={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},Iu=T.INFO,Tu={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},Au=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=Tu[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Wt=class{constructor(t){this.name=t,this._logLevel=Iu,this._logHandler=Au,this._userLogHandler=null,vu.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in T))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Eu[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...t),this._logHandler(this,T.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...t),this._logHandler(this,T.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,T.INFO,...t),this._logHandler(this,T.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,T.WARN,...t),this._logHandler(this,T.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...t),this._logHandler(this,T.ERROR,...t)}};var Pr=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(bu(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function bu(e){let t=e.getComponent();return t?.type==="VERSION"}var Cr="@firebase/app",No="0.9.28";var Dt=new Wt("@firebase/app"),Ru="@firebase/app-compat",Pu="@firebase/analytics-compat",Cu="@firebase/analytics",xu="@firebase/app-check-compat",Du="@firebase/app-check",Vu="@firebase/auth",Nu="@firebase/auth-compat",ku="@firebase/database",Ou="@firebase/database-compat",Mu="@firebase/functions",Lu="@firebase/functions-compat",Fu="@firebase/installations",Bu="@firebase/installations-compat",qu="@firebase/messaging",Uu="@firebase/messaging-compat",zu="@firebase/performance",ju="@firebase/performance-compat",Gu="@firebase/remote-config",$u="@firebase/remote-config-compat",Ku="@firebase/storage",Qu="@firebase/storage-compat",Wu="@firebase/firestore",Hu="@firebase/firestore-compat",Yu="firebase",Xu="10.8.1";var Ju={[Cr]:"fire-core",[Ru]:"fire-core-compat",[Cu]:"fire-analytics",[Pu]:"fire-analytics-compat",[Du]:"fire-app-check",[xu]:"fire-app-check-compat",[Vu]:"fire-auth",[Nu]:"fire-auth-compat",[ku]:"fire-rtdb",[Ou]:"fire-rtdb-compat",[Mu]:"fire-fn",[Lu]:"fire-fn-compat",[Fu]:"fire-iid",[Bu]:"fire-iid-compat",[qu]:"fire-fcm",[Uu]:"fire-fcm-compat",[zu]:"fire-perf",[ju]:"fire-perf-compat",[Gu]:"fire-rc",[$u]:"fire-rc-compat",[Ku]:"fire-gcs",[Qu]:"fire-gcs-compat",[Wu]:"fire-fst",[Hu]:"fire-fst-compat","fire-js":"fire-js",[Yu]:"fire-js-all"};var Zu=new Map,ko=new Map;function tl(e,t){try{e.container.addComponent(t)}catch(n){Dt.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Pe(e){let t=e.name;if(ko.has(t))return Dt.debug(`There were multiple attempts to register component ${t}.`),!1;ko.set(t,e);for(let n of Zu.values())tl(n,e);return!0}var el={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Vr=new be("app","Firebase",el);var Fo=Xu;function Ht(e,t,n){var r;let i=(r=Ju[e])!==null&&r!==void 0?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${t}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Dt.warn(a.join(" "));return}Pe(new vt(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}var nl="firebase-heartbeat-database",rl=1,Ce="firebase-heartbeat-store",Rr=null;function Bo(){return Rr||(Rr=oo(nl,rl,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Ce)}catch(n){console.warn(n)}}}}).catch(e=>{throw Vr.create("idb-open",{originalErrorMessage:e.message})})),Rr}function il(e){return _(this,null,function*(){try{let n=(yield Bo()).transaction(Ce),r=yield n.objectStore(Ce).get(qo(e));return yield n.done,r}catch(t){if(t instanceof mt)Dt.warn(t.message);else{let n=Vr.create("idb-get",{originalErrorMessage:t?.message});Dt.warn(n.message)}}})}function Oo(e,t){return _(this,null,function*(){try{let r=(yield Bo()).transaction(Ce,"readwrite");yield r.objectStore(Ce).put(t,qo(e)),yield r.done}catch(n){if(n instanceof mt)Dt.warn(n.message);else{let r=Vr.create("idb-set",{originalErrorMessage:n?.message});Dt.warn(r.message)}}})}function qo(e){return`${e.name}!${e.options.appId}`}var sl=1024,ol=30*24*60*60*1e3,xr=class{constructor(t){this.container=t,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new Dr(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return _(this,null,function*(){var t,n;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Mo();if(!(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=ol}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return _(this,null,function*(){var t;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=Mo(),{heartbeatsToSend:r,unsentEntries:i}=al(this._heartbeatsCache.heartbeats),s=br(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s})}};function Mo(){return new Date().toISOString().substring(0,10)}function al(e,t=sl){let n=[],r=e.slice();for(let i of e){let s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Lo(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Lo(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var Dr=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return _(this,null,function*(){return mn()?Vo().then(()=>!0).catch(()=>!1):!1})}read(){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield il(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return _(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Oo(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return _(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Oo(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return})}};function Lo(e){return br(JSON.stringify({version:2,heartbeats:e})).length}function cl(e){Pe(new vt("platform-logger",t=>new Pr(t),"PRIVATE")),Pe(new vt("heartbeat",t=>new xr(t),"PRIVATE")),Ht(Cr,No,e),Ht(Cr,No,"esm2017"),Ht("fire-js","")}cl("");var ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},it={},m,ti=ti||{},w=ul||self;function Pn(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function je(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function ll(e){return Object.prototype.hasOwnProperty.call(e,Nr)&&e[Nr]||(e[Nr]=++hl)}var Nr="closure_uid_"+(1e9*Math.random()>>>0),hl=0;function dl(e,t,n){return e.call.apply(e.bind,arguments)}function fl(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function j(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?j=dl:j=fl,j.apply(null,arguments)}function gn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function F(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function Et(){this.s=this.s,this.o=this.o}var ml=0;Et.prototype.s=!1;Et.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),ml!=0)&&ll(this)};Et.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Zo=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function ei(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Uo(e,t){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(Pn(r)){let i=e.length||0,s=r.length||0;e.length=i+s;for(let o=0;o<s;o++)e[i+o]=r[o]}else e.push(r)}}function G(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}G.prototype.h=function(){this.defaultPrevented=!0};var gl=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let n=()=>{};w.addEventListener("test",n,t),w.removeEventListener("test",n,t)}catch{}return e}();function Oe(e){return/^[\s\xa0]*$/.test(e)}function Cn(){var e=w.navigator;return e&&(e=e.userAgent)?e:""}function ot(e){return Cn().indexOf(e)!=-1}function ni(e){return ni[" "](e),e}ni[" "]=function(){};function pl(e,t){var n=ih;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var _l=ot("Opera"),Zt=ot("Trident")||ot("MSIE"),ta=ot("Edge"),Fr=ta||Zt,ea=ot("Gecko")&&!(Cn().toLowerCase().indexOf("webkit")!=-1&&!ot("Edge"))&&!(ot("Trident")||ot("MSIE"))&&!ot("Edge"),yl=Cn().toLowerCase().indexOf("webkit")!=-1&&!ot("Edge");function na(){var e=w.document;return e?e.documentMode:void 0}var Br;t:{if(pn="",_n=function(){var e=Cn();if(ea)return/rv:([^\);]+)(\)|;)/.exec(e);if(ta)return/Edge\/([\d\.]+)/.exec(e);if(Zt)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(yl)return/WebKit\/(\S+)/.exec(e);if(_l)return/(?:Version)[ \/]?(\S+)/.exec(e)}(),_n&&(pn=_n?_n[1]:""),Zt&&(yn=na(),yn!=null&&yn>parseFloat(pn))){Br=String(yn);break t}Br=pn}var pn,_n,yn,qr;w.document&&Zt?(kr=na(),qr=kr||parseInt(Br,10)||void 0):qr=void 0;var kr,wl=qr;function Me(e,t){if(G.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ea){t:{try{ni(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:vl[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Me.$.h.call(this)}}F(Me,G);var vl={2:"touch",3:"pen",4:"mouse"};Me.prototype.h=function(){Me.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Ge="closure_listenable_"+(1e6*Math.random()|0),El=0;function Il(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++El,this.fa=this.ia=!1}function xn(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function ri(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function Tl(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function ra(e){let t={};for(let n in e)t[n]=e[n];return t}var zo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ia(e,t){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(let s=0;s<zo.length;s++)n=zo[s],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Dn(e){this.src=e,this.g={},this.h=0}Dn.prototype.add=function(e,t,n,r,i){var s=e.toString();e=this.g[s],e||(e=this.g[s]=[],this.h++);var o=zr(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):(t=new Il(t,this.src,s,!!r,i),t.ia=n,e.push(t)),t};function Ur(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=Zo(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(xn(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function zr(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}var ii="closure_lm_"+(1e6*Math.random()|0),Or={};function sa(e,t,n,r,i){if(r&&r.once)return aa(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)sa(e,t[s],n,r,i);return null}return n=ai(n),e&&e[Ge]?e.O(t,n,je(r)?!!r.capture:!!r,i):oa(e,t,n,!1,r,i)}function oa(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=je(i)?!!i.capture:!!i,a=oi(e);if(a||(e[ii]=a=new Dn(e)),n=a.add(t,n,r,o,s),n.proxy)return n;if(r=Al(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)gl||(i=o),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ua(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Al(){function e(n){return t.call(e.src,e.listener,n)}let t=Sl;return e}function aa(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)aa(e,t[s],n,r,i);return null}return n=ai(n),e&&e[Ge]?e.P(t,n,je(r)?!!r.capture:!!r,i):oa(e,t,n,!0,r,i)}function ca(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ca(e,t[s],n,r,i);else r=je(r)?!!r.capture:!!r,n=ai(n),e&&e[Ge]?(e=e.i,t=String(t).toString(),t in e.g&&(s=e.g[t],n=zr(s,n,r,i),-1<n&&(xn(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete e.g[t],e.h--)))):e&&(e=oi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=zr(t,n,r,i)),(n=-1<e?t[e]:null)&&si(n))}function si(e){if(typeof e!="number"&&e&&!e.fa){var t=e.src;if(t&&t[Ge])Ur(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ua(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=oi(t))?(Ur(n,e),n.h==0&&(n.src=null,t[ii]=null)):xn(e)}}}function ua(e){return e in Or?Or[e]:Or[e]="on"+e}function Sl(e,t){if(e.fa)e=!0;else{t=new Me(t,this);var n=e.listener,r=e.la||e.src;e.ia&&si(e),e=n.call(r,t)}return e}function oi(e){return e=e[ii],e instanceof Dn?e:null}var Mr="__closure_events_fn_"+(1e9*Math.random()>>>0);function ai(e){return typeof e=="function"?e:(e[Mr]||(e[Mr]=function(t){return e.handleEvent(t)}),e[Mr])}function L(){Et.call(this),this.i=new Dn(this),this.S=this,this.J=null}F(L,Et);L.prototype[Ge]=!0;L.prototype.removeEventListener=function(e,t,n,r){ca(this,e,t,n,r)};function z(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,typeof t=="string")t=new G(t,e);else if(t instanceof G)t.target=t.target||e;else{var i=t;t=new G(r,e),ia(t,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=wn(o,r,!0,t)&&i}if(o=t.g=e,i=wn(o,r,!0,t)&&i,i=wn(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)o=t.g=n[s],i=wn(o,r,!1,t)&&i}L.prototype.N=function(){if(L.$.N.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)xn(n[r]);delete e.g[t],e.h--}}this.J=null};L.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};L.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function wn(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Ur(e.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var ci=w.JSON.stringify,jr=class{constructor(t,n){this.i=t,this.j=n,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function bl(){var e=ui;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Gr=class{constructor(){this.h=this.g=null}add(t,n){let r=la.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r}},la=new jr(()=>new $r,e=>e.reset()),$r=class{constructor(){this.next=this.g=this.h=null}set(t,n){this.h=t,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Rl(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Pl(e){w.setTimeout(()=>{throw e},0)}var Le,Fe=!1,ui=new Gr,ha=()=>{let e=w.Promise.resolve(void 0);Le=()=>{e.then(Cl)}},Cl=()=>{for(var e;e=bl();){try{e.h.call(e.g)}catch(n){Pl(n)}var t=la;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Fe=!1};function Vn(e,t){L.call(this),this.h=e||1,this.g=t||w,this.j=j(this.qb,this),this.l=Date.now()}F(Vn,L);m=Vn.prototype;m.ga=!1;m.T=null;m.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),z(this,"tick"),this.ga&&(li(this),this.start()))}};m.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function li(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}m.N=function(){Vn.$.N.call(this),li(this),delete this.g};function hi(e,t,n){if(typeof e=="function")n&&(e=j(e,n));else if(e&&typeof e.handleEvent=="function")e=j(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:w.setTimeout(e,t||0)}function da(e){e.g=hi(()=>{e.g=null,e.i&&(e.i=!1,da(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}var Kr=class extends Et{constructor(t,n){super(),this.m=t,this.j=n,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:da(this)}N(){super.N(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Be(e){Et.call(this),this.h=e,this.g={}}F(Be,Et);var jo=[];function fa(e,t,n,r){Array.isArray(n)||(n&&(jo[0]=n.toString()),n=jo);for(var i=0;i<n.length;i++){var s=sa(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ma(e){ri(e.g,function(t,n){this.g.hasOwnProperty(n)&&si(t)},e),e.g={}}Be.prototype.N=function(){Be.$.N.call(this),ma(this)};Be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Nn(){this.g=!0}Nn.prototype.Ea=function(){this.g=!1};function xl(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+o})}function Dl(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+s+" "+o})}function Xt(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+Nl(e,n)+(r?" "+r:"")})}function Vl(e,t){e.info(function(){return"TIMEOUT: "+t})}Nn.prototype.info=function(){};function Nl(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return ci(n)}catch{return t}}var Ot={},Go=null;function kn(){return Go=Go||new L}Ot.Ta="serverreachability";function ga(e){G.call(this,Ot.Ta,e)}F(ga,G);function qe(e){let t=kn();z(t,new ga(t))}Ot.STAT_EVENT="statevent";function pa(e,t){G.call(this,Ot.STAT_EVENT,e),this.stat=t}F(pa,G);function Y(e){let t=kn();z(t,new pa(t,e))}Ot.Ua="timingevent";function _a(e,t){G.call(this,Ot.Ua,e),this.size=t}F(_a,G);function $e(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){e()},t)}var On={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ya={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function di(){}di.prototype.h=null;function $o(e){return e.h||(e.h=e.i())}function wa(){}var Ke={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function fi(){G.call(this,"d")}F(fi,G);function mi(){G.call(this,"c")}F(mi,G);var Qr;function Mn(){}F(Mn,di);Mn.prototype.g=function(){return new XMLHttpRequest};Mn.prototype.i=function(){return{}};Qr=new Mn;function Qe(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Be(this),this.P=kl,e=Fr?125:void 0,this.V=new Vn(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new va}function va(){this.i=null,this.g="",this.h=!1}var kl=45e3,Ea={},Wr={};m=Qe.prototype;m.setTimeout=function(e){this.P=e};function Hr(e,t,n){e.L=1,e.A=Fn(pt(t)),e.u=n,e.S=!0,Ia(e,null)}function Ia(e,t){e.G=Date.now(),We(e),e.B=pt(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),xa(n.i,"t",r),e.o=0,n=e.l.J,e.h=new va,e.g=Xa(e.l,n?t:null,!e.u),0<e.O&&(e.M=new Kr(j(e.Pa,e,e.g),e.O)),fa(e.U,e.g,"readystatechange",e.nb),t=e.I?ra(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),qe(),xl(e.j,e.v,e.B,e.m,e.W,e.u)}m.nb=function(e){e=e.target;let t=this.M;t&&at(e)==3?t.l():this.Pa(e)};m.Pa=function(e){try{if(e==this.g)t:{let l=at(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Fr||this.g&&(this.h.h||this.g.ja()||Ho(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?qe(3):qe(2)),Ln(this);var n=this.g.da();this.ca=n;e:if(Ta(this)){var r=Ho(this.g);e="";var i=r.length,s=at(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Vt(this),ke(this);var o="";break e}this.h.i=new w.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Dl(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Oe(a)){var u=a;break e}}u=null}if(n=u)Xt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Yr(this,n);else{this.i=!1,this.s=3,Y(12),Vt(this),ke(this);break t}}this.S?(Aa(this,l,o),Fr&&this.i&&l==3&&(fa(this.U,this.V,"tick",this.mb),this.V.start())):(Xt(this.j,this.m,o,null),Yr(this,o)),l==4&&Vt(this),this.i&&!this.J&&(l==4?Qa(this.l,this):(this.i=!1,We(this)))}else eh(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,Y(12)):(this.s=0,Y(13)),Vt(this),ke(this)}}}catch{}finally{}};function Ta(e){return e.g?e.v=="GET"&&e.L!=2&&e.l.Ha:!1}function Aa(e,t,n){let r=!0,i;for(;!e.J&&e.o<n.length;)if(i=Ol(e,n),i==Wr){t==4&&(e.s=4,Y(14),r=!1),Xt(e.j,e.m,null,"[Incomplete Response]");break}else if(i==Ea){e.s=4,Y(15),Xt(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else Xt(e.j,e.m,i,null),Yr(e,i);Ta(e)&&e.o!=0&&(e.h.g=e.h.g.slice(e.o),e.o=0),t!=4||n.length!=0||e.h.h||(e.s=1,Y(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,t=e.l,t.g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),vi(t),t.M=!0,Y(11))):(Xt(e.j,e.m,n,"[Invalid Chunked Response]"),Vt(e),ke(e))}m.mb=function(){if(this.g){var e=at(this.g),t=this.g.ja();this.o<t.length&&(Ln(this),Aa(this,e,t),this.i&&e!=4&&We(this))}};function Ol(e,t){var n=e.o,r=t.indexOf(`
`,n);return r==-1?Wr:(n=Number(t.substring(n,r)),isNaN(n)?Ea:(r+=1,r+n>t.length?Wr:(t=t.slice(r,r+n),e.o=r+n,t)))}m.cancel=function(){this.J=!0,Vt(this)};function We(e){e.Y=Date.now()+e.P,Sa(e,e.P)}function Sa(e,t){if(e.C!=null)throw Error("WatchDog timer not null");e.C=$e(j(e.lb,e),t)}function Ln(e){e.C&&(w.clearTimeout(e.C),e.C=null)}m.lb=function(){this.C=null;let e=Date.now();0<=e-this.Y?(Vl(this.j,this.B),this.L!=2&&(qe(),Y(17)),Vt(this),this.s=2,ke(this)):Sa(this,this.Y-e)};function ke(e){e.l.H==0||e.J||Qa(e.l,e)}function Vt(e){Ln(e);var t=e.M;t&&typeof t.sa=="function"&&t.sa(),e.M=null,li(e.V),ma(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Yr(e,t){try{var n=e.l;if(n.H!=0&&(n.g==e||Xr(n.i,e))){if(!e.K&&Xr(n.i,e)&&n.H==3){try{var r=n.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)An(n),Un(n);else break t;wi(n),Y(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=$e(j(n.ib,n),6e3));if(1>=Na(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Nt(n,11)}else if((e.K||n.g==e)&&An(n),!Oe(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];let l=u[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let h=u[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let p=u[5];p!=null&&typeof p=="number"&&0<p&&(r=1.5*p,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let y=e.g;if(y){let S=y.g?y.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.i;s.g||S.indexOf("spdy")==-1&&S.indexOf("quic")==-1&&S.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(gi(s,s.h),s.h=null))}if(r.F){let D=y.g?y.g.getResponseHeader("X-HTTP-Session-Id"):null;D&&(r.Da=D,P(r.I,r.F,D))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=e;if(r.wa=Ya(r,r.J?r.pa:null,r.Y),o.K){ka(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Ln(a),We(a)),r.g=o}else $a(r);0<n.j.length&&zn(n)}else u[0]!="stop"&&u[0]!="close"||Nt(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Nt(n,7):yi(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}qe(4)}catch{}}function Ml(e){if(e.Z&&typeof e.Z=="function")return e.Z();if(typeof Map<"u"&&e instanceof Map||typeof Set<"u"&&e instanceof Set)return Array.from(e.values());if(typeof e=="string")return e.split("");if(Pn(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Ll(e){if(e.ta&&typeof e.ta=="function")return e.ta();if(!e.Z||typeof e.Z!="function"){if(typeof Map<"u"&&e instanceof Map)return Array.from(e.keys());if(!(typeof Set<"u"&&e instanceof Set)){if(Pn(e)||typeof e=="string"){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(let r in e)t[n++]=r;return t}}}function ba(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(Pn(e)||typeof e=="string")Array.prototype.forEach.call(e,t,void 0);else for(var n=Ll(e),r=Ml(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}var Ra=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Fl(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function kt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof kt){this.h=e.h,In(this,e.j),this.s=e.s,this.g=e.g,Tn(this,e.m),this.l=e.l;var t=e.i,n=new Ue;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ko(this,n),this.o=e.o}else e&&(t=String(e).match(Ra))?(this.h=!1,In(this,t[1]||"",!0),this.s=Ve(t[2]||""),this.g=Ve(t[3]||"",!0),Tn(this,t[4]),this.l=Ve(t[5]||"",!0),Ko(this,t[6]||"",!0),this.o=Ve(t[7]||"")):(this.h=!1,this.i=new Ue(null,this.h))}kt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ne(t,Qo,!0),":");var n=this.g;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Ne(t,Qo,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&e.push("/"),e.push(Ne(n,n.charAt(0)=="/"?Ul:ql,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ne(n,jl)),e.join("")};function pt(e){return new kt(e)}function In(e,t,n){e.j=n?Ve(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Tn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ko(e,t,n){t instanceof Ue?(e.i=t,Gl(e.i,e.h)):(n||(t=Ne(t,zl)),e.i=new Ue(t,e.h))}function P(e,t,n){e.i.set(t,n)}function Fn(e){return P(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ve(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ne(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Bl),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Bl(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var Qo=/[#\/\?@]/g,ql=/[#\?:]/g,Ul=/[#\?]/g,zl=/[#\?@]/g,jl=/#/g;function Ue(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function It(e){e.g||(e.g=new Map,e.h=0,e.i&&Fl(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}m=Ue.prototype;m.add=function(e,t){It(this),this.i=null,e=te(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function Pa(e,t){It(e),t=te(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ca(e,t){return It(e),t=te(e,t),e.g.has(t)}m.forEach=function(e,t){It(this),this.g.forEach(function(n,r){n.forEach(function(i){e.call(t,i,r,this)},this)},this)};m.ta=function(){It(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let s=0;s<i.length;s++)n.push(t[r])}return n};m.Z=function(e){It(this);let t=[];if(typeof e=="string")Ca(this,e)&&(t=t.concat(this.g.get(te(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t};m.set=function(e,t){return It(this),this.i=null,e=te(this,e),Ca(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};m.get=function(e,t){return e?(e=this.Z(e),0<e.length?String(e[0]):t):t};function xa(e,t,n){Pa(e,t),0<n.length&&(e.i=null,e.g.set(te(e,t),ei(n)),e.h+=n.length)}m.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};function te(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Gl(e,t){t&&!e.j&&(It(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Pa(this,r),xa(this,i,n))},e)),e.j=t}var $l=class{constructor(e,t){this.g=e,this.map=t}};function Da(e){this.l=e||Kl,w.PerformanceNavigationTiming?(e=w.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(w.g&&w.g.Ka&&w.g.Ka()&&w.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Kl=10;function Va(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function Na(e){return e.h?1:e.g?e.g.size:0}function Xr(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function gi(e,t){e.g?e.g.add(t):e.h=t}function ka(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Da.prototype.cancel=function(){if(this.i=Oa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function Oa(e){if(e.h!=null)return e.i.concat(e.h.F);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return ei(e.i)}var Ql=class{stringify(e){return w.JSON.stringify(e,void 0)}parse(e){return w.JSON.parse(e,void 0)}};function Wl(){this.g=new Ql}function Hl(e,t,n){let r=n||"";try{ba(e,function(i,s){let o=i;je(i)&&(o=ci(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Yl(e,t){let n=new Nn;if(w.Image){let r=new Image;r.onload=gn(vn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=gn(vn,n,r,"TestLoadImage: error",!1,t),r.onabort=gn(vn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=gn(vn,n,r,"TestLoadImage: timeout",!1,t),w.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function vn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function He(e){this.l=e.ec||null,this.j=e.ob||!1}F(He,di);He.prototype.g=function(){return new Bn(this.l,this.j)};He.prototype.i=function(e){return function(){return e}}({});function Bn(e,t){L.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=pi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}F(Bn,L);var pi=0;m=Bn.prototype;m.open=function(e,t){if(this.readyState!=pi)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ze(this)};m.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||w).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};m.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ye(this)),this.readyState=pi};m.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ze(this)),this.g&&(this.readyState=3,ze(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof w.ReadableStream<"u"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ma(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))};function Ma(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}m.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ye(this):ze(this),this.readyState==3&&Ma(this)}};m.Za=function(e){this.g&&(this.response=this.responseText=e,Ye(this))};m.Ya=function(e){this.g&&(this.response=e,Ye(this))};m.ka=function(){this.g&&Ye(this)};function Ye(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ze(e)}m.setRequestHeader=function(e,t){this.v.append(e,t)};m.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};m.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function ze(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Bn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var Xl=w.JSON.parse;function V(e){L.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=La,this.L=this.M=!1}F(V,L);var La="",Jl=/^https?$/i,Zl=["POST","PUT"];m=V.prototype;m.Oa=function(e){this.M=e};m.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Qr.g(),this.C=this.u?$o(this.u):$o(Qr),this.g.onreadystatechange=j(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(s){Wo(this,s);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=w.FormData&&e instanceof w.FormData,!(0<=Zo(Zl,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{qa(this),0<this.B&&((this.L=th(this.g))?(this.g.timeout=this.B,this.g.ontimeout=j(this.ua,this)):this.A=hi(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Wo(this,s)}};function th(e){return Zt&&typeof e.timeout=="number"&&e.ontimeout!==void 0}m.ua=function(){typeof ti<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,z(this,"timeout"),this.abort(8))};function Wo(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Fa(e),qn(e)}function Fa(e){e.F||(e.F=!0,z(e,"complete"),z(e,"error"))}m.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,z(this,"complete"),z(this,"abort"),qn(this))};m.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),qn(this,!0)),V.$.N.call(this)};m.La=function(){this.s||(this.G||this.v||this.l?Ba(this):this.kb())};m.kb=function(){Ba(this)};function Ba(e){if(e.h&&typeof ti<"u"&&(!e.C[1]||at(e)!=4||e.da()!=2)){if(e.v&&at(e)==4)hi(e.La,0,e);else if(z(e,"readystatechange"),at(e)==4){e.h=!1;try{let o=e.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var n;if(!(n=t)){var r;if(r=o===0){var i=String(e.I).match(Ra)[1]||null;!i&&w.self&&w.self.location&&(i=w.self.location.protocol.slice(0,-1)),r=!Jl.test(i?i.toLowerCase():"")}n=r}if(n)z(e,"complete"),z(e,"success");else{e.m=6;try{var s=2<at(e)?e.g.statusText:""}catch{s=""}e.j=s+" ["+e.da()+"]",Fa(e)}}finally{qn(e)}}}}function qn(e,t){if(e.g){qa(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||z(e,"ready");try{n.onreadystatechange=r}catch{}}}function qa(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(w.clearTimeout(e.A),e.A=null)}m.isActive=function(){return!!this.g};function at(e){return e.g?e.g.readyState:0}m.da=function(){try{return 2<at(this)?this.g.status:-1}catch{return-1}};m.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};m.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),Xl(t)}};function Ho(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case La:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function eh(e){let t={};e=(e.g&&2<=at(e)&&e.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<e.length;r++){if(Oe(e[r]))continue;var n=Rl(e[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}Tl(t,function(r){return r.join(", ")})}m.Ia=function(){return this.m};m.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Ua(e){let t="";return ri(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function _i(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ua(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):P(e,t,n))}function xe(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function za(e){this.Ga=0,this.j=[],this.l=new Nn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=xe("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=xe("baseRetryDelayMs",5e3,e),this.hb=xe("retryDelaySeedMs",1e4,e),this.eb=xe("forwardChannelMaxRetries",2,e),this.xa=xe("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Da(e&&e.concurrentRequestLimit),this.Ja=new Wl,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}m=za.prototype;m.ra=8;m.H=1;function yi(e){if(ja(e),e.H==3){var t=e.W++,n=pt(e.I);if(P(n,"SID",e.K),P(n,"RID",t),P(n,"TYPE","terminate"),Xe(e,n),t=new Qe(e,e.l,t),t.L=2,t.A=Fn(pt(n)),n=!1,w.navigator&&w.navigator.sendBeacon)try{n=w.navigator.sendBeacon(t.A.toString(),"")}catch{}!n&&w.Image&&(new Image().src=t.A,n=!0),n||(t.g=Xa(t.l,null),t.g.ha(t.A)),t.G=Date.now(),We(t)}Ha(e)}function Un(e){e.g&&(vi(e),e.g.cancel(),e.g=null)}function ja(e){Un(e),e.u&&(w.clearTimeout(e.u),e.u=null),An(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&w.clearTimeout(e.m),e.m=null)}function zn(e){if(!Va(e.i)&&!e.m){e.m=!0;var t=e.Na;Le||ha(),Fe||(Le(),Fe=!0),ui.add(t,e),e.C=0}}function nh(e,t){return Na(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.j=t.F.concat(e.j),!0):e.H==1||e.H==2||e.C>=(e.cb?0:e.eb)?!1:(e.m=$e(j(e.Na,e,t),Wa(e,e.C)),e.C++,!0)}m.Na=function(e){if(this.m)if(this.m=null,this.H==1){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new Qe(this,this.l,e),s=this.s;if(this.U&&(s?(s=ra(s),ia(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,n=0;n<this.j.length;n++){e:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=n;break t}if(t===4096||n===this.j.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=Ga(this,i,t),n=pt(this.I),P(n,"RID",e),P(n,"CVER",22),this.F&&P(n,"X-HTTP-Session-Id",this.F),Xe(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Ua(s)))+"&"+t:this.o&&_i(n,this.o,s)),gi(this.i,i),this.bb&&P(n,"TYPE","init"),this.P?(P(n,"$req",t),P(n,"SID","null"),i.aa=!0,Hr(i,n,null)):Hr(i,n,t),this.H=2}}else this.H==3&&(e?Yo(this,e):this.j.length==0||Va(this.i)||Yo(this))};function Yo(e,t){var n;t?n=t.m:n=e.W++;let r=pt(e.I);P(r,"SID",e.K),P(r,"RID",n),P(r,"AID",e.V),Xe(e,r),e.o&&e.s&&_i(r,e.o,e.s),n=new Qe(e,e.l,n,e.C+1),e.o===null&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Ga(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),gi(e.i,n),Hr(n,r,t)}function Xe(e,t){e.na&&ri(e.na,function(n,r){P(t,r,n)}),e.h&&ba({},function(n,r){P(t,r,n)})}function Ga(e,t,n){n=Math.min(e.j.length,n);var r=e.h?j(e.h.Va,e.h,e):null;t:{var i=e.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{Hl(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return e=e.j.splice(0,n),t.F=e,r}function $a(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Le||ha(),Fe||(Le(),Fe=!0),ui.add(t,e),e.A=0}}function wi(e){return e.g||e.u||3<=e.A?!1:(e.ba++,e.u=$e(j(e.Ma,e),Wa(e,e.A)),e.A++,!0)}m.Ma=function(){if(this.u=null,Ka(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=$e(j(this.jb,this),e)}};m.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Y(10),Un(this),Ka(this))};function vi(e){e.B!=null&&(w.clearTimeout(e.B),e.B=null)}function Ka(e){e.g=new Qe(e,e.l,"rpc",e.ba),e.o===null&&(e.g.I=e.s),e.g.O=0;var t=pt(e.wa);P(t,"RID","rpc"),P(t,"SID",e.K),P(t,"AID",e.V),P(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&P(t,"TO",e.qa),P(t,"TYPE","xmlhttp"),Xe(e,t),e.o&&e.s&&_i(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Fn(pt(t)),n.u=null,n.S=!0,Ia(n,e)}m.ib=function(){this.v!=null&&(this.v=null,Un(this),wi(this),Y(19))};function An(e){e.v!=null&&(w.clearTimeout(e.v),e.v=null)}function Qa(e,t){var n=null;if(e.g==t){An(e),vi(e),e.g=null;var r=2}else if(Xr(e.i,t))n=t.F,ka(e.i,t),r=1;else return;if(e.H!=0){if(t.i)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;r=kn(),z(r,new _a(r,n)),zn(e)}else $a(e);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&nh(e,t)||r==2&&wi(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Nt(e,5);break;case 4:Nt(e,10);break;case 3:Nt(e,6);break;default:Nt(e,2)}}}function Wa(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Nt(e,t){if(e.l.info("Error code "+t),t==2){var n=null;e.h&&(n=null);var r=j(e.pb,e);n||(n=new kt("//www.google.com/images/cleardot.gif"),w.location&&w.location.protocol=="http"||In(n,"https"),Fn(n)),Yl(n.toString(),r)}else Y(2);e.H=0,e.h&&e.h.za(t),Ha(e),ja(e)}m.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Y(2)):(this.l.info("Failed to ping google.com"),Y(1))};function Ha(e){if(e.H=0,e.ma=[],e.h){let t=Oa(e.i);(t.length!=0||e.j.length!=0)&&(Uo(e.ma,t),Uo(e.ma,e.j),e.i.i.length=0,ei(e.j),e.j.length=0),e.h.ya()}}function Ya(e,t,n){var r=n instanceof kt?pt(n):new kt(n);if(r.g!="")t&&(r.g=t+"."+r.g),Tn(r,r.m);else{var i=w.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new kt(null);r&&In(s,r),t&&(s.g=t),i&&Tn(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&P(r,n,t),P(r,"VER",e.ra),Xe(e,r),r}function Xa(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=e.Ha&&!e.va?new V(new He({ob:n})):new V(e.va),t.Oa(e.J),t}m.isActive=function(){return!!this.h&&this.h.isActive(this)};function Ja(){}m=Ja.prototype;m.Ba=function(){};m.Aa=function(){};m.za=function(){};m.ya=function(){};m.isActive=function(){return!0};m.Va=function(){};function Sn(){if(Zt&&!(10<=Number(wl)))throw Error("Environmental error: no available transport.")}Sn.prototype.g=function(e,t){return new J(e,t)};function J(e,t){L.call(this),this.g=new za(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Oe(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Oe(t)&&(this.g.F=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new ee(this)}F(J,L);J.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Y(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Ya(e,null,e.Y),zn(e)};J.prototype.close=function(){yi(this.g)};J.prototype.u=function(e){var t=this.g;if(typeof e=="string"){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=ci(e),e=n);t.j.push(new $l(t.fb++,e)),t.H==3&&zn(t)};J.prototype.N=function(){this.g.h=null,delete this.j,yi(this.g),delete this.g,J.$.N.call(this)};function Za(e){fi.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){t:{for(let n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}F(Za,fi);function tc(){mi.call(this),this.status=1}F(tc,mi);function ee(e){this.g=e}F(ee,Ja);ee.prototype.Ba=function(){z(this.g,"a")};ee.prototype.Aa=function(e){z(this.g,new Za(e))};ee.prototype.za=function(e){z(this.g,new tc)};ee.prototype.ya=function(){z(this.g,"b")};function rh(){this.blockSize=-1}function rt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}F(rt,rh);rt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Lr(e,t,n){n||(n=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(n^i))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(n^i^s)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(i^(n|~s))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}rt.prototype.j=function(e,t){t===void 0&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=n;)Lr(this,e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Lr(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Lr(this,r),i=0;break}}this.h=i,this.i+=t};rt.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=n&255,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};function b(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=e[i]|0;r&&s==t||(n[i]=s,r=!1)}this.g=n}var ih={};function Ei(e){return-128<=e&&128>e?pl(e,function(t){return new b([t|0],0>t?-1:0)}):new b([e|0],0>e?-1:0)}function ct(e){if(isNaN(e)||!isFinite(e))return Jt;if(0>e)return U(ct(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Jr;return new b(t,0)}function ec(e,t){if(e.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(e.charAt(0)=="-")return U(ec(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=ct(Math.pow(t,8)),r=Jt,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),o=parseInt(e.substring(i,i+s),t);8>s?(s=ct(Math.pow(t,s)),r=r.R(s).add(ct(o))):(r=r.R(n),r=r.add(ct(o)))}return r}var Jr=4294967296,Jt=Ei(0),Zr=Ei(1),Xo=Ei(16777216);m=b.prototype;m.ea=function(){if(et(this))return-U(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Jr+r)*t,t*=Jr}return e};m.toString=function(e){if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(gt(this))return"0";if(et(this))return"-"+U(this).toString(e);for(var t=ct(Math.pow(e,6)),n=this,r="";;){var i=Rn(n,t).g;n=bn(n,i.R(t));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(e);if(n=i,gt(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};m.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h};function gt(e){if(e.h!=0)return!1;for(var t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function et(e){return e.h==-1}m.X=function(e){return e=bn(this,e),et(e)?-1:gt(e)?0:1};function U(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new b(n,~e.h).add(Zr)}m.abs=function(){return et(this)?U(this):this};m.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(e.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new b(n,n[n.length-1]&-2147483648?-1:0)};function bn(e,t){return e.add(U(t))}m.R=function(e){if(gt(this)||gt(e))return Jt;if(et(this))return et(e)?U(this).R(U(e)):U(U(this).R(e));if(et(e))return U(this.R(U(e)));if(0>this.X(Xo)&&0>e.X(Xo))return ct(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=e.D(i)>>>16,c=e.D(i)&65535;n[2*r+2*i]+=o*c,En(n,2*r+2*i),n[2*r+2*i+1]+=s*c,En(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,En(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,En(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new b(n,0)};function En(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function De(e,t){this.g=e,this.h=t}function Rn(e,t){if(gt(t))throw Error("division by zero");if(gt(e))return new De(Jt,Jt);if(et(e))return t=Rn(U(e),t),new De(U(t.g),U(t.h));if(et(t))return t=Rn(e,U(t)),new De(U(t.g),t.h);if(30<e.g.length){if(et(e)||et(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Zr,r=t;0>=r.X(e);)n=Jo(n),r=Jo(r);var i=Yt(n,1),s=Yt(r,1);for(r=Yt(r,2),n=Yt(n,2);!gt(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=Yt(r,1),n=Yt(n,1)}return t=bn(e,i.R(t)),new De(i,t)}for(i=Jt;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=ct(n),o=s.R(t);et(o)||0<o.X(e);)n-=r,s=ct(n),o=s.R(t);gt(s)&&(s=Zr),i=i.add(s),e=bn(e,o)}return new De(i,e)}m.gb=function(e){return Rn(this,e).h};m.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new b(n,this.h&e.h)};m.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new b(n,this.h|e.h)};m.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new b(n,this.h^e.h)};function Jo(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new b(n,e.h)}function Yt(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new b(i,e.h)}Sn.prototype.createWebChannel=Sn.prototype.g;J.prototype.send=J.prototype.u;J.prototype.open=J.prototype.m;J.prototype.close=J.prototype.close;On.NO_ERROR=0;On.TIMEOUT=8;On.HTTP_ERROR=6;ya.COMPLETE="complete";wa.EventType=Ke;Ke.OPEN="a";Ke.CLOSE="b";Ke.ERROR="c";Ke.MESSAGE="d";L.prototype.listen=L.prototype.O;V.prototype.listenOnce=V.prototype.P;V.prototype.getLastError=V.prototype.Sa;V.prototype.getLastErrorCode=V.prototype.Ia;V.prototype.getStatus=V.prototype.da;V.prototype.getResponseJson=V.prototype.Wa;V.prototype.getResponseText=V.prototype.ja;V.prototype.send=V.prototype.ha;V.prototype.setWithCredentials=V.prototype.Oa;rt.prototype.digest=rt.prototype.l;rt.prototype.reset=rt.prototype.reset;rt.prototype.update=rt.prototype.j;b.prototype.add=b.prototype.add;b.prototype.multiply=b.prototype.R;b.prototype.modulo=b.prototype.gb;b.prototype.compare=b.prototype.X;b.prototype.toNumber=b.prototype.ea;b.prototype.toString=b.prototype.toString;b.prototype.getBits=b.prototype.D;b.fromNumber=ct;b.fromString=ec;var nc=it.createWebChannelTransport=function(){return new Sn},rc=it.getStatEventTarget=function(){return kn()},jn=it.ErrorCode=On,ic=it.EventType=ya,sc=it.Event=Ot,Ii=it.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Zd=it.FetchXmlHttpFactory=He,Je=it.WebChannel=wa,oc=it.XhrIo=V,sh=it.Md5=rt,ac=it.Integer=b;var cc="@firebase/firestore";var K=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};K.UNAUTHENTICATED=new K(null),K.GOOGLE_CREDENTIALS=new K("google-credentials-uid"),K.FIRST_PARTY=new K("first-party-uid"),K.MOCK_USER=new K("mock-user");var we="10.8.1";var Ut=new Wt("@firebase/firestore");function Ze(){return Ut.logLevel}function g(e,...t){if(Ut.logLevel<=T.DEBUG){let n=t.map(Gs);Ut.debug(`Firestore (${we}): ${e}`,...n)}}function At(e,...t){if(Ut.logLevel<=T.ERROR){let n=t.map(Gs);Ut.error(`Firestore (${we}): ${e}`,...n)}}function bi(e,...t){if(Ut.logLevel<=T.WARN){let n=t.map(Gs);Ut.warn(`Firestore (${we}): ${e}`,...n)}}function Gs(e){if(typeof e=="string")return e;try{return function(n){return JSON.stringify(n)}(e)}catch{return e}}function E(e="Unexpected state"){let t=`FIRESTORE (${we}) INTERNAL ASSERTION FAILED: `+e;throw At(t),new Error(t)}function q(e,t){e||E()}function C(e,t){return e}var f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},v=class extends mt{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var lt=class{constructor(){this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}};var Ri=class{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Pi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable(()=>n(K.UNAUTHENTICATED))}shutdown(){}};var Ci=class{constructor(t){this.t=t,this.currentUser=K.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i,i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),s=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new lt,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>_(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{g("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(g("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new lt)}},0),o()}getToken(){let t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==t?(g("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new Ri(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new K(t)}},xi=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=K.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Di=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r}getToken(){return Promise.resolve(new xi(this.l,this.h,this.P))}start(t,n){t.enqueueRetryable(()=>n(K.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Vi=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ni=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,n){let r=s=>{s.error!=null&&g("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,g("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{g("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):g("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(n=>n?(q(typeof n.token=="string"),this.R=n.token,new Vi(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function oh(e){let t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var ki=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=oh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=t.charAt(i[s]%t.length))}return r}};function x(e,t){return e<t?-1:e>t?1:0}function se(e,t,n){return e.length===t.length&&e.every((r,i)=>n(r,t[i]))}var nt=class e{constructor(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return e.fromMillis(Date.now())}static fromDate(t){return e.fromMillis(t.getTime())}static fromMillis(t){let n=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*n));return new e(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?x(this.nanoseconds,t.nanoseconds):x(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var N=class e{constructor(t){this.timestamp=t}static fromTimestamp(t){return new e(t)}static min(){return new e(new nt(0,0))}static max(){return new e(new nt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Hn=class e{constructor(t,n,r){n===void 0?n=0:n>t.length&&E(),r===void 0?r=t.length-n:r>t.length-n&&E(),this.segments=t,this.offset=n,this.len=r}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(r=>{n.push(r)}):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let i=0;i<r;i++){let s=t.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<n.length?-1:t.length>n.length?1:0}},Q=class e extends Hn{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let n=[];for(let r of t){if(r.indexOf("//")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new e(n)}static emptyPath(){return new e([])}},ah=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class e extends Hn{construct(t,n,r){return new e(t,n,r)}static isValidIdentifier(t){return ah.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new e(["__name__"])}static fromServerFormat(t){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new v(f.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new v(f.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new v(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new v(f.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}static emptyPath(){return new e([])}};var A=class e{constructor(t){this.path=t}static fromPath(t){return new e(Q.fromString(t))}static fromName(t){return new e(Q.fromString(t).popFirst(5))}static empty(){return new e(Q.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Q.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return Q.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new e(new Q(t.slice()))}};var Oi=class{constructor(t,n,r,i){this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}};Oi.UNKNOWN_ID=-1;function ch(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=N.fromTimestamp(r===1e9?new nt(n+1,0):new nt(n,r));return new zt(i,A.empty(),t)}function uh(e){return new zt(e.readTime,e.key,-1)}var zt=class e{constructor(t,n,r){this.readTime=t,this.documentKey=n,this.largestBatchId=r}static min(){return new e(N.min(),A.empty(),-1)}static max(){return new e(N.max(),A.empty(),-1)}};function lh(e,t){let n=e.readTime.compareTo(t.readTime);return n!==0?n:(n=A.comparator(e.documentKey,t.documentKey),n!==0?n:x(e.largestBatchId,t.largestBatchId))}var hh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Mi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Sc(e){return _(this,null,function*(){if(e.code!==f.FAILED_PRECONDITION||e.message!==hh)throw e;g("LocalStore","Unexpectedly lost primary lease")})}var d=class e{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(t){return this.next(void 0,t)}next(t,n){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((t,n)=>{this.next(t,n)})}wrapUserFunction(t){try{let n=t();return n instanceof e?n:e.resolve(n)}catch(n){return e.reject(n)}}wrapSuccess(t,n){return t?this.wrapUserFunction(()=>t(n)):e.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction(()=>t(n)):e.reject(n)}static resolve(t){return new e((n,r)=>{n(t)})}static reject(t){return new e((n,r)=>{r(t)})}static waitFor(t){return new e((n,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(t){let n=e.resolve(!1);for(let r of t)n=n.next(i=>i?e.resolve(i):r());return n}static forEach(t,n){let r=[];return t.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(t,n){return new e((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;n(t[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,n){return new e((r,i)=>{let s=()=>{t()===!0?n().next(()=>{s()},i):r()};s()})}};var Li=class e{constructor(t,n){this.action=t,this.transaction=n,this.aborted=!1,this.V=new lt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new Ft(t,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=$s(r.target.error);this.V.reject(new Ft(t,i))}}static open(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(s){throw new Ft(n,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(g("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let n=this.transaction.objectStore(t);return new Bi(n)}},Yn=class e{constructor(t,n,r){this.name=t,this.version=n,this.p=r,e.S(Re())===12.2&&At("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return g("SimpleDb","Removing database:",t),Mt(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!mn())return!1;if(e.C())return!0;let t=Re(),n=e.S(t),r=0<n&&n<10,i=e.v(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,n){return t.store(n)}static S(t){let n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return _(this,null,function*(){return this.db||(g("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;n(o)},i.onblocked=()=>{r(new Ft(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new v(f.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new v(f.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ft(t,o))},i.onupgradeneeded=s=>{g("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{g("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db})}L(t){this.B=t,this.db&&(this.db.onversionchange=n=>t(n))}runTransaction(t,n,r,i){return _(this,null,function*(){let s=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=Li.open(this.db,t,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),d.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(g("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Fi=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Mt(this.k.delete())}},Ft=class extends v{constructor(t,n){super(f.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function ur(e){return e.name==="IndexedDbTransactionError"}var Bi=class{constructor(t){this.store=t}put(t,n){let r;return n!==void 0?(g("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(g("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Mt(r)}add(t){return g("SimpleDb","ADD",this.store.name,t,t),Mt(this.store.add(t))}get(t){return Mt(this.store.get(t)).next(n=>(n===void 0&&(n=null),g("SimpleDb","GET",this.store.name,t,n),n))}delete(t){return g("SimpleDb","DELETE",this.store.name,t),Mt(this.store.delete(t))}count(){return g("SimpleDb","COUNT",this.store.name),Mt(this.store.count())}W(t,n){let r=this.options(t,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new d((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(t,n){let r=this.store.getAll(t,n===null?void 0:n);return new d((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(t,n){g("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,n);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(t,n){let r;n?r=t:(r={},n=t);let i=this.cursor(r);return this.G(i,n)}Z(t){let n=this.cursor({});return new d((r,i)=>{n.onerror=s=>{let o=$s(s.target.error);i(o)},n.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,n){let r=[];return new d((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new Fi(a),u=n(a.primaryKey,a.value,c);if(u instanceof d){let l=u.catch(h=>(c.done(),d.reject(h)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>d.waitFor(r))}options(t,n){let r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}}cursor(t){let n="next";if(t.reverse&&(n="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)}};function Mt(e){return new d((t,n)=>{e.onsuccess=r=>{let i=r.target.result;t(i)},e.onerror=r=>{let i=$s(r.target.error);n(i)}})}var uc=!1;function $s(e){let t=Yn.S(Re());if(t>=12.2&&t<13){let n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){let r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uc||(uc=!0,setTimeout(()=>{throw r},0)),r}}return e}var dh=(()=>{class e{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return e._e=-1,e})();function Ks(e){return e==null}function Xn(e){return e===0&&1/e==-1/0}var fh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],pf=[...fh,"documentOverlays"],mh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],gh=mh,_f=[...gh,"indexConfiguration","indexState","indexEntries"];function lc(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function lr(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ph(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Z=class e{constructor(t,n){this.comparator=t,this.root=n||ht.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ht.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ht.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(t){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((n,r)=>(t(n,r),!1))}toString(){let t=[];return this.inorderTraversal((n,r)=>(t.push(`${n}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new re(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new re(this.root,t,this.comparator,!1)}getReverseIterator(){return new re(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new re(this.root,t,this.comparator,!0)}},re=class{constructor(t,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=n?r(t.key,n):1,n&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ht=class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=s??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw E();let t=this.left.check();if(t!==this.right.check())throw E();return t+(this.isRed()?0:1)}};ht.EMPTY=null,ht.RED=!0,ht.BLACK=!1;ht.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(t,n,r,i,s){return this}insert(t,n,r){return new ht(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var X=class e{constructor(t){this.comparator=t,this.data=new Z(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((n,r)=>(t(n),!1))}forEachInRange(t,n){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}}forEachWhile(t,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new Jn(this.data.getIterator())}getIteratorFrom(t){return new Jn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach(r=>{n=n.add(r)}),n}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(n=>{t.push(n)}),t}toString(){let t=[];return this.forEach(n=>t.push(n)),"SortedSet("+t.toString()+")"}copy(t){let n=new e(this.comparator);return n.data=t,n}},Jn=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Tt=class e{constructor(t){this.fields=t,t.sort(st.comparator)}static empty(){return new e([])}unionWith(t){let n=new X(st.comparator);for(let r of this.fields)n=n.add(r);for(let r of t)n=n.add(r);return new e(n.toArray())}covers(t){for(let n of this.fields)if(n.isPrefixOf(t))return!0;return!1}isEqual(t){return se(this.fields,t.fields,(n,r)=>n.isEqual(r))}};var qi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var oe=class e{constructor(t){this.binaryString=t}static fromBase64String(t){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new qi("Invalid base64 string: "+s):s}}(t);return new e(n)}static fromUint8Array(t){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new e(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return x(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};oe.EMPTY_BYTE_STRING=new oe("");var _h=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jt(e){if(q(!!e),typeof e=="string"){let t=0,n=_h.exec(e);if(q(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:M(e.seconds),nanos:M(e.nanos)}}function M(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function ae(e){return typeof e=="string"?oe.fromBase64String(e):oe.fromUint8Array(e)}function Qs(e){var t,n;return((n=(((t=e?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function bc(e){let t=e.mapValue.fields.__previous_value__;return Qs(t)?bc(t):t}function Zn(e){let t=jt(e.mapValue.fields.__local_write_time__.timestampValue);return new nt(t.seconds,t.nanos)}var Ui=class{constructor(t,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},zi=class e{constructor(t,n){this.projectId=t,this.database=n||"(default)"}static empty(){return new e("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}};var Gn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ce(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Qs(e)?4:Rc(e)?9007199254740991:10:E()}function dt(e,t){if(e===t)return!0;let n=ce(e);if(n!==ce(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Zn(e).isEqual(Zn(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=jt(i.timestampValue),a=jt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(i,s){return ae(i.bytesValue).isEqual(ae(s.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(i,s){return M(i.geoPointValue.latitude)===M(s.geoPointValue.latitude)&&M(i.geoPointValue.longitude)===M(s.geoPointValue.longitude)}(e,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return M(i.integerValue)===M(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=M(i.doubleValue),a=M(s.doubleValue);return o===a?Xn(o)===Xn(a):isNaN(o)&&isNaN(a)}return!1}(e,t);case 9:return se(e.arrayValue.values||[],t.arrayValue.values||[],dt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(lc(o)!==lc(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!dt(o[c],a[c])))return!1;return!0}(e,t);default:return E()}}function on(e,t){return(e.values||[]).find(n=>dt(n,t))!==void 0}function ue(e,t){if(e===t)return 0;let n=ce(e),r=ce(t);if(n!==r)return x(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return x(e.booleanValue,t.booleanValue);case 2:return function(s,o){let a=M(s.integerValue||s.doubleValue),c=M(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(e,t);case 3:return hc(e.timestampValue,t.timestampValue);case 4:return hc(Zn(e),Zn(t));case 5:return x(e.stringValue,t.stringValue);case 6:return function(s,o){let a=ae(s),c=ae(o);return a.compareTo(c)}(e.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=x(a[u],c[u]);if(l!==0)return l}return x(a.length,c.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,o){let a=x(M(s.latitude),M(o.latitude));return a!==0?a:x(M(s.longitude),M(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=ue(a[u],c[u]);if(l)return l}return x(a.length,c.length)}(e.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Gn.mapValue&&o===Gn.mapValue)return 0;if(s===Gn.mapValue)return 1;if(o===Gn.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){let p=x(c[h],l[h]);if(p!==0)return p;let y=ue(a[c[h]],u[l[h]]);if(y!==0)return y}return x(c.length,l.length)}(e.mapValue,t.mapValue);default:throw E()}}function hc(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return x(e,t);let n=jt(e),r=jt(t),i=x(n.seconds,r.seconds);return i!==0?i:x(n.nanos,r.nanos)}function le(e){return ji(e)}function ji(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(n){let r=jt(n);return`time(${r.seconds},${r.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(n){return ae(n).toBase64()}(e.bytesValue):"referenceValue"in e?function(n){return A.fromName(n).toString()}(e.referenceValue):"geoPointValue"in e?function(n){return`geo(${n.latitude},${n.longitude})`}(e.geoPointValue):"arrayValue"in e?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=ji(s);return r+"]"}(e.arrayValue):"mapValue"in e?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${ji(n.fields[o])}`;return i+"}"}(e.mapValue):E()}function Gi(e){return!!e&&"integerValue"in e}function Ws(e){return!!e&&"arrayValue"in e}function Qn(e){return!!e&&"mapValue"in e}function en(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return lr(e.mapValue.fields,(n,r)=>t.mapValue.fields[n]=en(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=en(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Rc(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var _t=class e{constructor(t){this.value=t}static empty(){return new e({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let n=this.value;for(let r=0;r<t.length-1;++r)if(n=(n.mapValue.fields||{})[t.get(r)],!Qn(n))return null;return n=(n.mapValue.fields||{})[t.lastSegment()],n||null}}set(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=en(n)}setAll(t){let n=st.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=en(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(t){let n=this.field(t.popLast());Qn(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]}isEqual(t){return dt(this.value,t.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=n.mapValue.fields[t.get(r)];Qn(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(t,n,r){lr(n,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new e(en(this.value))}};function Pc(e){let t=[];return lr(e.fields,(n,r)=>{let i=new st([n]);if(Qn(r)){let s=Pc(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new Tt(t)}var he=class e{constructor(t,n,r,i,s,o,a){this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new e(t,0,N.min(),N.min(),N.min(),_t.empty(),0)}static newFoundDocument(t,n,r,i){return new e(t,1,n,N.min(),r,i,0)}static newNoDocument(t,n){return new e(t,2,n,N.min(),N.min(),_t.empty(),0)}static newUnknownDocument(t,n){return new e(t,3,n,N.min(),N.min(),_t.empty(),2)}convertToFoundDocument(t,n){return!this.createTime.isEqual(N.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=N.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var de=class{constructor(t,n){this.position=t,this.inclusive=n}};function dc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(s.field.isKeyField()?r=A.comparator(A.fromName(o.referenceValue),n.key):r=ue(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function fc(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!dt(e.position[n],t.position[n]))return!1;return!0}var fe=class{constructor(t,n="asc"){this.field=t,this.dir=n}};function yh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var tr=class{},B=class e extends tr{constructor(t,n,r){super(),this.field=t,this.op=n,this.value=r}static create(t,n,r){return t.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(t,n,r):new Ki(t,n,r):n==="array-contains"?new Hi(t,r):n==="in"?new Yi(t,r):n==="not-in"?new Xi(t,r):n==="array-contains-any"?new Ji(t,r):new e(t,n,r)}static createKeyFieldInFilter(t,n,r){return n==="in"?new Qi(t,r):new Wi(t,r)}matches(t){let n=t.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(ue(n,this.value)):n!==null&&ce(this.value)===ce(n)&&this.matchesComparison(ue(n,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},St=class e extends tr{constructor(t,n){super(),this.filters=t,this.op=n,this.ue=null}static create(t,n){return new e(t,n)}matches(t){return Cc(this)?this.filters.find(n=>!n.matches(t))===void 0:this.filters.find(n=>n.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,n)=>t.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Cc(e){return e.op==="and"}function xc(e){return wh(e)&&Cc(e)}function wh(e){for(let t of e.filters)if(t instanceof St)return!1;return!0}function $i(e){if(e instanceof B)return e.field.canonicalString()+e.op.toString()+le(e.value);if(xc(e))return e.filters.map(t=>$i(t)).join(",");{let t=e.filters.map(n=>$i(n)).join(",");return`${e.op}(${t})`}}function Dc(e,t){return e instanceof B?function(r,i){return i instanceof B&&r.op===i.op&&r.field.isEqual(i.field)&&dt(r.value,i.value)}(e,t):e instanceof St?function(r,i){return i instanceof St&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Dc(o,i.filters[a]),!0):!1}(e,t):void E()}function Vc(e){return e instanceof B?function(n){return`${n.field.canonicalString()} ${n.op} ${le(n.value)}`}(e):e instanceof St?function(n){return n.op.toString()+" {"+n.getFilters().map(Vc).join(" ,")+"}"}(e):"Filter"}var Ki=class extends B{constructor(t,n,r){super(t,n,r),this.key=A.fromName(r.referenceValue)}matches(t){let n=A.comparator(t.key,this.key);return this.matchesComparison(n)}},Qi=class extends B{constructor(t,n){super(t,"in",n),this.keys=Nc("in",n)}matches(t){return this.keys.some(n=>n.isEqual(t.key))}},Wi=class extends B{constructor(t,n){super(t,"not-in",n),this.keys=Nc("not-in",n)}matches(t){return!this.keys.some(n=>n.isEqual(t.key))}};function Nc(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>A.fromName(r.referenceValue))}var Hi=class extends B{constructor(t,n){super(t,"array-contains",n)}matches(t){let n=t.data.field(this.field);return Ws(n)&&on(n.arrayValue,this.value)}},Yi=class extends B{constructor(t,n){super(t,"in",n)}matches(t){let n=t.data.field(this.field);return n!==null&&on(this.value.arrayValue,n)}},Xi=class extends B{constructor(t,n){super(t,"not-in",n)}matches(t){if(on(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=t.data.field(this.field);return n!==null&&!on(this.value.arrayValue,n)}},Ji=class extends B{constructor(t,n){super(t,"array-contains-any",n)}matches(t){let n=t.data.field(this.field);return!(!Ws(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>on(this.value.arrayValue,r))}};var Zi=class{constructor(t,n=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function mc(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Zi(e,t,n,r,i,s,o)}function Hs(e){let t=C(e);if(t.ce===null){let n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(r=>$i(r)).join(","),n+="|ob:",n+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Ks(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>le(r)).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>le(r)).join(",")),t.ce=n}return t.ce}function Ys(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!yh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Dc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!fc(e.startAt,t.startAt)&&fc(e.endAt,t.endAt)}var an=class{constructor(t,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function vh(e,t,n,r,i,s,o,a){return new an(e,t,n,r,i,s,o,a)}function gc(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function Eh(e){return e.collectionGroup!==null}function nn(e){let t=C(e);if(t.le===null){t.le=[];let n=new Set;for(let s of t.explicitOrderBy)t.le.push(s),n.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new X(st.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(t).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||t.le.push(new fe(s,r))}),n.has(st.keyField().canonicalString())||t.le.push(new fe(st.keyField(),r))}return t.le}function Bt(e){let t=C(e);return t.he||(t.he=Ih(t,nn(e))),t.he}function Ih(e,t){if(e.limitType==="F")return mc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fe(i.field,s)});let n=e.endAt?new de(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new de(e.startAt.position,e.startAt.inclusive):null;return mc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ts(e,t,n){return new an(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function kc(e,t){return Ys(Bt(e),Bt(t))&&e.limitType===t.limitType}function Oc(e){return`${Hs(Bt(e))}|lt:${e.limitType}`}function tn(e){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>Vc(i)).join(", ")}]`),Ks(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>le(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>le(i)).join(",")),`Target(${r})`}(Bt(e))}; limitType=${e.limitType})`}function Xs(e,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):A.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(e,t)&&function(r,i){for(let s of nn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(e,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(e,t)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=dc(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,nn(r),i)||r.endAt&&!function(o,a,c){let u=dc(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,nn(r),i))}(e,t)}function Th(e){return(t,n)=>{let r=!1;for(let i of nn(e)){let s=Ah(i,t,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Ah(e,t,n){let r=e.field.isKeyField()?A.comparator(t.key,n.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?ue(c,u):E()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}var bt=class{constructor(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}get(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,n){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,n]);i.push([t,n]),this.innerSize++}delete(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){lr(this.inner,(n,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return ph(this.inner)}size(){return this.innerSize}};var Sh=new Z(A.comparator);function er(){return Sh}var Mc=new Z(A.comparator);function $n(...e){let t=Mc;for(let n of e)t=t.insert(n.key,n);return t}function Lc(e){let t=Mc;return e.forEach((n,r)=>t=t.insert(n,r.overlayedDocument)),t}function Lt(){return rn()}function Fc(){return rn()}function rn(){return new bt(e=>e.toString(),(e,t)=>e.isEqual(t))}var bh=new Z(A.comparator),Rh=new X(A.comparator);function W(...e){let t=Rh;for(let n of e)t=t.add(n);return t}var Ph=new X(x);function Ch(){return Ph}function xh(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xn(t)?"-0":t}}function Dh(e){return{integerValue:""+e}}var me=class{constructor(){this._=void 0}};function Vh(e,t,n){return e instanceof ge?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Qs(s)&&(s=bc(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,t):e instanceof Gt?qc(e,t):e instanceof $t?Uc(e,t):function(i,s){let o=Bc(i,s),a=pc(o)+pc(i.Ie);return Gi(o)&&Gi(i.Ie)?Dh(a):xh(i.serializer,a)}(e,t)}function Nh(e,t,n){return e instanceof Gt?qc(e,t):e instanceof $t?Uc(e,t):n}function Bc(e,t){return e instanceof pe?function(r){return Gi(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var ge=class extends me{},Gt=class extends me{constructor(t){super(),this.elements=t}};function qc(e,t){let n=zc(t);for(let r of e.elements)n.some(i=>dt(i,r))||n.push(r);return{arrayValue:{values:n}}}var $t=class extends me{constructor(t){super(),this.elements=t}};function Uc(e,t){let n=zc(t);for(let r of e.elements)n=n.filter(i=>!dt(i,r));return{arrayValue:{values:n}}}var pe=class extends me{constructor(t,n){super(),this.serializer=t,this.Ie=n}};function pc(e){return M(e.integerValue||e.doubleValue)}function zc(e){return Ws(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}function kh(e,t){return e.field.isEqual(t.field)&&function(r,i){return r instanceof Gt&&i instanceof Gt||r instanceof $t&&i instanceof $t?se(r.elements,i.elements,dt):r instanceof pe&&i instanceof pe?dt(r.Ie,i.Ie):r instanceof ge&&i instanceof ge}(e.transform,t.transform)}var es=class{constructor(t,n){this.version=t,this.transformResults=n}},qt=class e{constructor(t,n){this.updateTime=t,this.exists=n}static none(){return new e}static exists(t){return new e(void 0,t)}static updateTime(t){return new e(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Wn(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var _e=class{};function jc(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new cn(e.key,qt.none()):new ye(e.key,e.data,qt.none());{let n=e.data,r=_t.empty(),i=new X(st.comparator);for(let s of t.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Rt(e.key,r,new Tt(i.toArray()),qt.none())}}function Oh(e,t,n){e instanceof ye?function(i,s,o){let a=i.value.clone(),c=yc(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(e,t,n):e instanceof Rt?function(i,s,o){if(!Wn(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=yc(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(Gc(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(e,t,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function sn(e,t,n,r){return e instanceof ye?function(s,o,a,c){if(!Wn(s.precondition,o))return a;let u=s.value.clone(),l=wc(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(e,t,n,r):e instanceof Rt?function(s,o,a,c){if(!Wn(s.precondition,o))return a;let u=wc(s.fieldTransforms,c,o),l=o.data;return l.setAll(Gc(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(e,t,n,r):function(s,o,a){return Wn(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(e,t,n)}function Mh(e,t){let n=null;for(let r of e.fieldTransforms){let i=t.data.field(r.field),s=Bc(r.transform,i||null);s!=null&&(n===null&&(n=_t.empty()),n.set(r.field,s))}return n||null}function _c(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&se(r,i,(s,o)=>kh(s,o))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var ye=class extends _e{constructor(t,n,r,i=[]){super(),this.key=t,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Rt=class extends _e{constructor(t,n,r,i,s=[]){super(),this.key=t,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Gc(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function yc(e,t,n){let r=new Map;q(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Nh(o,a,n[i]))}return r}function wc(e,t,n){let r=new Map;for(let i of e){let s=i.transform,o=n.data.field(i.field);r.set(i.field,Vh(s,o,t))}return r}var cn=class extends _e{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ns=class extends _e{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var rs=class{constructor(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Oh(s,t,r[i])}}applyToLocalView(t,n){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(n=sn(r,t,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(n=sn(r,t,n,this.localWriteTime));return n}applyToLocalDocumentSet(t,n){let r=Fc();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let c=jc(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(N.min())}),r}keys(){return this.mutations.reduce((t,n)=>t.add(n.key),W())}isEqual(t){return this.batchId===t.batchId&&se(this.mutations,t.mutations,(n,r)=>_c(n,r))&&se(this.baseMutations,t.baseMutations,(n,r)=>_c(n,r))}},is=class e{constructor(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(t,n,r){q(t.mutations.length===r.length);let i=function(){return bh}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new e(t,n,r,i)}};var ss=class{constructor(t,n){this.largestBatchId=t,this.mutation=n}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var k,I;function Lh(e){switch(e){default:return E();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function Fh(e){if(e===void 0)return At("GRPC error has no .code"),f.UNKNOWN;switch(e){case k.OK:return f.OK;case k.CANCELLED:return f.CANCELLED;case k.UNKNOWN:return f.UNKNOWN;case k.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case k.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case k.INTERNAL:return f.INTERNAL;case k.UNAVAILABLE:return f.UNAVAILABLE;case k.UNAUTHENTICATED:return f.UNAUTHENTICATED;case k.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case k.NOT_FOUND:return f.NOT_FOUND;case k.ALREADY_EXISTS:return f.ALREADY_EXISTS;case k.PERMISSION_DENIED:return f.PERMISSION_DENIED;case k.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case k.ABORTED:return f.ABORTED;case k.OUT_OF_RANGE:return f.OUT_OF_RANGE;case k.UNIMPLEMENTED:return f.UNIMPLEMENTED;case k.DATA_LOSS:return f.DATA_LOSS;default:return E()}}(I=k||(k={}))[I.OK=0]="OK",I[I.CANCELLED=1]="CANCELLED",I[I.UNKNOWN=2]="UNKNOWN",I[I.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",I[I.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",I[I.NOT_FOUND=5]="NOT_FOUND",I[I.ALREADY_EXISTS=6]="ALREADY_EXISTS",I[I.PERMISSION_DENIED=7]="PERMISSION_DENIED",I[I.UNAUTHENTICATED=16]="UNAUTHENTICATED",I[I.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",I[I.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",I[I.ABORTED=10]="ABORTED",I[I.OUT_OF_RANGE=11]="OUT_OF_RANGE",I[I.UNIMPLEMENTED=12]="UNIMPLEMENTED",I[I.INTERNAL=13]="INTERNAL",I[I.UNAVAILABLE=14]="UNAVAILABLE",I[I.DATA_LOSS=15]="DATA_LOSS";var wf=new ac([4294967295,4294967295],0);var os=class{constructor(t,n){this.databaseId=t,this.useProto3Json=n}};function Bh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function qh(e,t){return Bh(e,t.toTimestamp())}function ie(e){return q(!!e),N.fromTimestamp(function(n){let r=jt(n);return new nt(r.seconds,r.nanos)}(e))}function Uh(e,t){return as(e,t).canonicalString()}function as(e,t){let n=function(i){return new Q(["projects",i.projectId,"databases",i.database])}(e).child("documents");return t===void 0?n:n.child(t)}function zh(e){let t=Q.fromString(e);return q(Yh(t)),t}function cs(e,t){return Uh(e.databaseId,t.path)}function jh(e){let t=zh(e);return t.length===4?Q.emptyPath():$h(t)}function Gh(e){return new Q(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function $h(e){return q(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function vc(e,t,n){return{name:cs(e,t),fields:n.value.mapValue.fields}}function Kh(e,t){let n;if(t instanceof ye)n={update:vc(e,t.key,t.value)};else if(t instanceof cn)n={delete:cs(e,t.key)};else if(t instanceof Rt)n={update:vc(e,t.key,t.data),updateMask:Hh(t.fieldMask)};else{if(!(t instanceof ns))return E();n={verify:cs(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof ge)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Gt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof $t)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof pe)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw E()}(0,r))),t.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:qh(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:E()}(e,t.precondition)),n}function Qh(e,t){return e&&e.length>0?(q(t!==void 0),e.map(n=>function(i,s){let o=i.updateTime?ie(i.updateTime):ie(s);return o.isEqual(N.min())&&(o=ie(s)),new es(o,i.transformResults||[])}(n,t))):[]}function Wh(e){let t=jh(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){q(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];n.where&&(s=function(h){let p=$c(h);return p instanceof St&&xc(p)?p.getFilters():[p]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(p=>function(S){return new fe(ne(S.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(p))}(n.orderBy));let a=null;n.limit&&(a=function(h){let p;return p=typeof h=="object"?h.value:h,Ks(p)?null:p}(n.limit));let c=null;n.startAt&&(c=function(h){let p=!!h.before,y=h.values||[];return new de(y,p)}(n.startAt));let u=null;return n.endAt&&(u=function(h){let p=!h.before,y=h.values||[];return new de(y,p)}(n.endAt)),vh(t,i,o,s,a,"F",c,u)}function $c(e){return e.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=ne(n.unaryFilter.field);return B.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ne(n.unaryFilter.field);return B.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ne(n.unaryFilter.field);return B.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ne(n.unaryFilter.field);return B.create(o,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(e):e.fieldFilter!==void 0?function(n){return B.create(ne(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(n.fieldFilter.op),n.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(n){return St.create(n.compositeFilter.filters.map(r=>$c(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return E()}}(n.compositeFilter.op))}(e):E()}function ne(e){return st.fromServerFormat(e.fieldPath)}function Hh(e){let t=[];return e.fields.forEach(n=>t.push(n.canonicalString())),{fieldPaths:t}}function Yh(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}var us=class{constructor(t){this.ct=t}};function Xh(e){let t=Wh({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?ts(t,t.limit,"L"):t}var nr=class{constructor(){}Pt(t,n){this.It(t,n),n.Tt()}It(t,n){if("nullValue"in t)this.Et(n,5);else if("booleanValue"in t)this.Et(n,10),n.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(n,15),n.dt(M(t.integerValue));else if("doubleValue"in t){let r=M(t.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),Xn(r)?n.dt(0):n.dt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Et(n,20),typeof r=="string"?n.At(r):(n.At(`${r.seconds||""}`),n.dt(r.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,n),this.Vt(n);else if("bytesValue"in t)this.Et(n,30),n.ft(ae(t.bytesValue)),this.Vt(n);else if("referenceValue"in t)this.gt(t.referenceValue,n);else if("geoPointValue"in t){let r=t.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in t?Rc(t)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,n),this.Vt(n)):"arrayValue"in t?(this.wt(t.arrayValue,n),this.Vt(n)):E()}Rt(t,n){this.Et(n,25),this.St(t,n)}St(t,n){n.At(t)}yt(t,n){let r=t.fields||{};this.Et(n,55);for(let i of Object.keys(r))this.Rt(i,n),this.It(r[i],n)}wt(t,n){let r=t.values||[];this.Et(n,50);for(let i of r)this.It(i,n)}gt(t,n){this.Et(n,37),A.fromName(t).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(t,n){t.dt(n)}Vt(t){t.dt(2)}};nr.bt=new nr;var ls=class{constructor(){this._n=new hs}addToCollectionParentIndex(t,n){return this._n.add(n),d.resolve()}getCollectionParents(t,n){return d.resolve(this._n.getEntries(n))}addFieldIndex(t,n){return d.resolve()}deleteFieldIndex(t,n){return d.resolve()}deleteAllFieldIndexes(t){return d.resolve()}createTargetIndexes(t,n){return d.resolve()}getDocumentsMatchingTarget(t,n){return d.resolve(null)}getIndexType(t,n){return d.resolve(0)}getFieldIndexes(t,n){return d.resolve([])}getNextCollectionGroupToUpdate(t){return d.resolve(null)}getMinOffset(t,n){return d.resolve(zt.min())}getMinOffsetFromCollectionGroup(t,n){return d.resolve(zt.min())}updateCollectionGroup(t,n,r){return d.resolve()}updateIndexEntries(t,n){return d.resolve()}},hs=class{constructor(){this.index={}}add(t){let n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new X(Q.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(t){let n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(t){return(this.index[t]||new X(Q.comparator)).toArray()}};var vf=new Uint8Array(0);var ut=class e{constructor(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};ut.DEFAULT_COLLECTION_PERCENTILE=10,ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ut.DEFAULT=new ut(41943040,ut.DEFAULT_COLLECTION_PERCENTILE,ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ut.DISABLED=new ut(-1,0,0);var un=class e{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new e(0)}static Bn(){return new e(-1)}};var ds=class{constructor(){this.changes=new bt(t=>t.toString(),(t,n)=>t.isEqual(n)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,n){this.assertNotApplied(),this.changes.set(t,he.newInvalidDocument(t).setReadTime(n))}getEntry(t,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?d.resolve(r):this.getFromCache(t,n)}getEntries(t,n){return this.getAllFromCache(t,n)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var fs=class{constructor(t,n){this.overlayedDocument=t,this.mutatedFields=n}};var ms=class{constructor(t,n,r,i){this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,n))).next(i=>(r!==null&&sn(r.mutation,i,Tt.empty(),nt.now()),i))}getDocuments(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.getLocalViewOfDocuments(t,r,W()).next(()=>r))}getLocalViewOfDocuments(t,n,r=W()){let i=Lt();return this.populateOverlays(t,i,n).next(()=>this.computeViews(t,n,i,r).next(s=>{let o=$n();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,n){let r=Lt();return this.populateOverlays(t,r,n).next(()=>this.computeViews(t,n,r,W()))}populateOverlays(t,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(t,n,r,i){let s=er(),o=rn(),a=function(){return rn()}();return n.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof Rt)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),sn(l.mutation,u,l.mutation.getFieldMask(),nt.now())):o.set(u.key,Tt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),n.forEach((u,l)=>{var h;return a.set(u,new fs(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,n){let r=rn(),i=new Z((o,a)=>o-a),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,n).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=n.get(c);if(u===null)return;let l=r.get(c)||Tt.empty();l=a.applyToLocalView(u,l),r.set(c,l);let h=(i.get(a.batchId)||W()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,h=Fc();l.forEach(p=>{if(!s.has(p)){let y=jc(n.get(p),r.get(p));y!==null&&h.set(p,y),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(t,u,h))}return d.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,n,r,i){return function(o){return A.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(t,n.path):Eh(n)?this.getDocumentsMatchingCollectionGroupQuery(t,n,r,i):this.getDocumentsMatchingCollectionQuery(t,n,r,i)}getNextDocuments(t,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,n,r.largestBatchId,i-s.size):d.resolve(Lt()),a=-1,c=s;return o.next(u=>d.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?d.resolve():this.remoteDocumentCache.getEntry(t,l).next(p=>{c=c.insert(l,p)}))).next(()=>this.populateOverlays(t,u,s)).next(()=>this.computeViews(t,c,u,W())).next(l=>({batchId:a,changes:Lc(l)})))})}getDocumentsMatchingDocumentQuery(t,n){return this.getDocument(t,new A(n)).next(r=>{let i=$n();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,n,r,i){let s=n.collectionGroup,o=$n();return this.indexManager.getCollectionParents(t,s).next(a=>d.forEach(a,c=>{let u=function(h,p){return new an(p,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,u,r,i).next(l=>{l.forEach((h,p)=>{o=o.insert(h,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,he.newInvalidDocument(l)))});let a=$n();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&sn(l.mutation,u,Tt.empty(),nt.now()),Xs(n,u)&&(a=a.insert(c,u))}),a})}};var gs=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,n){return d.resolve(this.cr.get(n))}saveBundleMetadata(t,n){return this.cr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:ie(i.createTime)}}(n)),d.resolve()}getNamedQuery(t,n){return d.resolve(this.lr.get(n))}saveNamedQuery(t,n){return this.lr.set(n.name,function(i){return{name:i.name,query:Xh(i.bundledQuery),readTime:ie(i.readTime)}}(n)),d.resolve()}};var ps=class{constructor(){this.overlays=new Z(A.comparator),this.hr=new Map}getOverlay(t,n){return d.resolve(this.overlays.get(n))}getOverlays(t,n){let r=Lt();return d.forEach(n,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,n,r){return r.forEach((i,s)=>{this.ht(t,n,s)}),d.resolve()}removeOverlaysForBatchId(t,n,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),d.resolve()}getOverlaysForCollection(t,n,r){let i=Lt(),s=n.length+1,o=new A(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return d.resolve(i)}getOverlaysForCollectionGroup(t,n,r,i){let s=new Z((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=Lt(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=Lt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return d.resolve(a)}ht(t,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ss(n,r));let s=this.hr.get(n);s===void 0&&(s=W(),this.hr.set(n,s)),this.hr.set(n,s.add(r.key))}};var ln=class{constructor(){this.Pr=new X(O.Ir),this.Tr=new X(O.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,n){let r=new O(t,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,n){t.forEach(r=>this.addReference(r,n))}removeReference(t,n){this.Ar(new O(t,n))}Rr(t,n){t.forEach(r=>this.removeReference(r,n))}Vr(t){let n=new A(new Q([])),r=new O(n,t),i=new O(n,t+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let n=new A(new Q([])),r=new O(n,t),i=new O(n,t+1),s=W();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let n=new O(t,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)}},O=class{constructor(t,n){this.key=t,this.pr=n}static Ir(t,n){return A.comparator(t.key,n.key)||x(t.pr,n.pr)}static Er(t,n){return x(t.pr,n.pr)||A.comparator(t.key,n.key)}};var _s=class{constructor(t,n){this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new X(O.Ir)}checkEmpty(t){return d.resolve(this.mutationQueue.length===0)}addMutationBatch(t,n,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new rs(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new O(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return d.resolve(o)}lookupMutationBatch(t,n){return d.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(t,n){let r=n+1,i=this.br(r),s=i<0?0:i;return d.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return d.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return d.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,n){let r=new O(n,0),i=new O(n,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),d.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,n){let r=new X(x);return n.forEach(i=>{let s=new O(i,0),o=new O(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),d.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,n){let r=n.path,i=r.length+1,s=r;A.isDocumentKey(s)||(s=s.child(""));let o=new O(new A(s),0),a=new X(x);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.pr)),!0)},o),d.resolve(this.Dr(a))}Dr(t){let n=[];return t.forEach(r=>{let i=this.Sr(r);i!==null&&n.push(i)}),n}removeMutationBatch(t,n){q(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return d.forEach(n.mutations,i=>{let s=new O(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,n){let r=new O(n,0),i=this.wr.firstAfterOrEqual(r);return d.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,d.resolve()}Cr(t,n){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let n=this.br(t);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var ys=class{constructor(t){this.vr=t,this.docs=function(){return new Z(A.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)}getEntry(t,n){let r=this.docs.get(n);return d.resolve(r?r.document.mutableCopy():he.newInvalidDocument(n))}getEntries(t,n){let r=er();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():he.newInvalidDocument(i))}),d.resolve(r)}getDocumentsMatchingQuery(t,n,r,i){let s=er(),o=n.path,a=new A(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||lh(uh(l),r)<=0||(i.has(l.key)||Xs(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return d.resolve(s)}getAllFromCollectionGroup(t,n,r,i){E()}Fr(t,n){return d.forEach(this.docs,r=>n(r))}newChangeBuffer(t){return new ws(this)}getSize(t){return d.resolve(this.size)}},ws=class extends ds{constructor(t){super(),this.ar=t}applyChanges(t){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.ar.addEntry(t,i)):this.ar.removeEntry(r)}),d.waitFor(n)}getFromCache(t,n){return this.ar.getEntry(t,n)}getAllFromCache(t,n){return this.ar.getEntries(t,n)}};var vs=class{constructor(t){this.persistence=t,this.Mr=new bt(n=>Hs(n),Ys),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ln,this.targetCount=0,this.Br=un.Nn()}forEachTarget(t,n){return this.Mr.forEach((r,i)=>n(i)),d.resolve()}getLastRemoteSnapshotVersion(t){return d.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return d.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),d.resolve(this.highestTargetId)}setTargetsMetadata(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),d.resolve()}qn(t){this.Mr.set(t.target,t);let n=t.targetId;n>this.highestTargetId&&(this.Br=new un(n),this.highestTargetId=n),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,n){return this.qn(n),this.targetCount+=1,d.resolve()}updateTargetData(t,n){return this.qn(n),d.resolve()}removeTargetData(t,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,d.resolve()}removeTargets(t,n,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),d.waitFor(s).next(()=>i)}getTargetCount(t){return d.resolve(this.targetCount)}getTargetData(t,n){let r=this.Mr.get(n)||null;return d.resolve(r)}addMatchingKeys(t,n,r){return this.Nr.dr(n,r),d.resolve()}removeMatchingKeys(t,n,r){this.Nr.Rr(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),d.waitFor(s)}removeMatchingKeysForTargetId(t,n){return this.Nr.Vr(n),d.resolve()}getMatchingKeysForTargetId(t,n){let r=this.Nr.gr(n);return d.resolve(r)}containsKey(t,n){return d.resolve(this.Nr.containsKey(n))}};var Es=class{constructor(t,n){this.Lr={},this.overlays={},this.kr=new dh(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new vs(this),this.indexManager=new ls,this.remoteDocumentCache=function(i){return new ys(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new us(n),this.$r=new gs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let n=this.overlays[t.toKey()];return n||(n=new ps,this.overlays[t.toKey()]=n),n}getMutationQueue(t,n){let r=this.Lr[t.toKey()];return r||(r=new _s(n,this.referenceDelegate),this.Lr[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,n,r){g("MemoryPersistence","Starting transaction:",t);let i=new Is(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,n){return d.or(Object.values(this.Lr).map(r=>()=>r.containsKey(t,n)))}},Is=class extends Mi{constructor(t){super(),this.currentSequenceNumber=t}},Ts=class e{constructor(t){this.persistence=t,this.zr=new ln,this.jr=null}static Hr(t){return new e(t)}get Jr(){if(this.jr)return this.jr;throw E()}addReference(t,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),d.resolve()}removeReference(t,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),d.resolve()}markPotentiallyOrphaned(t,n){return this.Jr.add(n.toString()),d.resolve()}removeTarget(t,n){this.zr.Vr(n.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,n.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(t,n))}Ur(){this.jr=new Set}Wr(t){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return d.forEach(this.Jr,r=>{let i=A.fromPath(r);return this.Yr(t,i).next(s=>{s||n.removeEntry(i,N.min())})}).next(()=>(this.jr=null,n.apply(t)))}updateLimboDocument(t,n){return this.Yr(t,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(t){return 0}Yr(t,n){return d.or([()=>d.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(t,n),()=>this.persistence.Gr(t,n)])}};var As=class e{constructor(t,n,r,i){this.targetId=t,this.fromCache=n,this.qi=r,this.Qi=i}static Ki(t,n){let r=W(),i=W();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new e(t,n.fromCache,r,i)}};var Ss=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var bs=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Do()?8:Yn.v(Re())>0?6:4}()}initialize(t,n){this.zi=t,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(t,n,r,i){let s={result:null};return this.ji(t,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ss;return this.Ji(t,n,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,n,o,a.size)})}).next(()=>s.result)}Yi(t,n,r,i){return r.documentReadCount<this.Wi?(Ze()<=T.DEBUG&&g("QueryEngine","SDK will not create cache indexes for query:",tn(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),d.resolve()):(Ze()<=T.DEBUG&&g("QueryEngine","Query:",tn(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Ze()<=T.DEBUG&&g("QueryEngine","The SDK decides to create cache indexes for query:",tn(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Bt(n))):d.resolve())}ji(t,n){if(gc(n))return d.resolve(null);let r=Bt(n);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=ts(n,null,"F"),r=Bt(n)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=W(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(c=>{let u=this.Zi(n,a);return this.Xi(n,u,o,c.readTime)?this.ji(t,ts(n,null,"F")):this.es(t,u,n,c)}))})))}Hi(t,n,r,i){return gc(n)||i.isEqual(N.min())?d.resolve(null):this.zi.getDocuments(t,r).next(s=>{let o=this.Zi(n,s);return this.Xi(n,o,r,i)?d.resolve(null):(Ze()<=T.DEBUG&&g("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),tn(n)),this.es(t,o,n,ch(i,-1)).next(a=>a))})}Zi(t,n){let r=new X(Th(t));return n.forEach((i,s)=>{Xs(t,s)&&(r=r.add(s))}),r}Xi(t,n,r,i){if(t.limit===null)return!1;if(r.size!==n.size)return!0;let s=t.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,n,r){return Ze()<=T.DEBUG&&g("QueryEngine","Using full collection scan to execute query:",tn(n)),this.zi.getDocumentsMatchingQuery(t,n,zt.min(),r)}es(t,n,r,i){return this.zi.getDocumentsMatchingQuery(t,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Rs=class{constructor(t,n,r,i){this.persistence=t,this.ts=n,this.serializer=i,this.ns=new Z(x),this.rs=new bt(s=>Hs(s),Ys),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ms(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>t.collect(n,this.ns))}};function Jh(e,t,n,r){return new Rs(e,t,n,r)}function Kc(e,t){return _(this,null,function*(){let n=C(e);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n._s(t),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=W();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return n.localDocuments.getDocuments(r,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function Zh(e,t){let n=C(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let h=u.batch,p=h.keys(),y=d.resolve();return p.forEach(S=>{y=y.next(()=>l.getEntry(c,S)).next(D=>{let R=u.docVersions.get(S);q(R!==null),D.version.compareTo(R)<0&&(h.applyToRemoteDocument(D,u),D.isValidDocument()&&(D.setReadTime(u.commitVersion),l.addEntry(D)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(n,r,t,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=W();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(t))).next(()=>n.localDocuments.getDocuments(r,i))})}function td(e){let t=C(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",n=>t.Qr.getLastRemoteSnapshotVersion(n))}function ed(e,t){let n=C(e);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}var rr=class{constructor(){this.activeTargetIds=Ch()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Ps=class{constructor(){this.no=new rr,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,n,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,n,r){this.ro[t]=n}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new rr,Promise.resolve()}handleUserChange(t,n,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Cs=class{io(t){}shutdown(){}};var ir=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){g("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){g("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Kn=null;function Ti(){return Kn===null?Kn=function(){return 268435456+Math.round(2147483648*Math.random())}():Kn++,"0x"+Kn.toString(16)}var nd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var xs=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var $="WebChannelConnection",Ds=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(n,r,i,s,o){let a=Ti(),c=this.bo(n,r.toUriEncodedString());g("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(n,c,u,i).then(l=>(g("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw bi("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}vo(n,r,i,s,o,a){return this.So(n,r,i,s,o)}Do(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+we}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}bo(n,r){let i=nd[n];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,n,r,i){let s=Ti();return new Promise((o,a)=>{let c=new oc;c.setWithCredentials(!0),c.listenOnce(ic.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case jn.NO_ERROR:let l=c.getResponseJson();g($,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case jn.TIMEOUT:g($,`RPC '${t}' ${s} timed out`),a(new v(f.DEADLINE_EXCEEDED,"Request time out"));break;case jn.HTTP_ERROR:let h=c.getStatus();if(g($,`RPC '${t}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);let y=p?.error;if(y&&y.status&&y.message){let S=function(R){let H=R.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(H)>=0?H:f.UNKNOWN}(y.status);a(new v(S,y.message))}else a(new v(f.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new v(f.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{g($,`RPC '${t}' ${s} completed.`)}});let u=JSON.stringify(i);g($,`RPC '${t}' ${s} sending request:`,i),c.send(n,"POST",u,r,15)})}Fo(t,n,r){let i=Ti(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=nc(),a=rc(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;let l=s.join("");g($,`Creating RPC '${t}' stream ${i}: ${l}`,c);let h=o.createWebChannel(l,c),p=!1,y=!1,S=new xs({lo:R=>{y?g($,`Not sending because RPC '${t}' stream ${i} is closed:`,R):(p||(g($,`Opening RPC '${t}' stream ${i} transport.`),h.open(),p=!0),g($,`RPC '${t}' stream ${i} sending:`,R),h.send(R))},ho:()=>h.close()}),D=(R,H,tt)=>{R.listen(H,yt=>{try{tt(yt)}catch(Ct){setTimeout(()=>{throw Ct},0)}})};return D(h,Je.EventType.OPEN,()=>{y||g($,`RPC '${t}' stream ${i} transport opened.`)}),D(h,Je.EventType.CLOSE,()=>{y||(y=!0,g($,`RPC '${t}' stream ${i} transport closed`),S.Vo())}),D(h,Je.EventType.ERROR,R=>{y||(y=!0,bi($,`RPC '${t}' stream ${i} transport errored:`,R),S.Vo(new v(f.UNAVAILABLE,"The operation could not be completed")))}),D(h,Je.EventType.MESSAGE,R=>{var H;if(!y){let tt=R.data[0];q(!!tt);let yt=tt,Ct=yt.error||((H=yt[0])===null||H===void 0?void 0:H.error);if(Ct){g($,`RPC '${t}' stream ${i} received error:`,Ct);let Js=Ct.status,mr=function(iu){let to=k[iu];if(to!==void 0)return Fh(to)}(Js),Zs=Ct.message;mr===void 0&&(mr=f.INTERNAL,Zs="Unknown error status: "+Js+" with message "+Ct.message),y=!0,S.Vo(new v(mr,Zs)),h.close()}else g($,`RPC '${t}' stream ${i} received:`,tt),S.mo(tt)}}),D(a,sc.STAT_EVENT,R=>{R.stat===Ii.PROXY?g($,`RPC '${t}' stream ${i} detected buffering proxy`):R.stat===Ii.NOPROXY&&g($,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.Ro()},0),S}};function Ai(){return typeof document<"u"?document:null}function Qc(e){return new os(e,!0)}var sr=class{constructor(t,n,r=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,n-r);i>0&&g("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}};var Vs=class{constructor(t,n,r,i,s,o,a,c){this.oi=t,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new sr(t,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return _(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return _(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,n){return _(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():n&&n.code===f.RESOURCE_EXHAUSTED?(At(n.toString()),At("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===f.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===n&&this.o_(r,i)},r=>{t(()=>{let i=new v(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(t,n){let r=this.s_(this.Wo);this.stream=this.a_(t,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>_(this,null,function*(){this.state=0,this.start()}))}__(t){return g("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return n=>{this.oi.enqueueAndForget(()=>this.Wo===t?n():(g("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}};var Ns=class extends Vs{constructor(t,n,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,n){return this.connection.Fo("Write",t,n)}onMessage(t){if(q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let n=Qh(t.writeResults,t.commitTime),r=ie(t.commitTime);return this.listener.T_(r,n)}return q(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=Gh(this.serializer),this.t_(t)}I_(t){let n={streamToken:this.lastStreamToken,writes:t.map(r=>Kh(this.serializer,r))};this.t_(n)}};var ks=class extends class{}{constructor(t,n,r,i){super(),this.authCredentials=t,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,as(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(f.UNKNOWN,s.toString())})}vo(t,n,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,as(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new v(f.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var Os=class{constructor(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let n=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(At(n),this.g_=!1):g("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Ms=class{constructor(t,n,r,i,s){this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>_(this,null,function*(){dn(this)&&(g("RemoteStore","Restarting streams for network reachability change."),yield function(c){return _(this,null,function*(){let u=C(c);u.v_.add(4),yield hn(u),u.x_.set("Unknown"),u.v_.delete(4),yield hr(u)})}(this))}))}),this.x_=new Os(r,i)}};function hr(e){return _(this,null,function*(){if(dn(e))for(let t of e.F_)yield t(!0)})}function hn(e){return _(this,null,function*(){for(let t of e.F_)yield t(!1)})}function dn(e){return C(e).v_.size===0}function Wc(e,t,n){return _(this,null,function*(){if(!ur(t))throw t;e.v_.add(1),yield hn(e),e.x_.set("Offline"),n||(n=()=>td(e.localStore)),e.asyncQueue.enqueueRetryable(()=>_(this,null,function*(){g("RemoteStore","Retrying IndexedDB access"),yield n(),e.v_.delete(1),yield hr(e)}))})}function Hc(e,t){return t().catch(n=>Wc(e,n,t))}function dr(e){return _(this,null,function*(){let t=C(e),n=Pt(t),r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;rd(t);)try{let i=yield ed(t.localStore,r);if(i===null){t.D_.length===0&&n.Xo();break}r=i.batchId,id(t,i)}catch(i){yield Wc(t,i)}Yc(t)&&Xc(t)})}function rd(e){return dn(e)&&e.D_.length<10}function id(e,t){e.D_.push(t);let n=Pt(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function Yc(e){return dn(e)&&!Pt(e).Ho()&&e.D_.length>0}function Xc(e){Pt(e).start()}function sd(e){return _(this,null,function*(){Pt(e).d_()})}function od(e){return _(this,null,function*(){let t=Pt(e);for(let n of e.D_)t.I_(n.mutations)})}function ad(e,t,n){return _(this,null,function*(){let r=e.D_.shift(),i=is.from(r,t,n);yield Hc(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield dr(e)})}function cd(e,t){return _(this,null,function*(){t&&Pt(e).P_&&(yield function(r,i){return _(this,null,function*(){if(function(o){return Lh(o)&&o!==f.ABORTED}(i.code)){let s=r.D_.shift();Pt(r).Zo(),yield Hc(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield dr(r)}})}(e,t)),Yc(e)&&Xc(e)})}function Ec(e,t){return _(this,null,function*(){let n=C(e);n.asyncQueue.verifyOperationInProgress(),g("RemoteStore","RemoteStore received new credentials");let r=dn(n);n.v_.add(3),yield hn(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),yield hr(n)})}function ud(e,t){return _(this,null,function*(){let n=C(e);t?(n.v_.delete(2),yield hr(n)):t||(n.v_.add(2),yield hn(n),n.x_.set("Unknown"))})}function Pt(e){return e.B_||(e.B_=function(n,r,i){let s=C(n);return s.R_(),new Ns(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(e.datastore,e.asyncQueue,{Po:sd.bind(null,e),To:cd.bind(null,e),E_:od.bind(null,e),T_:ad.bind(null,e)}),e.F_.push(t=>_(this,null,function*(){t?(e.B_.Zo(),yield dr(e)):(yield e.B_.stop(),e.D_.length>0&&(g("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}var Ls=class e{constructor(t,n,r,i,s){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,i,s){let o=Date.now()+r,a=new e(t,n,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new v(f.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Jc(e,t){if(At("AsyncQueue",`${t}: ${e}`),ur(e))return new v(f.UNAVAILABLE,`${t}: ${e}`);throw e}var Fs=class{constructor(){this.queries=new bt(t=>Oc(t),kc),this.onlineState="Unknown",this.K_=new Set}};function ld(e){e.K_.forEach(t=>{t.next()})}var Bs=class{constructor(t,n,r,i,s,o){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new bt(a=>Oc(a),kc),this.pa=new Map,this.ya=new Set,this.wa=new Z(A.comparator),this.Sa=new Map,this.ba=new ln,this.Da={},this.Ca=new Map,this.va=un.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}};function hd(e,t,n){return _(this,null,function*(){let r=gd(e);try{let i=yield function(o,a){let c=C(o),u=nt.now(),l=a.reduce((y,S)=>y.add(S.key),W()),h,p;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let S=er(),D=W();return c.os.getEntries(y,l).next(R=>{S=R,S.forEach((H,tt)=>{tt.isValidDocument()||(D=D.add(H))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,S)).next(R=>{h=R;let H=[];for(let tt of a){let yt=Mh(tt,h.get(tt.key).overlayedDocument);yt!=null&&H.push(new Rt(tt.key,yt,Pc(yt.value.mapValue),qt.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,H,a)}).next(R=>{p=R;let H=R.applyToLocalDocumentSet(h,D);return c.documentOverlayCache.saveOverlays(y,R.batchId,H)})}).then(()=>({batchId:p.batchId,changes:Lc(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Da[o.currentUser.toKey()];u||(u=new Z(x)),u=u.insert(a,c),o.Da[o.currentUser.toKey()]=u}(r,i.batchId,n),yield fr(r,i.changes),yield dr(r.remoteStore)}catch(i){let s=Jc(i,"Failed to persist write");n.reject(s)}})}function Ic(e,t,n){let r=C(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.ga.forEach((s,o)=>{let a=o.view.U_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=C(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(let p of h.Q_)p.U_(a)&&(u=!0)}),u&&ld(c)}(r.eventManager,t),i.length&&r.fa.u_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function dd(e,t){return _(this,null,function*(){let n=C(e),r=t.batch.batchId;try{let i=yield Zh(n.localStore,t);tu(n,r,null),Zc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield fr(n,i)}catch(i){yield Sc(i)}})}function fd(e,t,n){return _(this,null,function*(){let r=C(e);try{let i=yield function(o,a){let c=C(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(q(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,t);tu(r,t,n),Zc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield fr(r,i)}catch(i){yield Sc(i)}})}function Zc(e,t){(e.Ca.get(t)||[]).forEach(n=>{n.resolve()}),e.Ca.delete(t)}function tu(e,t,n){let r=C(e),i=r.Da[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(n?s.reject(n):s.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function fr(e,t,n){return _(this,null,function*(){let r=C(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach((a,c)=>{o.push(r.Ma(c,t,n).then(u=>{if((u||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=As.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield function(c,u){return _(this,null,function*(){let l=C(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>d.forEach(u,p=>d.forEach(p.qi,y=>l.persistence.referenceDelegate.addReference(h,p.targetId,y)).next(()=>d.forEach(p.Qi,y=>l.persistence.referenceDelegate.removeReference(h,p.targetId,y)))))}catch(h){if(!ur(h))throw h;g("LocalStore","Failed to update sequence numbers: "+h)}for(let h of u){let p=h.targetId;if(!h.fromCache){let y=l.ns.get(p),S=y.snapshotVersion,D=y.withLastLimboFreeSnapshotVersion(S);l.ns=l.ns.insert(p,D)}}})}(r.localStore,s))})}function md(e,t){return _(this,null,function*(){let n=C(e);if(!n.currentUser.isEqual(t)){g("SyncEngine","User change. New user:",t.toKey());let r=yield Kc(n.localStore,t);n.currentUser=t,function(s,o){s.Ca.forEach(a=>{a.forEach(c=>{c.reject(new v(f.CANCELLED,o))})}),s.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield fr(n,r.us)}})}function gd(e){let t=C(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=dd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=fd.bind(null,t),t}var or=class{constructor(){this.synchronizeTabs=!1}initialize(t){return _(this,null,function*(){this.serializer=Qc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,n){return null}createIndexBackfillerScheduler(t,n){return null}createLocalStore(t){return Jh(this.persistence,new bs,t.initialUser,this.serializer)}createPersistence(t){return new Es(Ts.Hr,this.serializer)}createSharedClientState(t){return new Ps}terminate(){return _(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var qs=class{initialize(t,n){return _(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ic(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=md.bind(null,this.syncEngine),yield ud(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Fs}()}createDatastore(t){let n=Qc(t.databaseInfo.databaseId),r=function(s){return new Ds(s)}(t.databaseInfo);return function(s,o,a,c){return new ks(s,o,a,c)}(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return function(r,i,s,o,a){return new Ms(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,n=>Ic(this.syncEngine,n,0),function(){return ir.D()?new ir:new Cs}())}createSyncEngine(t,n){return function(i,s,o,a,c,u,l){let h=new Bs(i,s,o,a,c,u);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return _(this,null,function*(){var t;yield function(r){return _(this,null,function*(){let i=C(r);g("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield hn(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};var Us=class{constructor(t,n,r,i){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=K.UNAUTHENTICATED,this.clientId=ki.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>_(this,null,function*(){g("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(g("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){let r=Jc(n,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Si(e,t){return _(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),g("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(i=>_(this,null,function*(){r.isEqual(i)||(yield Kc(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function Tc(e,t){return _(this,null,function*(){e.asyncQueue.verifyOperationInProgress();let n=yield _d(e);g("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener(r=>Ec(t.remoteStore,r)),e.setAppCheckTokenChangeListener((r,i)=>Ec(t.remoteStore,i)),e._onlineComponents=t})}function pd(e){return e.name==="FirebaseError"?e.code===f.FAILED_PRECONDITION||e.code===f.UNIMPLEMENTED:!(typeof DOMException<"u"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}function _d(e){return _(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){g("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Si(e,e._uninitializedComponentsProvider._offline)}catch(t){let n=t;if(!pd(n))throw n;bi("Error using user provided cache. Falling back to memory cache: "+n),yield Si(e,new or)}}else g("FirestoreClient","Using default OfflineComponentProvider"),yield Si(e,new or);return e._offlineComponents})}function yd(e){return _(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(g("FirestoreClient","Using user provided OnlineComponentProvider"),yield Tc(e,e._uninitializedComponentsProvider._online)):(g("FirestoreClient","Using default OnlineComponentProvider"),yield Tc(e,new qs))),e._onlineComponents})}function wd(e){return yd(e).then(t=>t.syncEngine)}function eu(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var Ac=new Map;function vd(e,t,n,r){if(t===!0&&r===!0)throw new v(f.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ed(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":E()}function Id(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new v(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=Ed(e);throw new v(f.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}var ar=class{constructor(t){var n,r;if(t.host===void 0){if(t.ssl!==void 0)throw new v(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new v(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}vd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=eu((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new v(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new v(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new v(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},zs=class{constructor(t,n,r,i){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ar({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new v(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ar(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Pi;switch(r.type){case"firstParty":return new Di(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new v(f.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=Ac.get(n);r&&(g("ComponentProvider","Removing Datastore"),Ac.delete(n),r.terminate())}(this),Promise.resolve()}};var js=class{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new sr(this,"async_queue_retry"),this._u=()=>{let n=Ai();n&&g("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let t=Ai();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;let n=Ai();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise(()=>{});let n=new lt;return this.uu(()=>this.tu&&this.su?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.eu.push(t),this.cu()))}cu(){return _(this,null,function*(){if(this.eu.length!==0){try{yield this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!ur(t))throw t;g("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo(()=>this.cu())}})}uu(t){let n=this.Xa.then(()=>(this.iu=!0,t().catch(r=>{this.ru=r,this.iu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw At("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.iu=!1,r))));return this.Xa=n,n}enqueueAfterDelay(t,n,r){this.au(),this.ou.indexOf(t)>-1&&(n=0);let i=Ls.createAndSchedule(this,t,n,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&E()}verifyOperationInProgress(){}hu(){return _(this,null,function*(){let t;do t=this.Xa,yield t;while(t!==this.Xa)})}Pu(t){for(let n of this.nu)if(n.timerId===t)return!0;return!1}Iu(t){return this.hu().then(()=>{this.nu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.nu)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.hu()})}Tu(t){this.ou.push(t)}lu(t){let n=this.nu.indexOf(t);this.nu.splice(n,1)}};var cr=class extends zs{constructor(t,n,r,i){super(t,n,r,i),this.type="firestore",this._queue=function(){return new js}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||nu(this),this._firestoreClient.terminate()}};function Td(e){return e._firestoreClient||nu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function nu(e){var t,n,r;let i=e._freezeSettings(),s=function(a,c,u,l){return new Ui(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,eu(l.experimentalLongPollingOptions),l.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Us(e._authCredentials,e._appCheckCredentials,e._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Tf=new RegExp("[~\\*/\\[\\]]");function ru(e){return Ad(Id(e.firestore,cr),[new cn(e._key,qt.none())])}function Ad(e,t){return function(r,i){let s=new lt;return r.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){return hd(yield wd(r),i,s)})),s.promise}(Td(e),t)}(function(t,n=!0){(function(i){we=i})(Fo),Pe(new vt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new cr(new Ci(r.getProvider("auth-internal")),new Ni(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new v(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zi(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ht(cc,"4.4.3",t),Ht(cc,"4.4.3","esm2017")})();var Nf=(()=>{class e{constructor(){this.firestore=ro(Eo)}list(n){let r=vr(this.firestore,"posts"),i=[Ao(n.sort,n.order),To(n.limit)];n.query&&i.push(Tr(n.sort,">=",n.query.toLowerCase()),Tr(n.sort,"<=",n.query.toLowerCase()+"\uF8FF"));let s=So(r,...i),o=wt(Ir(r)).pipe(ft(c=>c.size)),a=wt(Ir(s)).pipe(ft(c=>{let u=[];return c.forEach(l=>{let h=l.data();u.push(Kt({id:l.id},h))}),u}));return eo([o,a]).pipe(ft(([c,u])=>({items:u,totalCount:c})))}create(n){return wt(Io(vr(this.firestore,"posts"),Kt({},n))).pipe(gr(r=>wt(Er(r))),ft(r=>{let i=r.data();return Kt({id:r.id},i)}))}detail(n){let r=fn(this.firestore,"posts",n);return wt(Er(r)).pipe(ft(i=>Kt({id:n},i.data())))}delete(n){let r=fn(this.firestore,"posts",n);return wt(ru(r)).pipe(ft(()=>{}))}patch(n,r){let i=fn(this.firestore,"posts",n);return wt(bo(i,Kt({},r))).pipe(gr(()=>this.detail(n)))}static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275prov=Qt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{Se as a,Nd as b,Nf as c};
